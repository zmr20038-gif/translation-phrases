<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LexiFlow Pro 300</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;900&family=Noto+Serif+SC:wght@700&display=swap" rel="stylesheet">
    <style>
        :root { --legal: #f59e0b; --gaming: #8b5cf6; --food: #f43f5e; --accent: #3b82f6; }
        body { background: #f8fafc; font-family: 'Inter', sans-serif; transition: background 0.4s ease; }
        .dark-mode { background: #020617; color: #f1f5f9; }
        
        /* Âä®ÊÄÅ‰∏ªÈ¢òÊ†∑Âºè */
        body.cat-legal { --accent: var(--legal); }
        body.cat-gaming { --accent: var(--gaming); }
        body.cat-food { --accent: var(--food); }

        .glass { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.4); }
        .dark-mode .glass { background: rgba(30, 41, 59, 0.7); border: 1px solid rgba(255, 255, 255, 0.05); }
        
        .active-tab { color: var(--accent) !important; transform: translateY(-5px); font-weight: 900; }
        .accent-bg { background-color: var(--accent); }
        .accent-text { color: var(--accent); }
        .accent-border { border-color: var(--accent); }

        .card-anim { animation: cardPop 0.5s cubic-bezier(0.17, 0.67, 0.2, 1.01); }
        @keyframes cardPop { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        input[type=number]::-webkit-inner-spin-button { display: none; }
    </style>
</head>
<body class="min-h-screen pb-32">

    <header class="px-6 pt-10 max-w-2xl mx-auto flex justify-between items-end mb-8">
        <div>
            <h1 class="text-5xl font-black tracking-tighter italic">LexiFlow</h1>
            <p id="catLabel" class="text-[10px] font-black tracking-[0.4em] accent-text uppercase mt-2">All Collections</p>
        </div>
        <button onclick="toggleDark()" class="w-12 h-12 glass rounded-2xl flex items-center justify-center text-xl shadow-sm">üåì</button>
    </header>

    <main id="view-search" class="px-6 max-w-2xl mx-auto">
        <div class="glass rounded-[2.5rem] mb-6 flex items-center px-7 shadow-2xl border-none">
            <input type="text" id="searchInput" oninput="doSearch()" placeholder="ÊêúÁ¥¢ËØçÊù°ÊàñËß£Èáä..." 
                   class="w-full bg-transparent py-7 focus:outline-none text-xl font-medium">
            <span class="opacity-20 text-2xl">üîç</span>
        </div>

        <div class="flex space-x-3 mb-8 overflow-x-auto no-scrollbar py-2" id="catFilter">
            <button onclick="setCat('all')" class="flex-none px-7 py-3 rounded-2xl glass text-[10px] font-black accent-bg text-white shadow-lg shadow-blue-500/20">ALL</button>
            <button onclick="setCat('legal')" class="flex-none px-7 py-3 rounded-2xl glass text-[10px] font-black hover:bg-white transition-all">‚öñÔ∏è LEGAL</button>
            <button onclick="setCat('gaming')" class="flex-none px-7 py-3 rounded-2xl glass text-[10px] font-black hover:bg-white transition-all">üéÆ GAMING</button>
            <button onclick="setCat('food')" class="flex-none px-7 py-3 rounded-2xl glass text-[10px] font-black hover:bg-white transition-all">üç± FOOD</button>
        </div>

        <div id="listContainer" class="grid gap-4"></div>
    </main>

    <main id="view-learn" class="px-6 pt-10 max-w-md mx-auto view-hidden text-center">
        <div class="glass rounded-[3rem] p-8 mb-10 flex justify-between items-center shadow-inner">
            <div class="text-left">
                <span class="text-[10px] font-black opacity-30 uppercase tracking-widest">Today's Goal</span>
                <div class="flex items-center space-x-2">
                    <span id="learnProgress" class="text-4xl font-black accent-text">0</span>
                    <span class="text-2xl opacity-10">/</span>
                    <input type="number" id="dailyGoal" onchange="updateGoal()" class="w-12 bg-transparent text-2xl font-black focus:outline-none">
                </div>
            </div>
            <div class="text-right">
                <span class="text-[10px] font-black opacity-30 uppercase tracking-widest">Review</span>
                <p id="reviewCount" class="text-4xl font-black">0</p>
            </div>
        </div>
        <div id="cardStage" class="min-h-[400px]"></div>
    </main>

    <nav class="fixed bottom-8 left-1/2 -translate-x-1/2 w-[320px] h-24 glass rounded-[3.5rem] shadow-2xl flex items-center justify-around px-6 z-[100] border-white/40">
        <button onclick="showPage('learn')" id="btn-learn" class="flex flex-col items-center opacity-30 transition-all hover:opacity-100">
            <span class="text-3xl mb-1">üé¥</span>
            <span class="text-[9px] font-black uppercase tracking-widest">Learn</span>
        </button>
        <div class="w-[1px] h-8 bg-gray-200 opacity-20"></div>
        <button onclick="showPage('search')" id="btn-search" class="flex flex-col items-center active-tab transition-all">
            <span class="text-3xl mb-1">üó∫Ô∏è</span>
            <span class="text-[9px] font-black uppercase tracking-widest">Explore</span>
        </button>
    </nav>

    <script>
        // Êâ©Â±ïËá≥300ËØçÁöÑÁªìÊûÑÁ§∫ËåÉÔºàÂ∑≤Â°´ÂÖÖÊ†∏ÂøÉËøõÈò∂ËØçÊ±áÔºâ
        const library = [
            // LEGAL ‚öñÔ∏è (ÈÉ®ÂàÜÂ°´ÂÖÖ)
            { id:'l1', cat:'legal', en:'Without Prejudice', zh:'‰∏çÊçüÂÆ≥ÊùÉÂà©', d:'Ë°®Á§∫Âú®Ë∞àÂà§‰∏≠ÁöÑËÆ©Ê≠•‰∏çËÉΩ‰Ωú‰∏∫Êó•ÂêéÊ≥ïÂæãËØâËÆºÁöÑËØÅÊçÆ„ÄÇ' },
            { id:'l2', cat:'legal', en:'Force Majeure', zh:'‰∏çÂèØÊäóÂäõ', d:'ÂêàÂêå‰∏≠ÂÖçÈô§Âõ†‰∏çÂèØÊéßÂ§©ÁÅæÊàñÊàò‰∫âÂØºËá¥ËøùÁ∫¶Ë¥£‰ªªÁöÑÊù°Ê¨æ„ÄÇ' },
            { id:'l3', cat:'legal', en:'Due Diligence', zh:'Â∞ΩËÅåË∞ÉÊü•', d:'Á≠æÁΩ≤ÂïÜ‰∏öÂçèËÆÆÂâçÔºåÂØπËµÑ‰∫ßÊàñËÉåÊôØËøõË°åÁöÑËØ¶ÁªÜÊ≥ïÂæã‰∏éË¥¢Âä°ÂÆ°Êü•„ÄÇ' },
            { id:'l4', cat:'legal', en:'Indemnification', zh:'ËµîÂÅø‰øùËØÅ', d:'‰∏ÄÊñπÊâøËØ∫Ëã•Âõ†ÂÖ∂Ë°å‰∏∫ÂØºËá¥ÂØπÊñπË¢´Á¨¨‰∏âÊñπËµ∑ËØâÔºåÂ∞ÜÊâøÊãÖÂÖ®ÈÉ®ÊçüÂ§±„ÄÇ' },
            { id:'l5', cat:'legal', en:'Statute of Limitations', zh:'ËØâËÆºÊó∂Êïà', d:'Ê≥ïÂæãËßÑÂÆöÊùÉÂà©‰∫∫ÂèØ‰ª•ÊèêËµ∑ËØâËÆºÁöÑÊúâÊïàÊúüÈôêÔºåËøáÊúüÂàô‰∏ç‰∫àÂèóÁêÜ„ÄÇ' },
            { id:'l6', cat:'legal', en:'Liquidated Damages', zh:'ËøùÁ∫¶Èáë', d:'ÂêàÂêå‰∏≠È¢ÑÂÖàÁ∫¶ÂÆöÁöÑÔºå‰∏ÄÊó¶ËøùÁ∫¶ÈúÄÊîØ‰ªòÁöÑÂõ∫ÂÆöËµîÂÅøÈáëÈ¢ù„ÄÇ' },
            { id:'l7', cat:'legal', en:'Amicus Curiae', zh:'Ê≥ïÂ∫≠‰πãÂèã', d:'ÈùûÊ°à‰ª∂ÂΩì‰∫ã‰∫∫‰ΩÜÈÄöËøáÊèê‰æõ‰ø°ÊÅØÊàñËßÇÁÇπÂçèÂä©Ê≥ïÂ∫≠ÁöÑ‰∏ìÂÆ∂ÊàñÁªÑÁªá„ÄÇ' },
            { id:'l8', cat:'legal', en:'Caveat Emptor', zh:'Ë¥ßÁâ©Âá∫Èó®ÔºåÊ¶Ç‰∏çÈÄÄÊç¢', d:'Ê≥ïÂæãÂéüÂàôÔºö‰π∞‰∏ªÈ°ªËá™Ë°åÊ≥®ÊÑèÂïÜÂìÅÂìÅË¥®ÔºåÈô§ÈùûÂçñÂÆ∂Ê¨∫ËØà„ÄÇ' },
            { id:'l9', cat:'legal', en:'Habeas Corpus', zh:'‰∫∫Ë∫´‰øùÊä§‰ª§', d:'‰øùÊä§ÂÖ¨Ê∞ëÂÖçÂèóÈùûÊ≥ïÊãòÁïôÁöÑÂÆ™Ê≥ïÊùÉÂà©ÔºåË¶ÅÊ±ÇÂ∞Ü‰∫∫Â∏¶‰∏äÊ≥ïÂ∫≠ÂÆ°ÁêÜ„ÄÇ' },
            { id:'l10', cat:'legal', en:'Subpoena', zh:'‰º†Á•®', d:'Ê≥ïÈô¢ÂèëÂ∏ÉÁöÑÂº∫Âà∂ÂëΩ‰ª§ÔºåË¶ÅÊ±ÇÊüê‰∫∫Âá∫Â∫≠‰ΩúËØÅÊàñÊèê‰∫§ËØÅÊçÆ„ÄÇ' },
            // ... (Ê≠§Â§ÑÂèØÊåâÊ≠§Ê†ºÂºèÊâ©ÂÖÖËá≥100‰∏™)

            // GAMING üéÆ
            { id:'g1', cat:'gaming', en:'Fog of War', zh:'Êàò‰∫âËø∑Èõæ', d:'Âú∞Âõæ‰∏äÊú™Êé¢Á¥¢Âå∫ÂüüË¢´Èò¥ÂΩ±Ë¶ÜÁõñÔºåÂè™ÊúâÊ¥æÈÅ£Âçï‰ΩçÊâçËÉΩËß£ÈîÅËßÜËßâ„ÄÇ' },
            { id:'g2', cat:'gaming', en:'Cooldown (CD)', zh:'ÂÜ∑Âç¥Êó∂Èó¥', d:'ÊäÄËÉΩ‰ΩøÁî®ÂêéÈúÄË¶ÅÁ≠âÂæÖÁöÑÈáçÁΩÆÊó∂Èó¥ÔºåÂπ≥Ë°°Ê∏∏ÊàèËäÇÂ•èÁöÑÂÖ≥ÈîÆ„ÄÇ' },
            { id:'g3', cat:'gaming', en:'Procedural Generation', zh:'ÈöèÊú∫ÁîüÊàê', d:'Âà©Áî®ÁÆóÊ≥ïËÄåÈùû‰∫∫Â∑•ÂàõÂª∫Âú∞ÂõæÊàñÂÜÖÂÆπÔºàÂ¶Ç„ÄäÊó†‰∫∫Ê∑±Á©∫„ÄãÔºâ„ÄÇ' },
            { id:'g4', cat:'gaming', en:'Ray Tracing', zh:'ÂÖâÁ∫øËøΩË∏™', d:'Ê®°ÊãüÂÖâÁ∫øÁâ©ÁêÜË°å‰∏∫ÁöÑÈ´òÁ∫ßÂõæÂΩ¢ÊäÄÊúØÔºåÂ§ßÂπÖÊèêÂçáÁîªË¥®ÁúüÂÆûÂ∫¶„ÄÇ' },
            { id:'g5', cat:'gaming', en:'Microtransaction', zh:'ÂæÆ‰∫§Êòì/ÂÜÖË¥≠', d:'Ê∏∏ÊàèÂÜÖË¥≠‰π∞ËôöÊãüÁöÆËÇ§„ÄÅÈÅìÂÖ∑ÊàñË¥ßÂ∏ÅÁöÑÂ∞èÈ¢ùÊ∂àË¥πË°å‰∏∫„ÄÇ' },
            { id:'g6', cat:'gaming', en:'Permadeath', zh:'Ê∞∏‰πÖÊ≠ª‰∫°', d:'RoguelikeÊ†∏ÂøÉÊú∫Âà∂ÔºöËßíËâ≤Ê≠ª‰∫°Âç≥Âà†Ê°£Ôºå‰∏çÂèØËØªÊ°£ÈáçÊù•„ÄÇ' },
            { id:'g7', cat:'gaming', en:'Frame Data', zh:'Â∏ßÊï∞Êï∞ÊçÆ', d:'Ê†ºÊñóÊ∏∏ÊàèÁ°¨Ê†∏ÊåáÊ†áÔºöÂä®‰ΩúÂèëÁîüÁöÑÂÖ∑‰ΩìÂ∏ßÊï∞ÔºåÁî®‰∫éÂà§ÂÆöÊãõÂºèÂø´ÊÖ¢„ÄÇ' },
            { id:'g8', cat:'gaming', en:'QTE', zh:'Âø´ÈÄüÂèçÂ∫î‰∫ã‰ª∂', d:'ÂâßÊÉÖ‰∏≠Á™ÅÁÑ∂Âá∫Áé∞ÁöÑÊåâÈîÆÊèêÁ§∫ÔºåÁé©ÂÆ∂ÂøÖÈ°ªÁû¨Èó¥Êåâ‰∏ã‰ª•Ëß¶ÂèëÂä®‰Ωú„ÄÇ' },
            { id:'g9', cat:'gaming', en:'Early Access', zh:'Êä¢ÂÖà‰ΩìÈ™å', d:'ÂºÄÂèëËÄÖÂú®Ê∏∏ÊàèÊú™ÂÆåÂ∑•ÂâçÂîÆÂçñÔºåËÆ©Áé©ÂÆ∂ÂèÇ‰∏éÊµãËØïÂπ∂Êèê‰æõÂèçÈ¶à„ÄÇ' },
            { id:'g10', cat:'gaming', en:'Gacha Mechanism', zh:'ÊäΩÂç°Êú∫Âà∂', d:'Ê∫êËá™Êâ≠ËõãÔºåÊåáÈÄöËøáÈöèÊú∫Ê¶ÇÁéáËé∑ÂèñÁ®ÄÊúâÈÅìÂÖ∑ÁöÑÂïÜ‰∏öÈÄªËæë„ÄÇ' },

            // FOOD üç±
            { id:'f1', cat:'food', en:'Maillard Reaction', zh:'ÁæéÊãâÂæ∑ÂèçÂ∫î', d:'ËÇâÁ±ªÂä†ÁÉ≠Ëá≥140Â∫¶‰ª•‰∏äÊó∂‰∫ßÁîüË§êËâ≤ÂèäÁÑ¶È¶ôÂë≥ÁöÑÂÖ≥ÈîÆÂåñÂ≠¶ÂèçÂ∫î„ÄÇ' },
            { id:'f2', cat:'food', en:'Sous-vide', zh:'‰ΩéÊ∏©ÊÖ¢ÁÖÆ', d:'ÁúüÁ©∫ÂåÖË£ÖÈ£üÊùêÔºåÂú®Á≤æÁ°ÆÊÅíÊ∏©ÁöÑÊ∞¥Êµ¥‰∏≠ÈïøÊó∂Èó¥Âä†ÁÉ≠Ôºå‰øùÊåÅÊ∞¥ÂàÜ„ÄÇ' },
            { id:'f3', cat:'food', en:'Al Dente', zh:'ÂºπÁâô/Âä≤ÈÅì', d:'ÊÑèÂ§ßÂà©Èù¢ÁÖÆÂæóÊÅ∞Âà∞Â•ΩÂ§ÑÔºöÂ§ñË°®ÊüîËΩØ‰ΩÜ‰∏≠ÂøÉ‰øùÁïô‰∏Ä‰∏ùÈüßÂä≤„ÄÇ' },
            { id:'f4', cat:'food', en:'Umami', zh:'È≤úÂë≥', d:'Èô§‰∫ÜÈÖ∏ÁîúËã¶Âí∏‰πãÂ§ñÁöÑÁ¨¨‰∫îÁßçÂë≥ÈÅìÔºåÁî±Ë∞∑Ê∞®ÈÖ∏ÁõêÁ≠âÁâ©Ë¥®‰∫ßÁîü„ÄÇ' },
            { id:'f5', cat:'food', en:'Deglazing', zh:'Êî∂Ê±Å/ÂàÆÈîÖ', d:'Âú®ÁÖéËÇâÈîÖ‰∏≠ÂÄíÂÖ•Ê∂≤‰ΩìÔºàÂ¶ÇÈÖíÔºâÔºåÂ∞ÜÁ≤òÂú®ÈîÖÂ∫ïÁöÑÊµìÁº©ËÇâÊ±ÅÊ∫∂Ëß£ÊàêÈÖ±„ÄÇ' },
            { id:'f6', cat:'food', en:'Sommelier', zh:'‰æçÈÖíÂ∏à', d:'È§êÂéÖÂÜÖ‰∏ìÈó®Ë¥üË¥£ÈÖíÂçïÂÆöÂà∂„ÄÅÂ≠òÂÇ®Âèä‰∏∫È§êÁÇπÊé®ËçêÈÖçÈÖíÁöÑ‰∏ìÂÆ∂„ÄÇ' },
            { id:'f7', cat:'food', en:'Reduction', zh:'ÊµìÁº©', d:'ÈÄöËøáÈïøÊó∂Èó¥ÁÜ¨ÁÖÆÊéíËµ∞Ê∂≤‰ΩìÊ∞¥ÂàÜÔºå‰ΩøÊ±§Ê±ÅÂë≥ÈÅìÂèòÂæóÊûÅÂÖ∂ÊµìÈÉÅ„ÄÇ' },
            { id:'f8', cat:'food', en:'Mouthfeel', zh:'Âè£ÊÑü', d:'Èô§‰∫ÜÂë≥ÈÅìÂ§ñÔºåÈ£üÁâ©Âú®Âè£‰∏≠ÁöÑÁâ©ÁêÜË¥®ÊÑüÔºàÂ¶Ç‰∏ùÊªë„ÄÅÈ¢óÁ≤íÊÑüÔºâ„ÄÇ' },
            { id:'f9', cat:'food', en:'Farm-to-Table', zh:'‰ªéÂÜúÂú∫Âà∞È§êÊ°å', d:'Âº∫Ë∞ÉÈ£üÊùêÊñ∞È≤ú„ÄÅÊú¨Âú∞‰æõÂ∫î‰∏îÂáèÂ∞ëÂ∑•‰∏öÂä†Â∑•ÁéØËäÇÁöÑÈ§êÈ•ÆÁêÜÂøµ„ÄÇ' },
            { id:'f10', cat:'food', en:'Infusion', zh:'Êµ∏Ê∏ç/Ê≥°Âèë', d:'Â∞ÜÊ§çÁâ©ÔºàÂ¶ÇËå∂Âè∂ÊàñÈ¶ôËçâÔºâÊ≥°Âú®Ê∂≤‰Ωì‰∏≠ÊèêÂèñÂÖ∂È£éÂë≥ÁöÑËøáÁ®ã„ÄÇ' }
        ];

        // Ê†∏ÂøÉÈÄªËæë
        let state = {
            view: 'search',
            cat: 'all',
            goal: 10,
            mem: JSON.parse(localStorage.getItem('lexi_v7') || '{}'),
            todayCount: parseInt(localStorage.getItem('lexi_today_v7') || 0),
            lastDate: new Date().toLocaleDateString()
        };

        function init() {
            if(localStorage.getItem('lexi_date_v7') !== state.lastDate) {
                state.todayCount = 0;
                localStorage.setItem('lexi_date_v7', state.lastDate);
                localStorage.setItem('lexi_today_v7', 0);
            }
            document.getElementById('dailyGoal').value = state.goal;
            setCat('all');
            doSearch();
        }

        function setCat(c) {
            state.cat = c;
            document.body.className = `min-h-screen pb-32 cat-${c}`;
            document.getElementById('catLabel').innerText = c === 'all' ? 'All Collections' : `${c} Series`;
            
            const btns = document.querySelectorAll('#catFilter button');
            btns.forEach(b => {
                b.classList.remove('accent-bg', 'text-white', 'shadow-lg');
                if(b.innerText.toLowerCase().includes(c) || (c === 'all' && b.innerText === 'ALL')) {
                    b.classList.add('accent-bg', 'text-white', 'shadow-lg');
                }
            });
            doSearch();
        }

        function doSearch() {
            const q = document.getElementById('searchInput').value.toLowerCase();
            const container = document.getElementById('listContainer');
            const filtered = library.filter(i => 
                (state.cat === 'all' || i.cat === state.cat) && 
                (i.en.toLowerCase().includes(q) || i.zh.includes(q))
            );

            container.innerHTML = filtered.map(i => `
                <div class="glass p-7 rounded-[2.5rem] flex justify-between items-start card-anim hover:shadow-xl transition-all" onclick="addToLearn('${i.id}')">
                    <div class="flex-1 pr-4">
                        <div class="flex items-center space-x-2 mb-2">
                            <h4 class="font-black text-2xl tracking-tighter">${i.en}</h4>
                        </div>
                        <p class="opacity-40 text-sm font-medium leading-relaxed">${i.zh}</p>
                    </div>
                    <div class="flex flex-col items-end">
                        <span class="text-[9px] font-black opacity-20 uppercase mb-2">${i.cat}</span>
                        <div class="w-3 h-3 rounded-full ${state.mem[i.id] ? 'accent-bg' : 'bg-gray-100'}"></div>
                    </div>
                </div>
            `).join('');
        }

        function addToLearn(id) {
            if(!state.mem[id]) {
                state.mem[id] = { lvl: 1, t: Date.now() };
                save();
                doSearch();
            }
        }

        function renderLearn() {
            const now = Date.now();
            const toReview = library.filter(i => state.mem[i.id] && state.mem[i.id].t <= now);
            const unlearned = library.filter(i => !state.mem[i.id]);
            const todayNew = unlearned.slice(0, Math.max(0, state.goal - state.todayCount));

            document.getElementById('reviewCount').innerText = toReview.length;
            document.getElementById('learnProgress').innerText = state.todayCount;
            
            const stage = document.getElementById('cardStage');
            let current = toReview[0] || todayNew[0];

            if(!current) {
                stage.innerHTML = `<div class="glass p-16 rounded-[4rem] card-anim mt-10">
                    <div class="text-7xl mb-6">üèùÔ∏è</div>
                    <h3 class="text-3xl font-black mb-3">All Clear</h3>
                    <p class="opacity-30 font-medium">ÊâÄÊúâÁöÑËØçÊù°ÈÉΩÂ∑≤ÊéåÊè°<br>ÂéªÊêúÁ¥¢Ê∑ªÂä†Êñ∞ÂÜÖÂÆπÂêß</p>
                </div>`;
                return;
            }

            stage.innerHTML = `
                <div class="glass p-12 rounded-[4rem] shadow-2xl card-anim w-full relative overflow-hidden flex flex-col justify-center min-h-[450px]">
                    <div class="mb-10">
                        <span class="accent-text text-[11px] font-black uppercase tracking-[0.4em] mb-4 block">${toReview[0] ? 'Time to Review' : 'New Discovery'}</span>
                        <h2 class="text-5xl font-black tracking-tighter leading-none mb-6">${current.en}</h2>
                        <div id="ans" class="hidden">
                            <p class="text-2xl font-bold mb-4 opacity-80">${current.zh}</p>
                            <div class="h-[1px] w-12 accent-bg mx-auto mb-6 opacity-30"></div>
                            <p class="text-sm opacity-50 font-serif leading-relaxed px-6 italic">${current.d}</p>
                        </div>
                    </div>
                    
                    <button id="tapBtn" onclick="reveal()" class="mx-auto w-20 h-20 rounded-full border-2 accent-border accent-text flex items-center justify-center font-black text-[10px] uppercase tracking-widest animate-pulse">Tap</button>
                    
                    <div id="ctrls" class="hidden flex space-x-4 px-4">
                        <button onclick="handle(true, '${current.id}', ${!!toReview[0]})" class="flex-1 py-6 rounded-[2rem] accent-bg text-white font-black shadow-2xl">GOT IT</button>
                        <button onclick="handle(false, '${current.id}', ${!!toReview[0]})" class="flex-1 py-6 rounded-[2rem] bg-gray-100 dark:bg-gray-800 text-gray-400 font-black">AGAIN</button>
                    </div>
                </div>`;
        }

        function reveal() {
            document.getElementById('ans').classList.remove('hidden');
            document.getElementById('ctrls').classList.remove('hidden');
            document.getElementById('tapBtn').classList.add('hidden');
        }

        function handle(known, id, isReview) {
            if(!isReview && known) {
                state.todayCount++;
                localStorage.setItem('lexi_today_v7', state.todayCount);
            }
            const gap = [0, 1, 12, 24, 72, 168, 360, 720]; 
            if(!state.mem[id]) state.mem[id] = { lvl: 1 };
            state.mem[id].lvl = known ? Math.min(state.mem[id].lvl + 1, 7) : 1;
            state.mem[id].t = Date.now() + gap[state.mem[id].lvl] * 3600000;
            save();
            renderLearn();
        }

        function save() { localStorage.setItem('lexi_v7', JSON.stringify(state.mem)); }

        function showPage(p) {
            document.getElementById('view-search').classList.toggle('view-hidden', p !== 'search');
            document.getElementById('view-learn').classList.toggle('view-hidden', p !== 'learn');
            document.getElementById('btn-search').classList.toggle('active-tab', p === 'search');
            document.getElementById('btn-learn').classList.toggle('active-tab', p === 'learn');
            if(p === 'learn') renderLearn();
        }

        function updateGoal() {
            state.goal = parseInt(document.getElementById('dailyGoal').value);
            renderLearn();
        }

        function toggleDark() { document.body.classList.toggle('dark-mode'); }

        window.onload = init;
    </script>
</body>
</html>
