<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>LexiFlow MTI v17.6 Final</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700;800&family=Noto+Serif+SC:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #F8FAFC; --text: #0F172A; --card: #FFFFFF; --accent: #4F46E5; }
        .dark { --bg: #0F172A; --text: #CBD5E1; --card: #1E293B; --accent: #818CF8; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Plus Jakarta Sans', sans-serif; transition: all 0.3s; overflow-x: hidden; }
        .serif { font-family: 'Noto Serif SC', serif; }
        .app-container { max-width: 600px; margin: 0 auto; }
        .hide { display: none !important; }
        .glass { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.2); }
        .dark .glass { background: rgba(30, 41, 59, 0.8); border: 1px solid rgba(255,255,255,0.05); }
        .active-tab { color: var(--accent) !important; opacity: 1 !important; font-weight: 800; transform: translateY(-2px); }
        
        /* ä¾§è¾¹æ äº¤äº’ */
        #settings-sidebar { transform: translateX(100%); transition: transform 0.4s cubic-bezier(0.32, 0.72, 0, 1); }
        #settings-sidebar.open { transform: translateX(0); }

        /* å®Œç¾å±…ä¸­ä¸å¡ç‰‡ç¿»è½¬ */
        .card-container { perspective: 1200px; height: 480px; width: 100%; position: relative; }
        .flip-card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1); transform-style: preserve-3d; cursor: pointer; }
        .flipped .flip-card-inner { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 3.5rem; background: var(--card); box-shadow: 0 30px 60px -12px rgba(0,0,0,0.12); }
        
        /* æ­£é¢ï¼šæ ¸å¿ƒå†…å®¹å‚ç›´æ°´å¹³ç»å¯¹å±…ä¸­ */
        .card-front { display: flex; align-items: center; justify-content: center; padding: 2.5rem; text-align: center; }
        .tap-hint { position: absolute; bottom: 3rem; left: 0; right: 0; text-align: center; font-[800] text-[10px] opacity-20 tracking-[0.5em] uppercase; pointer-events: none; }
        
        /* èƒŒé¢ï¼šå†…å®¹å¯æ»šåŠ¨ä½†ä¿æŒè§†è§‰å¹³è¡¡ */
        .card-back { transform: rotateY(180deg); border: 3px solid var(--accent); padding: 2.5rem; display: flex; flex-direction: column; overflow: hidden; }
        .card-back-content { flex: 1; display: flex; flex-direction: column; justify-content: center; overflow-y: auto; padding-right: 4px; }
        .card-back-content::-webkit-scrollbar { width: 3px; }
        .card-back-content::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 10px; }

        /* æœç´¢åˆ—è¡¨åŠ¨ç”» */
        .explore-item { transition: all 0.3s ease; }
        .explore-item.expanded { padding-bottom: 2rem; }
    </style>
</head>
<body class="select-none min-h-screen pb-40">

    <header class="app-container px-6 pt-12 pb-6 flex justify-between items-center relative z-50">
        <div>
            <div id="date-tag" class="text-[10px] font-black opacity-30 tracking-[0.2em] mb-1 uppercase italic text-indigo-500">2026 MTI Professional</div>
            <h1 class="text-3xl font-[900] tracking-tighter italic">Lexi<span class="text-indigo-600">MTI</span></h1>
        </div>
        <div class="flex gap-3">
            <div class="h-12 px-5 glass rounded-full flex items-center gap-2 shadow-sm border border-indigo-100">
                <span class="text-sm">ğŸ†</span>
                <span id="display-points" class="font-black text-xs">2,480</span>
            </div>
            <button onclick="toggleSidebar(true)" class="w-12 h-12 glass rounded-full flex items-center justify-center shadow-sm text-xl active:scale-90 transition-transform">âš™ï¸</button>
        </div>
    </header>

    <div id="views" class="app-container">
        <main id="view-home" class="px-6 space-y-6">
            <div class="grid grid-cols-2 gap-4">
                <div onclick="startStudy('new')" class="bg-white dark:bg-slate-800 p-8 rounded-[2.5rem] shadow-sm cursor-pointer border-b-4 border-indigo-100 dark:border-slate-700 active:scale-95 transition-all">
                    <span class="text-[10px] font-black opacity-40 uppercase tracking-widest italic">å¾…å­¦ä¹ </span>
                    <p id="num-new" class="text-4xl font-[900] mt-2 text-indigo-600">0</p>
                </div>
                <div onclick="startStudy('review')" class="bg-white dark:bg-slate-800 p-8 rounded-[2.5rem] shadow-sm cursor-pointer border-b-4 border-emerald-100 dark:border-slate-700 active:scale-95 transition-all">
                    <span class="text-[10px] font-black opacity-40 uppercase tracking-widest italic">éœ€å¤ä¹ </span>
                    <p id="num-review" class="text-4xl font-[900] mt-2 text-emerald-500">0</p>
                </div>
            </div>
            
            <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-[3rem] p-10 text-white shadow-2xl relative overflow-hidden">
                <p id="quote-en" class="text-lg font-bold font-serif italic leading-relaxed z-10 relative">"Originality is nothing but judicious imitation."</p>
                <p id="quote-zh" class="text-xs opacity-50 mt-4 serif leading-loose z-10 relative">ç‹¬åˆ›æ€§æ— éæ˜¯æ˜æ™ºçš„æ¨¡ä»¿ã€‚</p>
                <div class="flex justify-between items-center mt-6 z-10 relative">
                    <p class="text-[9px] font-black opacity-30 tracking-widest uppercase">â€” Voltaire</p>
                    <span class="text-[10px] bg-white/10 px-3 py-1 rounded-full font-bold">Daily Quote</span>
                </div>
                <div class="absolute -right-10 -bottom-10 w-40 h-40 bg-indigo-500/10 rounded-full blur-3xl"></div>
            </div>
        </main>

        <main id="view-explore" class="px-6 hide">
            <input type="text" id="search-input" oninput="renderExplore()" placeholder="æœç´¢ 60+ é¢„ç½®æœ¯è¯­..." class="w-full p-6 rounded-[2.2rem] bg-white dark:bg-slate-800 border-none outline-none shadow-sm text-sm font-medium mb-6 focus:ring-2 ring-indigo-500 transition-all">
            <div id="explore-list" class="space-y-4 pb-24"></div>
        </main>

        <main id="view-learned" class="px-6 hide pb-20">
            <div class="flex justify-between items-center mb-6 px-2">
                <h2 class="text-xl font-[900] italic">å·²æŒæ¡æœ¯è¯­</h2>
                <button onclick="toggleEditMode()" id="btn-edit" class="text-[10px] font-black bg-white dark:bg-slate-800 px-5 py-2.5 rounded-full shadow-sm">æ‰¹é‡é‡ç½®</button>
            </div>
            <div id="learned-list" class="space-y-3"></div>
        </main>

        <main id="view-books" class="px-6 hide pb-20">
            <div class="flex justify-between items-center mb-6 px-2">
                <h2 class="text-xl font-[900] italic">è¯ä¹¦åˆ†ç±»</h2>
                <button onclick="createNewBook()" class="text-[10px] bg-slate-900 text-white px-5 py-2.5 rounded-2xl font-black shadow-lg shadow-indigo-100">+ NEW</button>
            </div>
            <div id="bookshelf-list" class="grid grid-cols-2 gap-5"></div>
        </main>

        <main id="view-book-detail" class="px-6 hide pb-20">
            <div class="flex items-center gap-4 mb-8">
                <button onclick="switchTab('books')" class="w-12 h-12 flex items-center justify-center bg-white dark:bg-slate-800 rounded-full shadow-sm text-lg active:scale-90">â†</button>
                <div class="truncate">
                    <h2 id="detail-book-name" class="text-xl font-[900] serif truncate">Book</h2>
                    <p id="detail-count" class="text-[8px] font-black opacity-30 tracking-widest uppercase">A-Z SORTED</p>
                </div>
            </div>
            <div id="book-items-list" class="space-y-4"></div>
        </main>

        <main id="view-import" class="px-6 hide">
            <div class="bg-white dark:bg-slate-800 rounded-[3rem] p-10 shadow-sm space-y-5">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-xl font-[900]">æ™ºèƒ½å¯¼å…¥</h2>
                    <select id="import-book-select" class="text-[10px] font-black text-indigo-600 bg-indigo-50 dark:bg-indigo-900/40 px-4 py-2 rounded-xl border-none outline-none"></select>
                </div>
                <input id="in-en" type="text" placeholder="è‹±æ–‡æœ¯è¯­ *" class="w-full p-5 rounded-2xl bg-slate-50 dark:bg-slate-900 border-none outline-none text-sm font-bold">
                <input id="in-zh" type="text" placeholder="ä¸­æ–‡ç¿»è¯‘ *" class="w-full p-5 rounded-2xl bg-slate-50 dark:bg-slate-900 border-none outline-none text-sm serif">
                <textarea id="in-d" placeholder="è¾“å…¥ç¬”è®°æˆ–ä¾‹å¥..." class="w-full p-5 rounded-2xl bg-slate-50 dark:bg-slate-900 border-none outline-none text-xs h-32 resize-none serif"></textarea>
                <button onclick="handleManualImport()" class="w-full bg-indigo-600 text-white py-6 rounded-3xl font-[900] shadow-xl text-sm tracking-widest uppercase active:scale-95">ä¿å­˜åˆ°åˆ†ç±»</button>
            </div>
        </main>
    </div>

    <section id="study-layer" class="fixed inset-0 bg-slate-50 dark:bg-slate-950 z-[200] hide flex flex-col">
        <div class="app-container w-full px-6 pt-12 flex justify-between items-center">
            <button onclick="closeStudy()" class="w-12 h-12 rounded-full bg-white dark:bg-slate-800 flex items-center justify-center shadow-sm">âœ•</button>
            <div class="text-center">
                <span id="study-progress" class="text-[10px] font-black opacity-30 tracking-[0.4em]">0 / 0</span>
                <p id="study-book-tag" class="text-[8px] font-black text-indigo-500 uppercase mt-1">TAG</p>
            </div>
            <button onclick="speakCurrent()" class="w-12 h-12 rounded-full bg-white dark:bg-slate-800 flex items-center justify-center shadow-sm">ğŸ”Š</button>
        </div>
        
        <div class="flex-1 p-6 flex items-center justify-center">
            <div class="card-container max-w-sm mx-auto w-full" id="studyCardMain">
                <div class="flip-card-inner" onclick="this.parentElement.classList.toggle('flipped')">
                    <div class="card-face card-front">
                        <h2 id="card-en" class="text-3xl font-[900] leading-tight tracking-tighter">Term</h2>
                        <div class="tap-hint">Tap to Reveal</div>
                    </div>
                    <div class="card-face card-back">
                        <div class="card-back-content">
                            <h3 id="card-zh" class="text-2xl font-[900] text-indigo-600 mb-6 serif">è§£é‡Š</h3>
                            <p id="card-d" class="text-[13px] opacity-70 leading-relaxed serif"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="p-8 pb-16 bg-white dark:bg-slate-900 rounded-t-[4rem] shadow-2xl app-container w-full grid grid-cols-3 gap-4">
            <button onclick="handleLearn(1)" class="py-6 bg-slate-100 dark:bg-slate-800 rounded-3xl font-black text-[10px] opacity-40 uppercase">å¿˜è®°</button>
            <button onclick="handleLearn(2)" class="py-6 bg-indigo-50 dark:bg-indigo-900/20 rounded-3xl font-black text-[10px] text-indigo-600 uppercase">æ¨¡ç³Š</button>
            <button onclick="handleLearn(3)" class="py-6 bg-indigo-600 text-white rounded-3xl font-black text-[10px] shadow-lg uppercase">è®¤è¯†</button>
        </div>
    </section>

    <div id="settings-overlay" onclick="toggleSidebar(false)" class="fixed inset-0 bg-slate-900/60 backdrop-blur-md z-[300] hide"></div>
    <aside id="settings-sidebar" class="fixed top-0 right-0 h-full w-80 bg-white dark:bg-slate-900 z-[301] p-10 flex flex-col shadow-2xl">
        <div class="mb-10 flex items-center gap-4">
            <div class="w-16 h-16 rounded-full bg-gradient-to-tr from-indigo-500 to-purple-600 flex items-center justify-center text-white text-2xl font-black shadow-lg">M</div>
            <div>
                <h3 class="font-[900] text-lg">User_729</h3>
                <p class="text-[9px] opacity-40 font-bold tracking-widest uppercase italic text-indigo-600">é«˜çº§å£è¯‘è¯‘å‘˜</p>
            </div>
        </div>
        
        <div class="space-y-6 flex-1">
            <div class="p-6 bg-indigo-50 dark:bg-indigo-900/20 rounded-[2.5rem]">
                <div class="flex justify-between items-center mb-3">
                    <p class="text-[9px] font-black text-indigo-600 uppercase tracking-widest">å­¦ä¹ å®Œæˆåº¦</p>
                    <span class="text-xl font-black">85%</span>
                </div>
                <div class="w-full h-1.5 bg-white/50 rounded-full overflow-hidden">
                    <div class="w-[85%] h-full bg-indigo-600"></div>
                </div>
            </div>
            
            <div class="p-6 bg-slate-50 dark:bg-slate-800 rounded-[2.5rem]">
                <p class="text-[10px] font-black opacity-30 uppercase mb-4 text-center tracking-widest italic">å‘éŸ³å£éŸ³åˆ‡æ¢</p>
                <div class="flex bg-white dark:bg-slate-900 p-1.5 rounded-2xl shadow-inner">
                    <button onclick="updateAccent('us')" id="acc-us" class="flex-1 py-3 text-[10px] font-black rounded-xl transition-all">US ç¾éŸ³</button>
                    <button onclick="updateAccent('uk')" id="acc-uk" class="flex-1 py-3 text-[10px] font-black rounded-xl transition-all">UK è‹±éŸ³</button>
                </div>
            </div>
            <button onclick="toggleDarkMode()" class="w-full p-6 bg-slate-50 dark:bg-slate-800 rounded-[2.5rem] flex justify-between items-center font-bold text-xs active:scale-95">
                <span>å¤œé—´æ¨¡å¼</span><span id="mode-icon">ğŸŒ™</span>
            </button>
        </div>
    </aside>

    <nav class="fixed bottom-10 left-1/2 -translate-x-1/2 glass rounded-[2.5rem] shadow-2xl flex items-center px-10 py-5 gap-12 z-[100]">
        <button onclick="switchTab('home')" id="btn-home" class="text-2xl active-tab opacity-20">ğŸ </button>
        <button onclick="switchTab('explore')" id="btn-explore" class="text-2xl opacity-20">ğŸ”</button>
        <button onclick="switchTab('learned')" id="btn-learned" class="text-2xl opacity-20">ğŸ“</button>
        <button onclick="switchTab('books')" id="btn-books" class="text-2xl opacity-20">ğŸ“š</button>
    </nav>

    <div id="batch-bar" class="fixed bottom-32 left-6 right-6 max-w-lg mx-auto glass shadow-2xl rounded-[2.5rem] p-5 flex justify-between items-center hide z-[150] border-2 border-indigo-500/20">
        <span class="text-xs font-black text-indigo-600 ml-4 italic">å·²é€‰ <span id="selected-count" class="text-xl mx-1">0</span></span>
        <button onclick="batchRemove()" class="bg-red-500 text-white px-8 py-4 rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-lg">é‡ç½®æ‰€é€‰</button>
    </div>

    <script>
        // --- æ ¸å¿ƒæœ¯è¯­åº“ (6å¤§æ ‡ç­¾ï¼Œå„10è¯) ---
        const RAW_DATA = {
            'æ”¿æ²»': [
                {en:'Centenary Goal', zh:'ç™¾å¹´å¥‹æ–—ç›®æ ‡', d:'æŒ‡å»ºå…šä¸€ç™¾å¹´å’Œå»ºå›½ä¸€ç™¾å¹´çš„å¥‹æ–—ç›®æ ‡ã€‚'},
                {en:'Whole-process democracy', zh:'å…¨è¿‡ç¨‹äººæ°‘æ°‘ä¸»', d:'å¼ºè°ƒæ°‘ä¸»å‚ä¸çš„è¿ç»­æ€§å’Œå®Œæ•´æ€§ã€‚'},
                {en:'Dual carbon goals', zh:'åŒç¢³ç›®æ ‡', d:'æŒ‡ç¢³è¾¾å³°å’Œç¢³ä¸­å’Œç›®æ ‡ã€‚'},
                {en:'Belt and Road Initiative', zh:'ä¸€å¸¦ä¸€è·¯å€¡è®®', d:'B&Rï¼Œä¿ƒè¿›å…¨çƒäº’è”äº’é€šã€‚'},
                {en:'High-quality development', zh:'é«˜è´¨é‡å‘å±•', d:'åˆ›æ–°ã€åè°ƒã€ç»¿è‰²ã€å¼€æ”¾ã€å…±äº«ã€‚'},
                {en:'Common prosperity', zh:'å…±åŒå¯Œè£•', d:'ç¤¾ä¼šä¸»ä¹‰çš„æœ¬è´¨è¦æ±‚ã€‚'},
                {en:'Supply-side reform', zh:'ä¾›ç»™ä¾§ç»“æ„æ€§æ”¹é©', d:'æé«˜ä¾›ç»™ä½“ç³»è´¨é‡ã€‚'},
                {en:'Rural revitalization', zh:'ä¹¡æ‘æŒ¯å…´', d:'è§£å†³ä¸‰å†œé—®é¢˜çš„é‡å¤§æˆ˜ç•¥ã€‚'},
                {en:'Anti-corruption', zh:'åè…æ–—äº‰', d:'åšæŒè€è™è‹è‡ä¸€èµ·æ‰“ã€‚'},
                {en:'Institutional opening-up', zh:'åˆ¶åº¦å‹å¼€æ”¾', d:'æ¶µç›–è§„åˆ™ã€è§„åˆ¶ã€ç®¡ç†ã€æ ‡å‡†ã€‚'}
            ],
            'åœ°ç†': [
                {en:'Plateau of Tibet', zh:'é’è—é«˜åŸ', d:'ä¸–ç•Œå±‹è„Šï¼ŒRoof of the Worldã€‚'},
                {en:'Archipelago', zh:'ç¾¤å²›', d:'ç”±è®¸å¤šå²›å±¿ç»„æˆçš„é“¾çŠ¶æˆ–ç°‡çŠ¶å½¢æ€ã€‚'},
                {en:'Estuary', zh:'æ²³å£æ¹¾', d:'æ²³æµæ³¨å…¥æµ·æ´‹çš„äº¤æ±‡åœ°å¸¦ã€‚'},
                {en:'Tropic of Cancer', zh:'åŒ—å›å½’çº¿', d:'å¤ªé˜³ç›´å°„ç‚¹æœ€åŒ—çš„çº¬åº¦ã€‚'},
                {en:'Permafrost', zh:'å¤šå¹´å†»åœŸ', d:'æŒç»­ä¸¤å¹´ä»¥ä¸Šå¤„äºå†»ç»“çŠ¶æ€ã€‚'},
                {en:'Meandering river', zh:'èœ¿èœ’æ²³æµ', d:'æ›²æŠ˜èœ¿èœ’ï¼Œç±»ä¼¼è›‡å½¢æµåŠ¨çš„æ²³æµã€‚'},
                {en:'Continental shelf', zh:'å¤§é™†æ¶', d:'é™†åœ°å‘æµ·æ´‹å»¶ä¼¸çš„å¹³ç¼“åœ°å¸¦ã€‚'},
                {en:'Biodiversity hotspot', zh:'ç”Ÿç‰©å¤šæ ·æ€§çƒ­ç‚¹', d:'ç‰©ç§æå…¶ä¸°å¯Œä¸”é¢ä¸´å¨èƒã€‚'},
                {en:'Watershed', zh:'åˆ†æ°´å²­', d:'æ’æ°´ç³»ç»Ÿçš„åˆ†ç•Œçº¿ã€‚'},
                {en:'Geothermal energy', zh:'åœ°çƒ­èƒ½', d:'æ¥è‡ªåœ°çƒå†…éƒ¨çš„çƒ­èƒ½ã€‚'}
            ],
            'ä¿—è¯­': [
                {en:'Great minds think alike', zh:'è‹±é›„æ‰€è§ç•¥åŒ', d:'ä¼˜ç§€çš„äººæƒ³æ³•å¾€å¾€ç›¸ä¼¼ã€‚'},
                {en:'Blessing in disguise', zh:'å¡ç¿å¤±é©¬', d:'ä¸å¹¸ä¸­éšè—ç€å¥½è¿ã€‚'},
                {en:'Burn the midnight oil', zh:'æŒ‘ç¯å¤œè¯»', d:'å½¢å®¹å·¥ä½œæˆ–å­¦ä¹ åˆ°æ·±å¤œã€‚'},
                {en:'Cry over spilt milk', zh:'è¦†æ°´éš¾æ”¶', d:'ä¸ºæ— æ³•æŒ½å›çš„é”™è¯¯æ‚²ä¼¤æ— ç›Šã€‚'},
                {en:'Kill two birds', zh:'ä¸€çŸ³äºŒé¸Ÿ', d:'ä¸€ä¸¾ä¸¤å¾—ã€‚'},
                {en:'Look before you leap', zh:'ä¸‰æ€è€Œåè¡Œ', d:'è¡ŒåŠ¨å‰ä»”ç»†è€ƒè™‘ã€‚'},
                {en:'Piece of cake', zh:'å°èœä¸€ç¢Ÿ', d:'å½¢å®¹æå…¶å®¹æ˜“çš„äº‹æƒ…ã€‚'},
                {en:'Under the weather', zh:'èº«ä½“ä¸é€‚', d:'æŒ‡æ„Ÿåˆ°ç”Ÿç—…æˆ–ä¸èˆ’æœã€‚'},
                {en:'The last straw', zh:'æœ€åä¸€æ ¹ç¨»è‰', d:'å‹æ­»éª†é©¼çš„æœ€åä¸€ç‚¹è´Ÿæ‹…ã€‚'},
                {en:'Bite the bullet', zh:'å’¬ç´§ç‰™å…³', d:'å‹‡æ•¢é¢å¯¹å›°éš¾æˆ–ç—›è‹¦ã€‚'}
            ],
            'æ–‡åŒ–': [
                {en:'Intangible Heritage', zh:'éç‰©è´¨æ–‡åŒ–é—äº§', d:'ä»£ä»£ç›¸ä¼ çš„éç‰©è´¨å½¢å¼é—äº§ã€‚'},
                {en:'Cultural Soft Power', zh:'æ–‡åŒ–è½¯å®åŠ›', d:'ä¸€ä¸ªå›½å®¶æ–‡åŒ–å¸å¼•åŠ›çš„ä½“ç°ã€‚'},
                {en:'Confucianism', zh:'å„’å®¶æ€æƒ³', d:'ä»¥å­”å­ä¸ºä»£è¡¨çš„ä¼ ç»Ÿæ€æƒ³ã€‚'},
                {en:'Symbolism', zh:'è±¡å¾ä¸»ä¹‰', d:'åˆ©ç”¨äº‹ç‰©è¡¨è¾¾ç‰¹å®šæƒ…æ„Ÿã€‚'},
                {en:'Etiquette', zh:'ç¤¼ä»ª', d:'ç¤¾ä¼šäº¤å¾€ä¸­åº”éµå®ˆçš„è§„èŒƒã€‚'},
                {en:'Folklore', zh:'æ°‘ä¿—', d:'æµä¼ äºæ°‘é—´çš„ä¼ è¯´å’Œä¹ ä¿—ã€‚'},
                {en:'Cross-cultural', zh:'è·¨æ–‡åŒ–äº¤é™…', d:'ä¸åŒèƒŒæ™¯äººä¹‹é—´çš„äº¤æµã€‚'},
                {en:'Aesthetic value', zh:'å®¡ç¾ä»·å€¼', d:'è‰ºæœ¯å“å¸¦æ¥çš„ç¾æ„Ÿä½“éªŒã€‚'},
                {en:'Calligraphy', zh:'ä¹¦æ³•', d:'æ±‰å­—ä¹¦å†™çš„è‰ºæœ¯ã€‚'},
                {en:'Appropriation', zh:'æ–‡åŒ–æŒªç”¨', d:'åœ¨ä¸å°Šé‡èƒŒæ™¯æ—¶å€Ÿç”¨å…ƒç´ ã€‚'}
            ],
            'ä½“è‚²': [
                {en:'Winter Olympics', zh:'å†¬å¥¥ä¼š', d:'æ¯å››å¹´ä¸¾åŠä¸€æ¬¡ã€‚'},
                {en:'Grand Slam', zh:'å¤§æ»¡è´¯', d:'ç½‘çƒæˆ–é«˜å°”å¤«çš„æœ€é«˜æˆå°±ã€‚'},
                {en:'Marathon', zh:'é©¬æ‹‰æ¾', d:'é•¿è·‘è¿åŠ¨ã€‚'},
                {en:'Anti-doping', zh:'åå…´å¥‹å‰‚', d:'ç»´æŠ¤ç«æŠ€ä½“è‚²å…¬å¹³ã€‚'},
                {en:'Paralympics', zh:'æ®‹å¥¥ä¼š', d:'ä¸ºæ®‹éšœè¿åŠ¨å‘˜ä¸¾åŠã€‚'},
                {en:'VAR', zh:'è§†é¢‘åŠ©ç†è£åˆ¤', d:'è¶³çƒè¾…åŠ©å›æ”¾æŠ€æœ¯ã€‚'},
                {en:'Esports', zh:'ç”µå­ç«æŠ€', d:'å¯¹æŠ—æ€§ç”µå­æ¸¸æˆæ¯”èµ›ã€‚'},
                {en:'Triathlon', zh:'é“äººä¸‰é¡¹', d:'æ¸¸æ³³ã€è‡ªè¡Œè½¦ã€è·‘æ­¥ã€‚'},
                {en:'Seeding', zh:'ç§å­é€‰æ‰‹', d:'æ ¹æ®æˆç»©æ’å®šçš„ä½æ¬¡ã€‚'},
                {en:'Stadium legacy', zh:'åœºé¦†é—äº§', d:'èµ›ååœºé¦†åˆ©ç”¨ã€‚'}
            ],
            'å®—æ•™': [
                {en:'Theology', zh:'ç¥å­¦', d:'å…³äºå®—æ•™ä¿¡ä»°çš„ç ”ç©¶ã€‚'},
                {en:'Pilgrimage', zh:'æœåœ£', d:'å‰å¾€åœ£åœ°çš„æ—…è¡Œã€‚'},
                {en:'Doctrine', zh:'æ•™ä¹‰', d:'å®—æ•™ä¸­æ¥å—çš„æ•™å¯¼ã€‚'},
                {en:'Polytheism', zh:'å¤šç¥æ•™', d:'ä¿¡ä»°å¤šä¸ªç¥æ˜ã€‚'},
                {en:'Monasticism', zh:'ä¿®é“ç”Ÿæ´»', d:'è‡´åŠ›äºç²¾ç¥ä¿®è¡Œã€‚'},
                {en:'Scripture', zh:'ç»æ–‡', d:'ç¥åœ£åœ°ä½çš„æ–‡æœ¬ã€‚'},
                {en:'Liturgy', zh:'ç¤¼æ‹œä»ªå¼', d:'æ­£å¼ç¨‹åºã€‚'},
                {en:'Buddhism', zh:'ä½›æ•™', d:'ä¸–ç•Œä¸‰å¤§å®—æ•™ä¹‹ä¸€ã€‚'},
                {en:'Secularization', zh:'ä¸–ä¿—åŒ–', d:'å½±å“åŠ›ä»ç¤¾ä¼šé€€å´ã€‚'},
                {en:'Iconography', zh:'å›¾åƒå¿—', d:'ç¬¦å·å’Œè±¡å¾çš„ç ”ç©¶ã€‚'}
            ]
        };

        // --- æ ¸å¿ƒé€»è¾‘å˜é‡ ---
        let state = {
            mem: JSON.parse(localStorage.getItem('lexi_v176_mem') || '{}'),
            books: JSON.parse(localStorage.getItem('lexi_v176_books') || 'null'),
            accent: localStorage.getItem('lexi_v176_accent') || 'us',
            isDark: localStorage.getItem('lexi_v176_dark') === 'true',
            viewingBook: null, queue: [], idx: 0, editMode: false, selectedItems: new Set()
        };

        // åˆå§‹åŒ–æ•°æ®æ³¨å…¥
        if(!state.books) {
            state.books = {};
            const cols = ['from-indigo-600 to-indigo-800', 'from-rose-500 to-rose-700', 'from-emerald-600 to-emerald-800', 'from-amber-500 to-amber-700', 'from-sky-600 to-sky-800', 'from-violet-600 to-violet-800'];
            Object.keys(RAW_DATA).forEach((key, i) => {
                state.books[key] = { id: 'bk_'+i, color: cols[i], items: RAW_DATA[key].map((item, idx) => ({...item, id: `item_${i}_${idx}`})) };
            });
            save();
        }

        function init() {
            if(state.isDark) document.body.classList.add('dark');
            updateAccentUI();
            updateDashboard();
            switchTab('home');
            window.speechSynthesis.getVoices();
        }

        function save() {
            localStorage.setItem('lexi_v176_mem', JSON.stringify(state.mem));
            localStorage.setItem('lexi_v176_books', JSON.stringify(state.books));
            localStorage.setItem('lexi_v176_accent', state.accent);
            localStorage.setItem('lexi_v176_dark', state.isDark);
        }

        // --- é«˜çº§ TTS å‘éŸ³é€»è¾‘ ---
        function speakCurrent() {
            const item = state.queue[state.idx];
            if(!item) return;
            window.speechSynthesis.cancel();
            const msg = new SpeechSynthesisUtterance(item.en);
            const lang = state.accent === 'us' ? 'en-US' : 'en-GB';
            const voices = window.speechSynthesis.getVoices();
            const highQuality = voices.find(v => v.lang.startsWith(lang) && (v.name.includes('Google') || v.name.includes('Natural') || v.name.includes('Samantha') || v.name.includes('Daniel')));
            msg.voice = highQuality || voices.find(v => v.lang.startsWith(lang)) || voices[0];
            msg.rate = 0.9;
            window.speechSynthesis.speak(msg);
        }

        // --- è§†å›¾è·¯ç”± ---
        function switchTab(t) {
            ['home','explore','learned','books','import','book-detail'].forEach(v => document.getElementById('view-'+v)?.classList.add('hide'));
            document.getElementById('view-'+t).classList.remove('hide');
            document.querySelectorAll('nav button').forEach(b => b.classList.add('opacity-20'));
            const navId = (['books','book-detail','import'].includes(t)) ? 'btn-books' : 'btn-'+t;
            document.getElementById(navId)?.classList.add('active-tab');
            document.getElementById(navId)?.classList.remove('opacity-20');
            
            if(t === 'books') renderBookshelf();
            if(t === 'book-detail') renderBookDetail();
            if(t === 'import') populateImportSelect();
            if(t === 'learned') renderLearned();
            if(t === 'explore') renderExplore();
        }

        // --- è¯ä¹¦è¯¦æƒ…ä¸åˆ é™¤é€»è¾‘ ---
        function renderBookshelf() {
            document.getElementById('bookshelf-list').innerHTML = Object.keys(state.books).map(k => `
                <div onclick="openBookDetail('${k}')" class="relative aspect-[4/5] rounded-r-[3.5rem] rounded-l-xl bg-gradient-to-br ${state.books[k].color} text-white p-8 flex flex-col justify-between shadow-lg cursor-pointer transform active:scale-95 transition-all">
                    <div class="border-l-4 border-white/30 pl-4">
                        <p class="text-[9px] opacity-70 font-black tracking-widest uppercase">${state.books[k].items.length} è¯æ¡</p>
                        <h3 class="font-[900] text-xl mt-2 serif">${k}</h3>
                    </div>
                </div>
            `).join('');
        }

        function renderBookDetail() {
            const b = state.viewingBook;
            if(!b) return;
            document.getElementById('detail-book-name').innerText = b;
            const items = [...state.books[b].items].sort((a,b) => a.en.localeCompare(b.en));
            document.getElementById('book-items-list').innerHTML = items.map(i => `
                <div class="bg-white dark:bg-slate-800 p-6 rounded-[2.5rem] shadow-sm flex justify-between items-center group">
                    <div class="flex-1">
                        <h4 class="text-sm font-black text-indigo-600">${i.en}</h4>
                        <p class="text-[11px] opacity-50 serif mt-1">${i.zh}</p>
                    </div>
                    <button onclick="deleteItem('${b}','${i.id}')" class="w-10 h-10 rounded-full bg-red-50 text-red-500 opacity-0 group-hover:opacity-100 transition-all flex items-center justify-center">âœ•</button>
                </div>
            `).join('');
        }

        function deleteItem(bn, id) {
            if(confirm('ç¡®å®šæ°¸ä¹…åˆ é™¤è¯¥è¯æ¡ï¼Ÿ')) {
                state.books[bn].items = state.books[bn].items.filter(i => i.id !== id);
                if(state.mem[id]) delete state.mem[id];
                save(); renderBookDetail(); updateDashboard();
            }
        }

        // --- æœç´¢å±•å¼€äº¤äº’é€»è¾‘ ---
        function renderExplore() {
            const query = document.getElementById('search-input').value.toLowerCase();
            let all = []; Object.keys(state.books).forEach(k => all.push(...state.books[k].items.map(i => ({...i, bookName: k}))));
            const filtered = all.filter(i => i.en.toLowerCase().includes(query) || i.zh.includes(query) || (i.d && i.d.includes(query)));
            
            document.getElementById('explore-list').innerHTML = filtered.map(i => `
                <div onclick="this.classList.toggle('expanded')" class="explore-item bg-white dark:bg-slate-800 p-6 rounded-[2.5rem] shadow-sm cursor-pointer overflow-hidden ring-1 ring-slate-100 dark:ring-slate-700">
                    <div class="flex justify-between items-center">
                        <div class="flex-1">
                            <span class="text-[7px] font-black text-indigo-500 bg-indigo-50 dark:bg-indigo-900/30 px-2 py-0.5 rounded uppercase tracking-tighter">${i.bookName}</span>
                            <h4 class="font-black text-slate-800 dark:text-slate-200 text-lg mt-1">${i.en}</h4>
                            <p class="text-xs opacity-60 mt-1 serif">${i.zh}</p>
                        </div>
                        <div class="text-xs opacity-20 transition-transform arrow">â–¼</div>
                    </div>
                    <div class="item-detail-panel hide mt-4 pt-4 border-t border-slate-50 dark:border-slate-700">
                        <p class="text-[11px] serif leading-relaxed opacity-70 italic">ç¬”è®°ï¼š${i.d || 'æ— é¢å¤–ç¬”è®°'}</p>
                    </div>
                </div>
            `).join('');
        }

        // --- å­¦ä¹  & SRS ç³»ç»Ÿ ---
        function startStudy(mode) {
            let list = [];
            Object.keys(state.books).forEach(k => {
                const sub = (mode==='new') 
                    ? state.books[k].items.filter(i => !state.mem[i.id] || state.mem[i.id].lv === 0).slice(0, 20)
                    : state.books[k].items.filter(i => state.mem[i.id]?.lv > 0 && state.mem[i.id].lv < 5 && Date.now() >= state.mem[i.id].next);
                list.push(...sub.map(i => ({...i, bookTag: k})));
            });
            if(!list.length) return alert("æš‚æ— ä»»åŠ¡ï¼Œä¼‘æ¯ä¸€ä¸‹å§ï¼");
            state.queue = list.sort(() => Math.random() - 0.5); 
            state.idx = 0;
            document.getElementById('study-layer').classList.remove('hide');
            renderCard();
        }

        function renderCard() {
            const item = state.queue[state.idx];
            const main = document.getElementById('studyCardMain');
            main.classList.remove('flipped');
            document.getElementById('card-en').innerText = item.en;
            document.getElementById('card-zh').innerText = item.zh;
            document.getElementById('card-d').innerText = item.d || 'ï¼ˆæ— ç¬”è®°ï¼‰';
            document.getElementById('study-progress').innerText = `${state.idx+1} / ${state.queue.length}`;
            document.getElementById('study-book-tag').innerText = item.bookTag;
        }

        function handleLearn(score) {
            const id = state.queue[state.idx].id;
            if(!state.mem[id]) state.mem[id] = { lv: 0, next: 0 };
            const m = state.mem[id];
            if(score === 3) m.lv++; else if(score === 1) m.lv = Math.max(0, m.lv - 1);
            m.next = Date.now() + ([0, 2, 1440, 4320, 10080][Math.min(m.lv, 4)] * 60000);
            save(); state.idx++;
            if(state.idx < state.queue.length) renderCard(); else closeStudy();
        }

        // --- å½’æ¡£ã€å¯¼å…¥ã€åŒæ­¥ ---
        function renderLearned() {
            let list = [];
            Object.values(state.books).forEach(b => list.push(...b.items.filter(i => state.mem[i.id]?.lv >= 5)));
            document.getElementById('learned-list').innerHTML = list.length ? list.map(i => `
                <div onclick="handleSelect('${i.id}')" class="bg-white dark:bg-slate-800 p-6 rounded-[2rem] flex justify-between items-center border-2 ${state.selectedItems.has(i.id)?'border-indigo-600 shadow-md':'border-transparent'}">
                    <div><h5 class="text-sm font-black">${i.en}</h5><p class="text-[10px] opacity-30 serif">${i.zh}</p></div>
                    <span class="text-[8px] font-black bg-emerald-50 text-emerald-600 px-3 py-1.5 rounded-full uppercase">Archived</span>
                </div>
            `).join('') : '<p class="text-center opacity-20 py-24 font-black italic">ï¼ˆç©ºï¼‰</p>';
        }

        function populateImportSelect() {
            const sel = document.getElementById('import-book-select');
            sel.innerHTML = Object.keys(state.books).map(k => `<option value="${k}">${k}</option>`).join('');
        }

        function handleManualImport() {
            const en = document.getElementById('in-en').value.trim();
            const zh = document.getElementById('in-zh').value.trim();
            const bn = document.getElementById('import-book-select').value;
            if(!en || !zh) return alert("å¿…å¡«é¡¹ç¼ºå¤±");
            state.books[bn].items.push({ id:'item_'+Date.now(), en, zh, d:document.getElementById('in-d').value.trim() });
            save(); alert('å·²ä¿å­˜');
            ['in-en','in-zh','in-d'].forEach(id => document.getElementById(id).value='');
            updateDashboard();
        }

        function updateDashboard() {
            let n = 0, r = 0;
            Object.values(state.books).forEach(b => {
                n += b.items.filter(i => !state.mem[i.id] || state.mem[i.id].lv === 0).length;
                r += b.items.filter(i => state.mem[i.id]?.lv > 0 && state.mem[i.id].lv < 5 && Date.now() >= state.mem[i.id].next).length;
            });
            document.getElementById('num-new').innerText = n;
            document.getElementById('num-review').innerText = r;
        }

        function updateAccentUI() {
            document.getElementById('acc-us').className = `flex-1 py-3 text-[10px] font-black rounded-xl ${state.accent==='us'?'bg-indigo-600 text-white shadow-md':'opacity-20'}`;
            document.getElementById('acc-uk').className = `flex-1 py-3 text-[10px] font-black rounded-xl ${state.accent==='uk'?'bg-indigo-600 text-white shadow-md':'opacity-20'}`;
        }

        function toggleDarkMode() { state.isDark = !state.isDark; document.body.classList.toggle('dark', state.isDark); save(); }
        function toggleSidebar(s) { document.getElementById('settings-sidebar').classList.toggle('open', s); document.getElementById('settings-overlay').classList.toggle('hide', !s); }
        function closeStudy() { document.getElementById('study-layer').classList.add('hide'); updateDashboard(); }
        function openBookDetail(k) { state.viewingBook = k; switchTab('book-detail'); }
        function updateAccent(a) { state.accent = a; save(); updateAccentUI(); }
        function toggleEditMode() { state.editMode = !state.editMode; state.selectedItems.clear(); document.getElementById('batch-bar').classList.toggle('hide', !state.editMode); renderLearned(); }
        function handleSelect(id) { if(!state.editMode) return; state.selectedItems.has(id)?state.selectedItems.delete(id):state.selectedItems.add(id); document.getElementById('selected-count').innerText = state.selectedItems.size; renderLearned(); }
        function batchRemove() { if(confirm('é‡ç½®é€‰ä¸­é¡¹è¿›åº¦ï¼Ÿ')) { state.selectedItems.forEach(id => state.mem[id] = {lv:0, next:0}); state.editMode=false; save(); renderLearned(); updateDashboard(); document.getElementById('batch-bar').classList.add('hide'); } }

        // CSS å±•å¼€æ’ä»¶
        const style = document.createElement('style');
        style.textContent = `.expanded .item-detail-panel { display: block !important; } .expanded .arrow { transform: rotate(180deg); }`;
        document.head.appendChild(style);

        init();
    </script>
</body>
</html>
