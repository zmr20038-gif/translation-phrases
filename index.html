<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LexiFlow Pro v3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #F8FAFC;
            --card-legal: #F0F7FF;
            --card-gaming: #F0FFF4;
            --card-food: #FFF5F5;
            --accent: #6366F1;
        }
        body { background-color: var(--bg); font-family: 'Plus Jakarta Sans', sans-serif; transition: all 0.5s ease; }
        
        /* å­¦ä¹ å¡ç‰‡ç¿»è½¬æ•ˆæœ */
        .flip-card { perspective: 1000px; width: 100%; height: 400px; }
        .flip-card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; cursor: pointer; }
        .flip-card.flipped .flip-card-inner { transform: rotateY(180deg); }
        .flip-card-front, .flip-card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 3rem; padding: 2rem; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.05); }
        .flip-card-back { transform: rotateY(180deg); background: white; border: 2px solid var(--accent); }
        
        /* åº•éƒ¨å¯¼èˆªæ¿€æ´»æ€ */
        .nav-link.active { color: var(--accent); }
        .nav-link.active::after { content: ''; display: block; width: 5px; height: 5px; background: var(--accent); border-radius: 50%; margin: 2px auto; }
        
        .hide { display: none !important; }
    </style>
</head>
<body class="pb-24">

    <header class="max-w-md mx-auto px-6 pt-12 flex justify-between items-end">
        <div>
            <h1 class="text-4xl font-[800] tracking-tighter text-slate-900">LexiFlow</h1>
            <p id="subTitle" class="text-[10px] font-black opacity-30 uppercase tracking-[0.3em]">Smart Learning</p>
        </div>
        <button onclick="resetData()" class="text-xs opacity-20 font-bold uppercase">Reset</button>
    </header>

    <main id="view-home" class="max-w-md mx-auto px-6 mt-10">
        <div class="grid grid-cols-2 gap-4 mb-8">
            <div onclick="openStudy('new')" class="bg-white p-6 rounded-[2.5rem] shadow-sm border border-slate-100 cursor-pointer active:scale-95 transition-all">
                <span class="text-[9px] font-black opacity-30 uppercase tracking-widest">éœ€å­¦ä¹  New</span>
                <p id="num-new" class="text-4xl font-black mt-2 text-indigo-600">0</p>
            </div>
            <div onclick="openStudy('review')" class="bg-white p-6 rounded-[2.5rem] shadow-sm border border-slate-100 cursor-pointer active:scale-95 transition-all">
                <span class="text-[9px] font-black opacity-30 uppercase tracking-widest">å¤ä¹  Review</span>
                <p id="num-review" class="text-4xl font-black mt-2 text-emerald-500">0</p>
            </div>
        </div>
        
        <div class="bg-indigo-600 p-8 rounded-[3rem] text-white shadow-xl shadow-indigo-100">
            <h3 class="font-black text-sm opacity-60 uppercase tracking-widest mb-4">ä»Šæ—¥æ ¼è¨€</h3>
            <p class="text-xl font-bold leading-tight italic">"The limit of your language is the limit of your world."</p>
        </div>
    </main>

    <main id="view-explore" class="max-w-md mx-auto px-6 mt-8 hide">
        <div class="flex gap-2 mb-6 overflow-x-auto pb-2 no-scrollbar">
            <button onclick="setFilter('all')" class="filter-btn px-6 py-2 bg-white rounded-full text-xs font-bold shadow-sm border border-slate-100">å…¨éƒ¨</button>
            <button onclick="setFilter('legal')" class="filter-btn px-6 py-2 bg-white rounded-full text-xs font-bold shadow-sm border border-slate-100">âš–ï¸ æ³•å¾‹</button>
            <button onclick="setFilter('gaming')" class="filter-btn px-6 py-2 bg-white rounded-full text-xs font-bold shadow-sm border border-slate-100">ğŸ® æ¸¸æˆ</button>
            <button onclick="setFilter('food')" class="filter-btn px-6 py-2 bg-white rounded-full text-xs font-bold shadow-sm border border-slate-100">ğŸ³ é£Ÿç‰©</button>
        </div>
        <div id="explore-list" class="space-y-4"></div>
    </main>

    <section id="study-layer" class="fixed inset-0 bg-white z-[200] hide flex flex-col p-8">
        <div class="flex justify-between items-center mb-10">
            <button onclick="closeStudy()" class="text-2xl font-light text-slate-400">âœ•</button>
            <div id="study-progress" class="text-[10px] font-black opacity-30 tracking-widest">1 / 10</div>
            <div class="w-6"></div>
        </div>

        <div class="flex-1 flex items-center justify-center">
            <div class="flip-card" id="mainCard">
                <div class="flip-card-inner" onclick="this.parentElement.classList.toggle('flipped')">
                    <div class="flip-card-front bg-slate-50 border border-slate-100">
                        <span id="card-cat" class="text-[10px] font-black opacity-20 uppercase tracking-widest mb-4">CATEGORY</span>
                        <h2 id="card-en" class="text-4xl font-black tracking-tighter text-slate-800">Term</h2>
                        <p class="mt-8 text-[10px] font-bold opacity-30 animate-pulse">ç‚¹å‡»ç¿»è½¬æŸ¥çœ‹é‡Šä¹‰</p>
                    </div>
                    <div class="flip-card-back">
                        <h3 id="card-zh" class="text-2xl font-bold text-indigo-600 mb-4">ä¸­æ–‡ç¿»è¯‘</h3>
                        <p id="card-d" class="text-sm text-slate-400 leading-relaxed px-4 text-center">è¯¦ç»†çš„å­¦æœ¯æˆ–ä¸“ä¸šè§£é‡Š...</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-3 gap-3 mt-10">
            <button onclick="handleLearn(1)" class="py-5 bg-slate-100 rounded-3xl font-bold text-slate-500 text-xs">å¿˜è®°</button>
            <button onclick="handleLearn(2)" class="py-5 bg-indigo-50 rounded-3xl font-bold text-indigo-400 text-xs">æ¨¡ç³Š</button>
            <button onclick="handleLearn(3)" class="py-5 bg-indigo-600 rounded-3xl font-bold text-white text-xs shadow-lg shadow-indigo-100">è®¤è¯†</button>
        </div>
    </section>

    <nav class="fixed bottom-6 left-1/2 -translate-x-1/2 w-64 h-20 bg-white/90 backdrop-blur-md rounded-[2.5rem] shadow-2xl flex items-center justify-around border border-slate-100 z-[100]">
        <button onclick="switchTab('home')" id="btn-home" class="nav-link flex flex-col items-center active">
            <span class="text-xl">ğŸ“–</span><span class="text-[8px] font-black uppercase mt-1">Learn</span>
        </button>
        <button onclick="switchTab('explore')" id="btn-explore" class="nav-link flex flex-col items-center text-slate-300">
            <span class="text-xl">ğŸ”</span><span class="text-[8px] font-black uppercase mt-1">Explore</span>
        </button>
    </nav>

    <script>
        // 1. è¯åº“ï¼ˆè‡ªåŠ¨æŒ‰å­—æ¯ A-Z æ’åºï¼‰
        const RAW_LIB = [
            { id:'l1', cat:'legal', en:'Bona Fide', zh:'å–„æ„ï¼›è¯šå®åœ°', d:'æŒ‡å½“äº‹äººåœ¨è¿›è¡Œæ³•å¾‹è¡Œä¸ºæ—¶ï¼Œä¸»è§‚ä¸Šå‡ºäºçœŸè¯šã€æ²¡æœ‰æ¬ºè¯ˆæ„å›¾ã€‚' },
            { id:'l2', cat:'legal', en:'Force Majeure', zh:'ä¸å¯æŠ—åŠ›', d:'åˆåŒå…è´£æ¡æ¬¾ï¼ŒæŒ‡ä¸èƒ½é¢„è§ã€é¿å…å¹¶å…‹æœçš„å®¢è§‚æƒ…å†µã€‚' },
            { id:'l3', cat:'legal', en:'Due Diligence', zh:'å°½èŒè°ƒæŸ¥', d:'ç­¾ç½²åè®®å‰ï¼Œå¯¹èµ„äº§ã€è´¢åŠ¡åŠæ³•å¾‹é£é™©çš„å…¨é¢è¯„ä¼°ã€‚' },
            { id:'g1', cat:'gaming', en:'Aggro', zh:'ä»‡æ¨å€¼', d:'è¡¡é‡æ€ªç‰©å¯¹ä¸åŒç©å®¶æ”»å‡»æ¬²æœ›çš„æ•°å€¼ã€‚' },
            { id:'g2', cat:'gaming', en:'Fog of War', zh:'æˆ˜äº‰è¿·é›¾', d:'æ¸¸æˆä¸­ç”¨äºé®è”½æœªæ¢ç´¢åŒºåŸŸçš„è§†è§‰æ•ˆæœã€‚' },
            { id:'f1', cat:'food', en:'Al Dente', zh:'å¼¹ç‰™', d:'å½¢å®¹æ„é¢æˆ–ç±³é¥­ç…®å¾—æ°åˆ°å¥½å¤„ï¼Œä¸­å¿ƒå¤„ä¿ç•™ä¸€ä¸åš¼åŠ²ã€‚' },
            { id:'f2', cat:'food', en:'Maillard Reaction', zh:'ç¾æ‹‰å¾·ååº”', d:'é£Ÿç‰©åŠ çƒ­æ—¶å‘ç”Ÿçš„è¤å˜ï¼Œæ˜¯é¦™æ°”äº§ç”Ÿçš„æ ¸å¿ƒã€‚' },
            { id:'l4', cat:'legal', en:'Statute of Limitations', zh:'è¯‰è®¼æ—¶æ•ˆ', d:'æ³•å¾‹è§„å®šæƒåˆ©äººè¡Œä½¿è¯·æ±‚æƒçš„æ—¶é—´é™åˆ¶ã€‚' },
            { id:'g3', cat:'gaming', en:'Metagame', zh:'å…ƒæ¸¸æˆ', d:'å½“å‰ç‰ˆæœ¬ä¸­æœ€æµè¡Œã€æœ€é«˜æ•ˆçš„æˆ˜æœ¯ç»„åˆã€‚' },
            { id:'f3', cat:'food', en:'Umami', zh:'é²œå‘³', d:'é™¤äº†é…¸ç”œè‹¦å’¸ä¹‹å¤–çš„ç¬¬äº”ç§åŸºæœ¬å‘³é“ã€‚' }
        ].sort((a,b) => a.en.localeCompare(b.en));

        // 2. çŠ¶æ€ç®¡ç†
        let state = {
            mem: JSON.parse(localStorage.getItem('lexi_v3_mem') || '{}'),
            filter: 'all',
            currentQueue: [],
            currentIndex: 0
        };

        // 3. æ ¸å¿ƒåŠŸèƒ½ï¼šåˆ‡æ¢è§†å›¾
        function switchTab(tab) {
            document.getElementById('view-home').classList.toggle('hide', tab !== 'home');
            document.getElementById('view-explore').classList.toggle('hide', tab !== 'explore');
            document.getElementById('btn-home').classList.toggle('active', tab === 'home');
            document.getElementById('btn-explore').classList.toggle('active', tab === 'explore');
            document.getElementById('btn-home').classList.toggle('text-slate-300', tab !== 'home');
            document.getElementById('btn-explore').classList.toggle('text-slate-300', tab !== 'explore');
            if(tab === 'explore') renderExplore();
        }

        // 4. æ¢ç´¢é¡µï¼šåˆ†ç±»ä¸æ’åº
        function setFilter(cat) {
            state.filter = cat;
            renderExplore();
        }

        function renderExplore() {
            const container = document.getElementById('explore-list');
            const filtered = RAW_LIB.filter(i => state.filter === 'all' || i.cat === state.filter);
            
            container.innerHTML = filtered.map(i => `
                <div class="bg-white p-6 rounded-[2rem] border border-slate-50 flex justify-between items-center shadow-sm">
                    <div>
                        <div class="flex items-center gap-2 mb-1">
                            <span class="text-xs font-black uppercase text-slate-300">${i.cat}</span>
                            <h4 class="text-lg font-black text-slate-800">${i.en}</h4>
                        </div>
                        <p class="text-sm font-medium text-slate-400">${i.zh}</p>
                    </div>
                    ${state.mem[i.id] ? 'âœ…' : `<button onclick="addToPlan('${i.id}')" class="bg-indigo-50 text-indigo-600 text-[10px] font-black px-4 py-2 rounded-full">ADD</button>`}
                </div>
            `).join('');
        }

        function addToPlan(id) {
            if(!state.mem[id]) {
                state.mem[id] = { lv: 0, next: Date.now() };
                save();
                renderExplore();
                updateHomeCounts();
            }
        }

        // 5. å­¦ä¹ ç³»ç»Ÿï¼šè‰¾å®¾æµ©æ–¯é€»è¾‘
        function openStudy(type) {
            const now = Date.now();
            if(type === 'new') {
                // æ‰¾å‡ºå·²æ·»åŠ ä½† lv ä¸º 0 çš„
                state.currentQueue = RAW_LIB.filter(i => state.mem[i.id] && state.mem[i.id].lv === 0);
            } else {
                // æ‰¾å‡º lv > 0 ä¸”åˆ°è¾¾å¤ä¹ æ—¶é—´çš„
                state.currentQueue = RAW_LIB.filter(i => {
                    const m = state.mem[i.id];
                    return m && m.lv > 0 && now >= m.next;
                });
            }

            if(state.currentQueue.length === 0) return alert("å½“å‰æ²¡æœ‰å¾…å¤„ç†çš„è¯æ¡å“¦ï¼");
            
            state.currentIndex = 0;
            document.getElementById('study-layer').classList.remove('hide');
            showStudyCard();
        }

        function showStudyCard() {
            const item = state.currentQueue[state.currentIndex];
            document.getElementById('mainCard').classList.remove('flipped');
            document.getElementById('card-en').innerText = item.en;
            document.getElementById('card-zh').innerText = item.zh;
            document.getElementById('card-d').innerText = item.d;
            document.getElementById('card-cat').innerText = item.cat;
            document.getElementById('study-progress').innerText = `${state.currentIndex + 1} / ${state.currentQueue.length}`;
        }

        function handleLearn(score) {
            const item = state.currentQueue[state.currentIndex];
            const m = state.mem[item.id];
            
            // è‰¾å®¾æµ©æ–¯ç®—æ³•çº§åˆ«ï¼š0-8
            if(score === 3) m.lv += 1; // è®¤è¯†ï¼šå‡ä¸€çº§
            if(score === 1) m.lv = Math.max(1, m.lv - 1); // å¿˜è®°ï¼šé™ä¸€çº§
            
            // è®¡ç®—ä¸‹æ¬¡å¤ä¹ æ—¶é—´ï¼ˆå¤©ä¸ºå•ä½çš„ç®€åŒ–ç®—æ³•ï¼‰
            const intervals = [0, 0.1, 1, 2, 4, 7, 15, 30, 60]; // çº§åˆ«å¯¹åº”çš„å¤©æ•°
            const days = intervals[Math.min(m.lv, 8)];
            m.next = Date.now() + (days * 24 * 60 * 60 * 1000);

            save();
            
            state.currentIndex++;
            if(state.currentIndex < state.currentQueue.length) {
                showStudyCard();
            } else {
                closeStudy();
                alert("æœ¬ç»„å­¦ä¹ å®Œæˆï¼");
            }
        }

        function closeStudy() {
            document.getElementById('study-layer').classList.add('hide');
            updateHomeCounts();
        }

        // 6. è¾…åŠ©æ–¹æ³•
        function updateHomeCounts() {
            const now = Date.now();
            const news = RAW_LIB.filter(i => state.mem[i.id] && state.mem[i.id].lv === 0).length;
            const reviews = RAW_LIB.filter(i => {
                const m = state.mem[i.id];
                return m && m.lv > 0 && now >= m.next;
            }).length;

            document.getElementById('num-new').innerText = news;
            document.getElementById('num-review').innerText = reviews;
        }

        function save() { localStorage.setItem('lexi_v3_mem', JSON.stringify(state.mem)); }

        function resetData() {
            if(confirm("ç¡®å®šæ¸…ç©ºæ•°æ®å—ï¼Ÿ")) {
                localStorage.clear();
                location.reload();
            }
        }

        // åˆå§‹åŒ–
        updateHomeCounts();
    </script>
</body>
</html>
