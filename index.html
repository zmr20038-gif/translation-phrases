<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LexiFlow MTI v9</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700;800&family=Noto+Serif+SC:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #F8FAFC; --text: #1E293B; --card: #FFFFFF; --accent: #4F46E5; } /* MTI ç‰ˆç”¨æ›´ç¨³é‡çš„æ·±è“ */
        .dark { --bg: #0F172A; --text: #F1F5F9; --card: #1E293B; --accent: #818CF8; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Plus Jakarta Sans', sans-serif; transition: 0.3s; overflow-x: hidden; }
        .serif { font-family: 'Noto Serif SC', serif; } /* ä¸­æ–‡ç¿»è¯‘ç”¨å®‹ä½“ï¼Œæ›´æœ‰è´¨æ„Ÿ */

        /* ä¾§è¾¹æ ä¸å±‚çº§ */
        #settings-sidebar { transform: translateX(100%); transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        #settings-sidebar.open { transform: translateX(0); }

        /* å­¦ä¹ å¡ç‰‡ */
        .card-container { perspective: 1000px; width: 100%; height: 480px; position: relative; }
        .flip-card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1); transform-style: preserve-3d; }
        .flipped .flip-card-inner { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 2rem; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 2rem; background: var(--card); box-shadow: 0 10px 30px -5px rgba(0,0,0,0.08); border: 1px solid rgba(0,0,0,0.05); }
        .card-back { transform: rotateY(180deg); border: 2px solid var(--accent); overflow-y: auto; }

        .hide { display: none !important; }
        .active-tab { color: var(--accent); border-bottom: 2px solid var(--accent); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* æ‰¹é‡å‹¾é€‰æ¡† */
        .checkbox-wrapper input:checked + div { background-color: var(--accent); border-color: var(--accent); }
        .checkbox-wrapper input:checked + div svg { display: block; }
    </style>
</head>
<body class="pb-24">

    <header class="max-w-md mx-auto px-6 pt-10 flex justify-between items-center">
        <div>
            <h1 class="text-3xl font-[900] tracking-tighter italic text-slate-800 dark:text-white">Lexi<span class="text-indigo-600">MTI</span>.</h1>
            <p id="current-book-label" class="text-[10px] font-bold opacity-50 uppercase tracking-widest mt-1">å½“å‰è¯æ¡åº“ï¼š2025çƒ­è¯å…¨é›†</p>
        </div>
        <div onclick="toggleSidebar(true)" class="relative">
            <div id="header-avatar" class="w-10 h-10 rounded-full bg-slate-200 dark:bg-slate-700 overflow-hidden border-2 border-white shadow-sm flex items-center justify-center cursor-pointer">
                <span class="text-xs">ğŸ‘¤</span>
            </div>
        </div>
    </header>

    <main id="view-home" class="max-w-md mx-auto px-6 mt-8">
        <div class="grid grid-cols-2 gap-4 mb-4">
            <div onclick="openStudy('new')" class="bg-white dark:bg-slate-800 p-6 rounded-[2rem] shadow-sm active:scale-95 transition-all border-b-4 border-indigo-100 dark:border-slate-700">
                <span class="text-[9px] font-black opacity-40 uppercase tracking-widest">éœ€å­¦ä¹  New</span>
                <p id="num-new" class="text-3xl font-black mt-2 text-indigo-600">0</p>
            </div>
            <div onclick="openStudy('review')" class="bg-white dark:bg-slate-800 p-6 rounded-[2rem] shadow-sm active:scale-95 transition-all border-b-4 border-emerald-100 dark:border-slate-700">
                <span class="text-[9px] font-black opacity-40 uppercase tracking-widest">å¾…å¤ä¹  Review</span>
                <p id="num-review" class="text-3xl font-black mt-2 text-emerald-600">0</p>
            </div>
        </div>

        <div onclick="switchTab('learned')" class="bg-white dark:bg-slate-800 p-5 rounded-[2rem] shadow-sm active:scale-95 transition-all flex justify-between items-center border border-slate-100 dark:border-slate-700 mb-8">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-emerald-50 text-emerald-600 flex items-center justify-center">ğŸ“</div>
                <div>
                    <p class="text-sm font-bold">å·²æŒæ¡è¯æ¡åº“</p>
                    <p class="text-[10px] opacity-40">Learned Items</p>
                </div>
            </div>
            <p id="num-learned" class="text-xl font-black text-slate-700 dark:text-slate-300 mr-2">0</p>
        </div>

        <div class="px-2">
            <p class="text-xs font-serif text-slate-400 italic mb-1">Daily Quote</p>
            <p class="text-sm font-bold text-slate-700 dark:text-slate-200 leading-relaxed">"Translation is not a matter of words only: it is a matter of making intelligible a whole culture."</p>
            <p class="text-xs text-slate-400 mt-1">â€” Anthony Burgess</p>
        </div>
    </main>

    <main id="view-books" class="max-w-md mx-auto px-6 mt-8 hide">
        <div class="flex items-center mb-6">
            <button onclick="switchTab('home')" class="mr-4 text-xl opacity-50">â†</button>
            <h2 class="text-2xl font-black">è¯æ¡ä¹¦æ¶</h2>
        </div>
        <div class="grid grid-cols-2 gap-4">
            <div onclick="selectBook('mti2025')" class="flex flex-col gap-2 group">
                <div class="aspect-[3/4] bg-gradient-to-br from-indigo-600 to-blue-700 rounded-xl shadow-lg flex items-center justify-center p-4 text-white text-center group-active:scale-95 transition-transform">
                    <div>
                        <p class="text-xs opacity-50 mb-1">OFFICIAL</p>
                        <h3 class="font-black text-lg leading-tight">2025<br>MTIçƒ­è¯<br>å…¨é›†</h3>
                    </div>
                </div>
                <p class="text-xs font-bold text-center opacity-70">2025 MTI çƒ­è¯å…¨é›†</p>
            </div>
            <div onclick="selectBook('gov')" class="flex flex-col gap-2 group">
                <div class="aspect-[3/4] bg-slate-100 dark:bg-slate-700 rounded-xl border-2 border-dashed border-slate-300 dark:border-slate-600 flex items-center justify-center text-slate-400">
                    <span class="text-2xl">+</span>
                </div>
                <p class="text-xs font-bold text-center opacity-40">å¯¼å…¥æ›´å¤šè¯æ¡ä¹¦...</p>
            </div>
        </div>
    </main>

    <main id="view-learned" class="max-w-md mx-auto px-6 mt-8 hide h-screen flex flex-col">
        <div class="flex justify-between items-center mb-4 shrink-0">
            <h2 class="text-xl font-black">å·²æŒæ¡è¯æ¡</h2>
            <button onclick="toggleEditMode()" id="btn-edit" class="text-xs font-bold bg-slate-100 dark:bg-slate-800 px-4 py-2 rounded-full">æ‰¹é‡ç®¡ç†</button>
        </div>
        <div id="learned-list" class="flex-1 overflow-y-auto space-y-3 pb-32">
            </div>
        <div id="batch-bar" class="fixed bottom-24 left-6 right-6 bg-white dark:bg-slate-800 shadow-2xl rounded-2xl p-4 flex justify-between items-center border border-slate-100 dark:border-slate-700 hide z-[50]">
            <span class="text-xs font-bold ml-2">å·²é€‰ <span id="selected-count" class="text-indigo-600">0</span></span>
            <button onclick="moveToTrash()" class="bg-red-50 text-red-500 px-4 py-2 rounded-xl text-xs font-black flex items-center gap-2">
                <span>ğŸ—‘ï¸</span> ç§»å…¥åƒåœ¾ç®±(ä¸å†å¤ä¹ )
            </button>
        </div>
    </main>

    <main id="view-explore" class="max-w-md mx-auto px-6 mt-8 hide">
        <div class="flex gap-4 mb-6 overflow-x-auto no-scrollbar pb-2 border-b border-slate-100 dark:border-slate-800">
            <button onclick="setFilter('all')" class="cat-btn text-xs font-bold pb-2 whitespace-nowrap opacity-40 active-tab">å…¨éƒ¨</button>
            <button onclick="setFilter('pol')" class="cat-btn text-xs font-bold pb-2 whitespace-nowrap opacity-40">ğŸ›ï¸ æ”¿æ²»</button>
            <button onclick="setFilter('eco')" class="cat-btn text-xs font-bold pb-2 whitespace-nowrap opacity-40">ğŸ’° ç»è´¸</button>
            <button onclick="setFilter('env')" class="cat-btn text-xs font-bold pb-2 whitespace-nowrap opacity-40">ğŸŒ± ç¯ä¿</button>
            <button onclick="setFilter('tech')" class="cat-btn text-xs font-bold pb-2 whitespace-nowrap opacity-40">ğŸš€ ç§‘æŠ€</button>
            <button onclick="setFilter('soc')" class="cat-btn text-xs font-bold pb-2 whitespace-nowrap opacity-40">ğŸ  ç¤¾ä¼š</button>
        </div>
        <div id="explore-list" class="space-y-4 pb-24">
            </div>
    </main>

    <section id="study-layer" class="fixed inset-0 bg-white dark:bg-slate-900 z-[200] hide flex flex-col p-6">
        <div class="flex justify-between items-center mb-6">
            <button onclick="closeStudy()" class="text-2xl opacity-30">âœ•</button>
            <div class="text-[10px] font-black opacity-30 tracking-widest uppercase">MTI Review Mode</div>
            <button onclick="speakWord()" class="text-xl">ğŸ”Š</button>
        </div>
        
        <div class="flex-1 flex items-center justify-center">
            <div class="card-container" id="studyCard">
                <div class="flip-card-inner" onclick="this.parentElement.classList.toggle('flipped')">
                    <div class="card-face card-front">
                        <span id="card-cat" class="text-[9px] font-black text-indigo-500 uppercase tracking-widest mb-6 bg-indigo-50 px-2 py-1 rounded">Category</span>
                        <h2 id="card-en" class="text-3xl font-bold text-center leading-tight">Term</h2>
                        <p class="mt-12 text-[9px] opacity-30 font-bold uppercase tracking-widest">ç‚¹å‡»æŸ¥çœ‹è¯‘æ–‡</p>
                    </div>
                    <div class="card-face card-back items-start text-left px-6">
                        <h3 id="card-zh" class="text-xl font-bold text-indigo-600 mb-4 serif">ä¸­æ–‡è¯‘æ–‡</h3>
                        <div class="w-full h-[1px] bg-slate-100 mb-4"></div>
                        <p id="card-d" class="text-xs opacity-60 leading-relaxed mb-6">å®šä¹‰è§£é‡Š...</p>
                        
                        <div class="w-full bg-slate-50 dark:bg-slate-800 p-3 rounded-xl border border-slate-100 dark:border-slate-700">
                            <p class="text-[9px] font-black text-slate-400 uppercase mb-2">Context / Example</p>
                            <p id="scene-en" class="text-xs font-bold text-slate-700 dark:text-slate-300 mb-1">English sentence...</p>
                            <p id="scene-zh" class="text-[10px] text-slate-400 serif">ä¸­æ–‡ç¿»è¯‘...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="study-controls" class="grid grid-cols-3 gap-3 mt-6">
            <button onclick="handleLearn(1)" class="py-4 bg-slate-100 dark:bg-slate-800 rounded-xl font-black text-[10px] text-slate-500 uppercase">å¿˜äº†</button>
            <button onclick="handleLearn(2)" class="py-4 bg-indigo-50 dark:bg-slate-800 rounded-xl font-black text-[10px] text-indigo-400 uppercase">æ¨¡ç³Š</button>
            <button onclick="handleLearn(3)" class="py-4 bg-indigo-600 rounded-xl font-black text-[10px] text-white shadow-lg shadow-indigo-200 uppercase">è®¤è¯†</button>
        </div>
    </section>

    <div id="settings-overlay" onclick="toggleSidebar(false)" class="fixed inset-0 bg-black/10 backdrop-blur-sm z-[300] hide"></div>
    <aside id="settings-sidebar" class="fixed top-0 right-0 h-full w-80 bg-white dark:bg-slate-900 z-[301] shadow-2xl p-6 flex flex-col overflow-y-auto">
        
        <div id="user-panel" class="mb-8 p-4 bg-slate-50 dark:bg-slate-800 rounded-2xl border border-slate-100 dark:border-slate-700">
            <div id="login-view">
                <h3 class="font-bold text-lg mb-4">æ‰‹æœºå·ç™»å½•</h3>
                <input type="tel" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" class="w-full bg-white dark:bg-slate-900 p-3 rounded-xl text-xs font-bold mb-3 border border-slate-200 dark:border-slate-700 outline-none">
                <div class="flex gap-2 mb-3">
                    <input type="text" placeholder="éªŒè¯ç " class="w-1/2 bg-white dark:bg-slate-900 p-3 rounded-xl text-xs font-bold border border-slate-200 dark:border-slate-700 outline-none">
                    <button class="w-1/2 bg-indigo-100 text-indigo-600 rounded-xl text-[10px] font-bold">è·å–éªŒè¯ç </button>
                </div>
                <button onclick="login()" class="w-full bg-indigo-600 text-white p-3 rounded-xl text-xs font-bold shadow-md">ç«‹å³ç™»å½• / æ³¨å†Œ</button>
            </div>
            
            <div id="profile-view" class="hide text-center">
                <div class="w-16 h-16 rounded-full bg-indigo-100 mx-auto mb-3 text-3xl flex items-center justify-center">ğŸ§‘â€ğŸ“</div>
                <p class="font-bold text-lg">138****8888</p>
                <p class="text-xs opacity-50 mb-4">MTI å¤‡è€ƒä¼šå‘˜ (æœ‰æ•ˆæœŸè‡³ 2026.12)</p>
                <button onclick="logout()" class="text-xs text-red-500 font-bold bg-white dark:bg-slate-900 px-4 py-2 rounded-full border border-slate-200">é€€å‡ºç™»å½•</button>
            </div>
        </div>

        <h2 class="text-sm font-black uppercase opacity-30 mb-4 tracking-widest">General Settings</h2>
        
        <div class="space-y-4 flex-1">
            <div onclick="switchTab('books'); toggleSidebar(false);" class="bg-white dark:bg-slate-800 p-4 rounded-xl flex items-center justify-between cursor-pointer border border-slate-100 dark:border-slate-700">
                <span class="text-xs font-bold">ğŸ“š é€‰æ‹©è¯ä¹¦</span>
                <span class="text-xs opacity-50">2025çƒ­è¯ ></span>
            </div>
            
            <div>
                <div class="flex justify-between font-black text-indigo-500 mb-2 text-xs"><span>æ¯æ—¥ç›®æ ‡</span><span id="goal-val">10</span></div>
                <input type="range" min="5" max="50" step="5" value="10" oninput="updateGoal(this.value)" class="w-full h-1 bg-slate-200 rounded-full appearance-none accent-indigo-600">
            </div>

            <button onclick="toggleDarkMode()" class="w-full p-4 bg-white dark:bg-slate-800 rounded-xl flex justify-between font-bold text-xs border border-slate-100 dark:border-slate-700">
                <span>å¤œé—´æ¨¡å¼</span><span id="mode-icon">ğŸŒ™</span>
            </button>
        </div>
    </aside>

    <nav class="fixed bottom-6 left-1/2 -translate-x-1/2 bg-white/90 dark:bg-slate-800/90 backdrop-blur-xl rounded-full shadow-2xl flex items-center px-6 py-2 gap-8 border border-white/20 z-[100]">
        <button onclick="switchTab('home')" id="btn-home" class="p-2 active-tab text-xl">ğŸ </button>
        <button onclick="switchTab('explore')" id="btn-explore" class="p-2 opacity-30 text-xl">ğŸ”</button>
    </nav>

    <script>
        // MTI è¯åº“ (æ”¿æ²»ã€ç»è´¸ã€ç¯ä¿ã€ç§‘æŠ€ã€ç¤¾ä¼š)
        // è¯æ¡ç‰¹ç‚¹ï¼šé•¿éš¾è¯ã€å›ºå®šæ­é…ã€ä¸­å›½ç‰¹è‰²è¯æ±‡
        const RAW_LIB = [
            // --- Politics æ”¿æ²» ---
            { id:'p1', cat:'pol', en:'Community with a shared future', zh:'äººç±»å‘½è¿å…±åŒä½“', d:'æŒ‡å…¨äººç±»åœ¨è¿½æ±‚æœ¬å›½åˆ©ç›Šæ—¶å…¼é¡¾ä»–å›½åˆç†å…³åˆ‡ã€‚', scene: {en: "Building a community with a shared future for mankind.", zh: "æ„å»ºäººç±»å‘½è¿å…±åŒä½“ã€‚"} },
            { id:'p2', cat:'pol', en:'Whole-process people\'s democracy', zh:'å…¨è¿‡ç¨‹äººæ°‘æ°‘ä¸»', d:'ä¸­å›½ç¤¾ä¼šä¸»ä¹‰æ°‘ä¸»æ”¿æ²»çš„æœ¬è´¨å±æ€§ã€‚', scene: {en: "Developing whole-process people's democracy is essential.", zh: "å‘å±•å…¨è¿‡ç¨‹äººæ°‘æ°‘ä¸»è‡³å…³é‡è¦ã€‚"} },
            { id:'p3', cat:'pol', en:'Two Sessions', zh:'ä¸¤ä¼š', d:'å…¨å›½äººæ°‘ä»£è¡¨å¤§ä¼šå’Œä¸­å›½äººæ°‘æ”¿æ²»åå•†ä¼šè®®ã€‚', scene: {en: "The Two Sessions are held every March in Beijing.", zh: "ä¸¤ä¼šæ¯å¹´ä¸‰æœˆåœ¨åŒ—äº¬å¬å¼€ã€‚"} },
            { id:'p4', cat:'pol', en:'Belt and Road Initiative', zh:'ä¸€å¸¦ä¸€è·¯å€¡è®®', d:'ä¸ç»¸ä¹‹è·¯ç»æµå¸¦å’Œ21ä¸–çºªæµ·ä¸Šä¸ç»¸ä¹‹è·¯ã€‚', scene: {en: "The Belt and Road Initiative promotes global cooperation.", zh: "ä¸€å¸¦ä¸€è·¯å€¡è®®ä¿ƒè¿›äº†å…¨çƒåˆä½œã€‚"} },
            { id:'p5', cat:'pol', en:'Governance capacity', zh:'æ²»ç†èƒ½åŠ›', d:'è¿ç”¨å›½å®¶åˆ¶åº¦ç®¡ç†ç¤¾ä¼šå„æ–¹é¢äº‹åŠ¡çš„èƒ½åŠ›ã€‚', scene: {en: "Modernizing China's system and capacity for governance.", zh: "æ¨è¿›å›½å®¶æ²»ç†ä½“ç³»å’Œæ²»ç†èƒ½åŠ›ç°ä»£åŒ–ã€‚"} },

            // --- Economy ç»è´¸ ---
            { id:'e1', cat:'eco', en:'New quality productive forces', zh:'æ–°è´¨ç”Ÿäº§åŠ›', d:'åˆ›æ–°èµ·ä¸»å¯¼ä½œç”¨ï¼Œæ‘†è„±ä¼ ç»Ÿå¢é•¿è·¯å¾„çš„å…ˆè¿›ç”Ÿäº§åŠ›ã€‚', scene: {en: "Accelerating the development of new quality productive forces.", zh: "åŠ å¿«å‘å±•æ–°è´¨ç”Ÿäº§åŠ›ã€‚"} },
            { id:'e2', cat:'eco', en:'Supply-side structural reform', zh:'ä¾›ç»™ä¾§ç»“æ„æ€§æ”¹é©', d:'ä»æé«˜ä¾›ç»™è´¨é‡å‡ºå‘ï¼Œç”¨æ”¹é©çš„åŠæ³•æ¨è¿›ç»“æ„è°ƒæ•´ã€‚', scene: {en: "Deepening supply-side structural reform.", zh: "æ·±åŒ–ä¾›ç»™ä¾§ç»“æ„æ€§æ”¹é©ã€‚"} },
            { id:'e3', cat:'eco', en:'Dual circulation', zh:'åŒå¾ªç¯', d:'ä»¥å›½å†…å¤§å¾ªç¯ä¸ºä¸»ä½“ã€å›½å†…å›½é™…åŒå¾ªç¯ç›¸äº’ä¿ƒè¿›ã€‚', scene: {en: "Foster a new development pattern of dual circulation.", zh: "æ„å»ºåŒå¾ªç¯çš„æ–°å‘å±•æ ¼å±€ã€‚"} },
            { id:'e4', cat:'eco', en:'High-standard opening up', zh:'é«˜æ°´å¹³å¯¹å¤–å¼€æ”¾', d:'ä¾æ‰˜æˆ‘å›½è¶…å¤§è§„æ¨¡å¸‚åœºä¼˜åŠ¿ï¼Œå¸å¼•å…¨çƒèµ„æºè¦ç´ ã€‚', scene: {en: "Promote high-standard opening up.", zh: "æ¨è¿›é«˜æ°´å¹³å¯¹å¤–å¼€æ”¾ã€‚"} },
            { id:'e5', cat:'eco', en:'Cross-border e-commerce', zh:'è·¨å¢ƒç”µå•†', d:'åˆ†å±ä¸åŒå…³å¢ƒçš„äº¤æ˜“ä¸»ä½“é€šè¿‡ç”µå­å•†åŠ¡è¾¾æˆäº¤æ˜“ã€‚', scene: {en: "Cross-border e-commerce has grown rapidly.", zh: "è·¨å¢ƒç”µå•†å‘å±•è¿…é€Ÿã€‚"} },

            // --- Environment ç¯ä¿ ---
            { id:'env1', cat:'env', en:'Carbon neutrality', zh:'ç¢³ä¸­å’Œ', d:'ä¼ä¸šã€å›¢ä½“æˆ–ä¸ªäººæµ‹ç®—åœ¨ä¸€å®šæ—¶é—´å†…ç›´æ¥æˆ–é—´æ¥äº§ç”Ÿçš„æ¸©å®¤æ°”ä½“æ’æ”¾æ€»é‡ï¼Œé€šè¿‡æ¤æ ‘é€ æ—ã€èŠ‚èƒ½å‡æ’ç­‰å½¢å¼ï¼Œä»¥æŠµæ¶ˆè‡ªèº«äº§ç”Ÿçš„äºŒæ°§åŒ–ç¢³æ’æ”¾é‡ï¼Œå®ç°äºŒæ°§åŒ–ç¢³â€œé›¶æ’æ”¾â€ã€‚', scene: {en: "China aims to achieve carbon neutrality by 2060.", zh: "ä¸­å›½æ—¨åœ¨2060å¹´å‰å®ç°ç¢³ä¸­å’Œã€‚"} },
            { id:'env2', cat:'env', en:'Green development', zh:'ç»¿è‰²å‘å±•', d:'ä»¥æ•ˆç‡ã€å’Œè°ã€æŒç»­ä¸ºç›®æ ‡çš„ç»æµå¢é•¿å’Œç¤¾ä¼šå‘å±•æ–¹å¼ã€‚', scene: {en: "Green development is key to a sustainable future.", zh: "ç»¿è‰²å‘å±•æ˜¯å¯æŒç»­æœªæ¥çš„å…³é”®ã€‚"} },
            { id:'env3', cat:'env', en:'Biodiversity conservation', zh:'ç”Ÿç‰©å¤šæ ·æ€§ä¿æŠ¤', d:'ä¿æŠ¤åŸºå› ã€ç‰©ç§å’Œç”Ÿæ€ç³»ç»Ÿçš„å¤šæ ·æ€§ã€‚', scene: {en: "Strengthening biodiversity conservation is urgent.", zh: "åŠ å¼ºç”Ÿç‰©å¤šæ ·æ€§ä¿æŠ¤åˆ»ä¸å®¹ç¼“ã€‚"} },
            
            // --- Tech ç§‘æŠ€ ---
            { id:'t1', cat:'tech', en:'Artificial Intelligence (AI)', zh:'äººå·¥æ™ºèƒ½', d:'ç ”ç©¶ã€å¼€å‘ç”¨äºæ¨¡æ‹Ÿã€å»¶ä¼¸å’Œæ‰©å±•äººçš„æ™ºèƒ½çš„ç†è®ºã€æ–¹æ³•ã€æŠ€æœ¯åŠåº”ç”¨ç³»ç»Ÿã€‚', scene: {en: "Generative AI is transforming industries.", zh: "ç”Ÿæˆå¼äººå·¥æ™ºèƒ½æ­£åœ¨æ”¹å˜å„è¡Œå„ä¸šã€‚"} },
            { id:'t2', cat:'tech', en:'Quantum computing', zh:'é‡å­è®¡ç®—', d:'åˆ©ç”¨é‡å­å åŠ å’Œçº ç¼ ç­‰é‡å­åŠ›å­¦ç°è±¡è¿›è¡Œè®¡ç®—ã€‚', scene: {en: "Quantum computing solves problems faster than supercomputers.", zh: "é‡å­è®¡ç®—è§£å†³é—®é¢˜çš„é€Ÿåº¦æ¯”è¶…çº§è®¡ç®—æœºå¿«ã€‚"} },
            
            // --- Society ç¤¾ä¼š ---
            { id:'s1', cat:'soc', en:'Rural revitalization', zh:'ä¹¡æ‘æŒ¯å…´', d:'é€šè¿‡æ”¹é©å‘å±•ä½¿å†œæ‘é¢è²Œå‘ç”Ÿæ ¹æœ¬æ€§å˜åŒ–ã€‚', scene: {en: "Comprehensive promotion of rural revitalization.", zh: "å…¨é¢æ¨è¿›ä¹¡æ‘æŒ¯å…´ã€‚"} },
            { id:'s2', cat:'soc', en:'Aging population', zh:'äººå£è€é¾„åŒ–', d:'è€å¹´äººå£å æ€»äººå£æ¯”ä¾‹ä¸æ–­ä¸Šå‡çš„è¿‡ç¨‹ã€‚', scene: {en: "Addressing the challenges of an aging population.", zh: "åº”å¯¹äººå£è€é¾„åŒ–çš„æŒ‘æˆ˜ã€‚"} }

        ].sort((a,b) => a.en.localeCompare(b.en));

        let state = {
            mem: JSON.parse(localStorage.getItem('lexi_mti_mem') || '{}'),
            notes: JSON.parse(localStorage.getItem('lexi_mti_notes') || '{}'), // ç¬”è®°å­˜å‚¨
            user: JSON.parse(localStorage.getItem('lexi_mti_user') || 'null'), // ç”¨æˆ·ç™»å½•çŠ¶æ€
            goal: 10, filter: 'all', queue: [], idx: 0, editMode: false, selectedItems: new Set()
        };

        // --- åˆå§‹åŒ– ---
        function init() {
            if(localStorage.getItem('lexi_dark') === 'true') document.body.classList.add('dark');
            updateDashboard();
            renderUserPanel();
        }

        // --- ç™»å½•ç³»ç»Ÿ (Frontend Mock) ---
        function renderUserPanel() {
            const isLogged = !!state.user;
            document.getElementById('login-view').classList.toggle('hide', isLogged);
            document.getElementById('profile-view').classList.toggle('hide', !isLogged);
            // é¡¶éƒ¨å¤´åƒçŠ¶æ€
            const avatar = document.getElementById('header-avatar');
            avatar.innerHTML = isLogged ? '<img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" class="w-full h-full object-cover">' : '<span class="text-xs">ğŸ‘¤</span>';
        }

        function login() {
            // æ¨¡æ‹Ÿç™»å½•è¯·æ±‚
            setTimeout(() => {
                state.user = { phone: '13800008888', token: 'mock_token_123' };
                localStorage.setItem('lexi_mti_user', JSON.stringify(state.user));
                renderUserPanel();
                alert("æ¬¢è¿å›æ¥ï¼ŒMTI å¤‡è€ƒä¼šå‘˜ï¼");
            }, 500);
        }

        function logout() {
            state.user = null;
            localStorage.removeItem('lexi_mti_user');
            renderUserPanel();
        }

        // --- å­¦ä¹ é€»è¾‘ (æé€Ÿæ¨¡å¼) ---
        function openStudy(type) {
            const now = Date.now();
            if(type === 'new') {
                state.queue = RAW_LIB.filter(i => (!state.mem[i.id] || state.mem[i.id].lv === 0));
            } else {
                state.queue = RAW_LIB.filter(i => {
                    const m = state.mem[i.id];
                    return m && m.lv > 0 && m.lv < 99 && now >= m.next;
                });
            }
            if(!state.queue.length) return alert("å½“å‰æ²¡æœ‰å¾…å¤„ç†çš„è¯æ¡ï¼");
            state.queue = state.queue.slice(0, state.goal);
            state.idx = 0;
            document.getElementById('study-layer').classList.remove('hide');
            showCard();
        }

        function showCard() {
            const item = state.queue[state.idx];
            const card = document.getElementById('studyCard');
            card.classList.remove('flipped'); // é»˜è®¤æ˜¾ç¤ºæ­£é¢
            
            // å¡«å……å†…å®¹
            document.getElementById('card-en').innerText = item.en;
            document.getElementById('card-cat').innerText = item.cat.toUpperCase();
            document.getElementById('card-zh').innerText = item.zh;
            document.getElementById('card-d').innerText = item.d;
            document.getElementById('scene-en').innerText = item.scene.en;
            document.getElementById('scene-zh').innerText = item.scene.zh;
        }

        function handleLearn(score) {
            // ç›´æ¥ä¿å­˜è¿›åº¦ï¼Œä¸å¼ºåˆ¶ç¿»é¢ï¼Œç›´æ¥åˆ‡ä¸‹ä¸€é¢˜
            const item = state.queue[state.idx];
            if(!state.mem[item.id]) state.mem[item.id] = { lv: 0, next: 0 };
            const m = state.mem[item.id];

            if(score === 3) m.lv += 1;
            else if(score === 1) m.lv = Math.max(1, m.lv - 1);
            
            const intervals = [0, 0.5, 1, 3, 7, 15, 30];
            m.next = Date.now() + (intervals[Math.min(m.lv, 6)] * 86400000);
            save();

            // æé€Ÿåˆ‡æ¢åŠ¨ç”»
            const card = document.getElementById('studyCard');
            card.style.opacity = '0';
            card.style.transform = 'scale(0.95)';
            
            setTimeout(() => {
                state.idx++;
                if(state.idx < state.queue.length) {
                    showCard();
                    card.style.opacity = '1';
                    card.style.transform = 'scale(1)';
                } else {
                    closeStudy();
                    card.style.opacity = '1';
                    card.style.transform = 'scale(1)';
                }
            }, 200);
        }

        // --- æ¢ç´¢é¡µ (å¸¦ç¬”è®°æ¢å¤) ---
        function setFilter(cat) { 
            state.filter = cat;
            document.querySelectorAll('.cat-btn').forEach(b => {
                b.classList.remove('active-tab', 'opacity-100');
                b.classList.add('opacity-40');
            }); 
            event.target.classList.remove('opacity-40');
            event.target.classList.add('active-tab', 'opacity-100');
            renderExplore(); 
        }

        function renderExplore() {
            const container = document.getElementById('explore-list');
            const filtered = RAW_LIB.filter(i => state.filter === 'all' || i.cat === state.filter);
            container.innerHTML = filtered.map(i => `
                <div class="bg-white dark:bg-slate-800 rounded-2xl p-5 shadow-sm border border-slate-100 dark:border-slate-800">
                    <div class="flex justify-between items-start cursor-pointer" onclick="toggleDetail('${i.id}')">
                        <div class="pr-4">
                            <span class="text-[9px] font-black text-slate-400 uppercase tracking-widest">${i.cat}</span>
                            <h4 class="text-lg font-bold mt-1 leading-tight">${i.en}</h4>
                        </div>
                        <span class="text-indigo-500 text-xl font-bold ${state.mem[i.id]?'':'opacity-0'}">âœ“</span>
                    </div>
                    
                    <div id="detail-${i.id}" class="hide mt-4 pt-4 border-t border-slate-50 dark:border-slate-700">
                        <p class="text-base font-bold text-indigo-600 serif mb-2">${i.zh}</p>
                        <p class="text-xs opacity-60 leading-relaxed mb-4">${i.d}</p>
                        
                        <div class="bg-slate-50 dark:bg-slate-900 p-3 rounded-xl border border-slate-200 dark:border-slate-700">
                            <label class="text-[9px] font-black uppercase text-slate-400 mb-2 block">My Notes / ç¿»è¯‘ç¬”è®°</label>
                            <textarea oninput="saveNote('${i.id}', this.value)" class="w-full bg-transparent text-xs font-medium outline-none resize-none h-16" placeholder="ç‚¹å‡»æ·»åŠ ç¿»è¯‘æŠ€å·§ã€å…³è”è¯...">${state.notes[i.id] || ''}</textarea>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // --- ç†Ÿè¯ç®¡ç† ---
        function renderLearned() {
            const list = RAW_LIB.filter(i => state.mem[i.id] && state.mem[i.id].lv > 0 && state.mem[i.id].lv < 99);
            const container = document.getElementById('learned-list');
            document.getElementById('num-learned').innerText = list.length;
            
            if(!list.length) { container.innerHTML = '<p class="text-center opacity-30 mt-10 text-xs">ç©ºç©ºå¦‚ä¹Ÿ</p>'; return; }

            container.innerHTML = list.map(i => `
                <div class="bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-100 dark:border-slate-700 flex items-center justify-between">
                    <div class="flex items-center gap-3 overflow-hidden">
                        <label class="checkbox-wrapper cursor-pointer ${state.editMode?'':'hide'}">
                            <input type="checkbox" class="hidden" onchange="toggleSelect('${i.id}')" ${state.selectedItems.has(i.id)?'checked':''}>
                            <div class="w-5 h-5 rounded-full border-2 border-slate-300 flex items-center justify-center"><svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div>
                        </label>
                        <div class="truncate">
                            <p class="font-bold text-sm truncate">${i.en}</p>
                            <p class="text-xs opacity-50 truncate">${i.zh}</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function toggleEditMode() {
            state.editMode = !state.editMode;
            document.getElementById('btn-edit').innerText = state.editMode ? 'å®Œæˆ' : 'æ‰¹é‡ç®¡ç†';
            document.getElementById('batch-bar').classList.toggle('hide', !state.editMode);
            state.selectedItems.clear(); renderLearned();
            document.getElementById('selected-count').innerText = 0;
        }
        function toggleSelect(id) {
            state.selectedItems.has(id) ? state.selectedItems.delete(id) : state.selectedItems.add(id);
            document.getElementById('selected-count').innerText = state.selectedItems.size;
        }
        function moveToTrash() {
            if(!confirm("ç¡®å®šç§»å…¥åƒåœ¾ç®±ï¼Ÿ")) return;
            state.selectedItems.forEach(id => state.mem[id].lv = 99);
            save(); toggleEditMode(); updateDashboard();
        }

        // --- é€šç”¨ ---
        function switchTab(tab) {
            ['home', 'explore', 'books', 'learned'].forEach(t => document.getElementById('view-'+t)?.classList.add('hide'));
            document.getElementById('view-'+tab).classList.remove('hide');
            document.querySelectorAll('nav button').forEach(b => b.classList.add('opacity-30'));
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active-tab'));
            if(tab === 'home') document.getElementById('btn-home').classList.add('active-tab', 'opacity-100'); // Fix nav
            if(tab === 'explore') { document.getElementById('btn-explore').classList.add('active-tab', 'opacity-100'); renderExplore(); } // Fix nav
            if(tab === 'learned') renderLearned();
        }
        function saveNote(id, val) { state.notes[id] = val; localStorage.setItem('lexi_mti_notes', JSON.stringify(state.notes)); }
        function save() { localStorage.setItem('lexi_mti_mem', JSON.stringify(state.mem)); updateDashboard(); }
        function toggleDetail(id) { document.getElementById('detail-'+id).classList.toggle('hide'); }
        function closeStudy() { document.getElementById('study-layer').classList.add('hide'); updateDashboard(); }
        function speakWord() { window.speechSynthesis.speak(new SpeechSynthesisUtterance(state.queue[state.idx].en)); }
        function toggleSidebar(show) { document.getElementById('settings-sidebar').classList.toggle('open', show); document.getElementById('settings-overlay').classList.toggle('hide', !show); }
        function toggleDarkMode() { document.body.classList.toggle('dark'); localStorage.setItem('lexi_dark', document.body.classList.contains('dark')); }
        function updateDashboard() {
            const news = RAW_LIB.filter(i => (!state.mem[i.id] || state.mem[i.id].lv === 0)).length;
            const reviews = RAW_LIB.filter(i => state.mem[i.id]?.lv > 0 && state.mem[i.id].lv < 99 && Date.now() >= state.mem[i.id].next).length;
            document.getElementById('num-new').innerText = news;
            document.getElementById('num-review').innerText = reviews;
        }

        init();
    </script>
</body>
</html>
