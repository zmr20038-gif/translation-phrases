<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LexiFlow Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;800&family=Noto+Serif+SC:wght@700&display=swap" rel="stylesheet">
    <style>
        :root { --legal: #FFB800; --gaming: #A855F7; --food: #FF4D4D; --accent: #2563EB; --bg-soft: #F8FAFC; }
        body { background: var(--bg-soft); font-family: 'Plus Jakarta Sans', sans-serif; transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); -webkit-tap-highlight-color: transparent; }
        
        /* ‰∏ªÈ¢òËâ≤ËÉåÊôØÊµÅËΩ¨ */
        body.cat-legal { --accent: var(--legal); background: #FFFBEB; }
        body.cat-gaming { --accent: var(--gaming); background: #FAF5FF; }
        body.cat-food { --accent: var(--food); background: #FFF1F2; }

        .dark-mode { --bg-soft: #0F172A; background: #020617 !important; color: #F8FAFC; }
        
        /* ‰∏çËÉåÂçïËØçÈ£éÂç°Áâá */
        .bubei-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border-radius: 2.5rem; box-shadow: 0 10px 30px -10px rgba(0,0,0,0.05); border: 1px solid rgba(255,255,255,0.5); }
        .dark-mode .bubei-card { background: rgba(30, 41, 59, 0.8); border: 1px solid rgba(255,255,255,0.05); }

        .btn-main { background: var(--accent); color: white; border-radius: 1.5rem; transition: all 0.2s; box-shadow: 0 8px 20px -6px var(--accent); }
        .btn-main:active { transform: scale(0.92); filter: brightness(0.9); }

        .nav-item.active { color: var(--accent); }
        .nav-item.active i { transform: translateY(-4px); color: var(--accent); }

        .progress-ring { transition: stroke-dashoffset 0.35s; transform: rotate(-90deg); transform-origin: 50% 50%; }
        
        .view-hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="min-h-screen pb-32">

    <header class="px-8 pt-12 max-w-2xl mx-auto flex justify-between items-center">
        <div class="fade-in">
            <h1 class="text-4xl font-[800] tracking-tighter italic">LexiFlow</h1>
            <div class="h-1 w-8 rounded-full mt-1" style="background: var(--accent)"></div>
        </div>
        <button onclick="toggleDark()" class="w-12 h-12 bubei-card flex items-center justify-center text-xl">üåì</button>
    </header>

    <main id="view-search" class="px-6 mt-8 max-w-2xl mx-auto fade-in">
        <div class="bubei-card p-2 flex items-center px-6 mb-8">
            <input type="text" id="searchInput" oninput="doSearch()" placeholder="ÊêúÁ¥¢ËØçÊù°..." 
                   class="w-full bg-transparent py-5 focus:outline-none text-lg font-medium">
            <span class="opacity-30">üîç</span>
        </div>

        <div class="flex space-x-3 mb-10 overflow-x-auto no-scrollbar" id="catFilter">
            <button onclick="setCat('all')" class="px-6 py-3 rounded-2xl bubei-card text-[11px] font-extrabold tracking-widest active">ALL</button>
            <button onclick="setCat('legal')" class="px-6 py-3 rounded-2xl bubei-card text-[11px] font-extrabold tracking-widest">LEGAL</button>
            <button onclick="setCat('gaming')" class="px-6 py-3 rounded-2xl bubei-card text-[11px] font-extrabold tracking-widest">GAMING</button>
            <button onclick="setCat('food')" class="px-6 py-3 rounded-2xl bubei-card text-[11px] font-extrabold tracking-widest">FOOD</button>
        </div>

        <div id="listContainer" class="space-y-4"></div>
    </main>

    <main id="view-learn" class="px-6 mt-10 max-w-md mx-auto view-hidden fade-in">
        <div class="grid grid-cols-2 gap-4 mb-8">
            <div class="bubei-card p-6 text-center">
                <p class="text-[10px] font-bold opacity-40 uppercase tracking-tighter mb-1">‰ªäÊó•Êñ∞ËØç‰ªªÂä°</p>
                <div class="flex items-baseline justify-center space-x-1">
                    <span id="newCount" class="text-3xl font-black" style="color: var(--accent)">0</span>
                    <span class="opacity-20 text-sm">/</span>
                    <input type="number" id="dailyGoal" onchange="updateGoal()" class="w-8 bg-transparent font-bold text-lg focus:outline-none">
                </div>
            </div>
            <div class="bubei-card p-6 text-center">
                <p class="text-[10px] font-bold opacity-40 uppercase tracking-tighter mb-1">ÂæÖÂ§ç‰π†ËØçÊù°</p>
                <p id="reviewCount" class="text-3xl font-black">0</p>
            </div>
        </div>

        <div id="cardStage" class="min-h-[460px] flex items-center justify-center"></div>
    </main>

    <nav class="fixed bottom-8 left-1/2 -translate-x-1/2 w-[280px] h-20 bubei-card flex items-center justify-around px-4 z-[100]">
        <button onclick="showPage('learn')" id="btn-learn" class="nav-item flex flex-col items-center opacity-40 transition-all">
            <span class="text-2xl">üå±</span>
            <span class="text-[9px] font-black mt-1 uppercase tracking-widest">Learn</span>
        </button>
        <button onclick="showPage('search')" id="btn-search" class="nav-item flex flex-col items-center active nav-item">
            <span class="text-2xl">üß©</span>
            <span class="text-[9px] font-black mt-1 uppercase tracking-widest">Explore</span>
        </button>
    </nav>

    <script>
        // ËØçÂ∫ìÔºàÊ≠§Â§Ñ‰øùÊåÅ‰πãÂâçÊèê‰æõÁöÑ30‰∏™Ê†∏ÂøÉËØçÔºåÂèØËá™Ë°åÊåâÊ†ºÂºèÊâ©ÂÖÖËá≥300Ôºâ
        const library = [
            { id:'l1', cat:'legal', en:'Without Prejudice', zh:'‰∏çÊçüÂÆ≥ÊùÉÂà©', d:'Ë°®Á§∫Âú®Ë∞àÂà§‰∏≠ÁöÑËÆ©Ê≠•‰∏çËÉΩ‰Ωú‰∏∫Êó•ÂêéËØâËÆºÁöÑËØÅÊçÆ„ÄÇ' },
            { id:'l2', cat:'legal', en:'Force Majeure', zh:'‰∏çÂèØÊäóÂäõ', d:'ÂêàÂêå‰∏≠ÂÖçÈô§Âõ†Â§©ÁÅæÊàñÊàò‰∫âÂØºËá¥ËøùÁ∫¶Ë¥£‰ªªÁöÑÊù°Ê¨æ„ÄÇ' },
            { id:'l3', cat:'legal', en:'Due Diligence', zh:'Â∞ΩËÅåË∞ÉÊü•', d:'Á≠æÁΩ≤ÂïÜ‰∏öÂçèËÆÆÂâçÔºåÂØπËµÑ‰∫ßËøõË°åÁöÑËØ¶ÁªÜÊ≥ïÂæãÂÆ°Êü•„ÄÇ' },
            { id:'g1', cat:'gaming', en:'Fog of War', zh:'Êàò‰∫âËø∑Èõæ', d:'Âú∞Âõæ‰∏äÊú™Êé¢Á¥¢Âå∫ÂüüË¢´ÈÅÆËîΩÔºåÈúÄÊ¥æÈÅ£Âçï‰ΩçËß£ÈîÅËßÜËßâ„ÄÇ' },
            { id:'g2', cat:'gaming', en:'Ray Tracing', zh:'ÂÖâÁ∫øËøΩË∏™', d:'Ê®°ÊãüÂÖâÁ∫øÁâ©ÁêÜË°å‰∏∫ÁöÑÈ´òÁ∫ßÂõæÂΩ¢ÊäÄÊúØ„ÄÇ' },
            { id:'f1', cat:'food', en:'Maillard Reaction', zh:'ÁæéÊãâÂæ∑ÂèçÂ∫î', d:'ËÇâÁ±ªÂä†ÁÉ≠Ëá≥140Â∫¶‰∫ßÁîüË§êËâ≤ÂèäÁÑ¶È¶ôÂë≥ÁöÑÂåñÂ≠¶ÂèçÂ∫î„ÄÇ' },
            { id:'f2', cat:'food', en:'Sous-vide', zh:'‰ΩéÊ∏©ÊÖ¢ÁÖÆ', d:'ÁúüÁ©∫ÂåÖË£ÖÈ£üÊùêÔºåÂú®ÊÅíÊ∏©Ê∞¥Êµ¥‰∏≠ÈïøÊó∂Èó¥Âä†ÁÉ≠„ÄÇ' }
            // Êõ¥Â§öËØçÊù°Âú®Ê≠§Â§ÑÁªßÁª≠Ê∑ªÂä†...
        ];

        let state = {
            view: 'search',
            cat: 'all',
            goal: 10,
            mem: JSON.parse(localStorage.getItem('lexi_v8') || '{}'),
            todayNew: parseInt(localStorage.getItem('lexi_today_new_v8') || 0),
            lastDate: new Date().toLocaleDateString()
        };

        function init() {
            if(localStorage.getItem('lexi_date_v8') !== state.lastDate) {
                state.todayNew = 0;
                localStorage.setItem('lexi_today_new_v8', 0);
                localStorage.setItem('lexi_date_v8', state.lastDate);
            }
            document.getElementById('dailyGoal').value = state.goal;
            setCat('all');
        }

        function setCat(c) {
            state.cat = c;
            document.body.className = `min-h-screen pb-32 cat-${c}`;
            const btns = document.querySelectorAll('#catFilter button');
            btns.forEach(b => {
                b.style.background = b.innerText.toLowerCase().includes(c) ? 'var(--accent)' : '';
                b.style.color = b.innerText.toLowerCase().includes(c) ? 'white' : '';
            });
            doSearch();
        }

        function doSearch() {
            const q = document.getElementById('searchInput').value.toLowerCase();
            const container = document.getElementById('listContainer');
            const filtered = library.filter(i => 
                (state.cat === 'all' || i.cat === state.cat) && 
                (i.en.toLowerCase().includes(q) || i.zh.includes(q))
            );

            container.innerHTML = filtered.map(i => `
                <div class="bubei-card p-8 flex justify-between items-center fade-in hover:translate-y-[-4px] transition-all" onclick="addToLearn('${i.id}')">
                    <div>
                        <h4 class="text-2xl font-black tracking-tighter mb-1">${i.en}</h4>
                        <p class="opacity-40 font-medium text-sm">${i.zh}</p>
                    </div>
                    <div class="w-10 h-10 rounded-full flex items-center justify-center ${state.mem[i.id] ? 'bg-blue-50 text-blue-500' : 'bg-gray-50'}" style="${state.mem[i.id] ? 'background: var(--accent); color: white;' : ''}">
                        ${state.mem[i.id] ? '‚úì' : '+'}
                    </div>
                </div>
            `).join('');
        }

        function addToLearn(id) {
            if(!state.mem[id]) {
                state.mem[id] = { lvl: 1, t: Date.now(), isNew: true };
                save();
                doSearch();
            }
        }

        function renderLearn() {
            const now = Date.now();
            const toReview = library.filter(i => state.mem[i.id] && state.mem[i.id].t <= now);
            const unlearned = library.filter(i => !state.mem[i.id]);
            const todayQueue = unlearned.slice(0, Math.max(0, state.goal - state.todayNew));

            document.getElementById('reviewCount').innerText = toReview.length;
            document.getElementById('newCount').innerText = state.todayNew;
            
            const stage = document.getElementById('cardStage');
            let current = toReview[0] || todayQueue[0];

            if(!current) {
                stage.innerHTML = `
                    <div class="text-center fade-in">
                        <div class="text-6xl mb-6">‚òï</div>
                        <p class="font-bold opacity-30">‰ªäÊó•‰ªªÂä°Â∑≤ËææÊ†á</p>
                    </div>`;
                return;
            }

            stage.innerHTML = `
                <div class="bubei-card p-12 w-full min-h-[450px] flex flex-col justify-between items-center text-center shadow-2xl fade-in">
                    <div class="w-full">
                        <span class="text-[10px] font-black tracking-[0.3em] opacity-20 uppercase mb-8 block">
                            ${toReview[0] ? 'Re-Master' : 'New Discovery'}
                        </span>
                        <h2 class="text-5xl font-black tracking-tighter leading-none mb-6">${current.en}</h2>
                        
                        <div id="ansArea" class="view-hidden pt-6 border-t border-gray-100 mt-6">
                            <p class="text-2xl font-bold mb-4" style="color: var(--accent)">${current.zh}</p>
                            <p class="text-sm opacity-40 italic font-serif leading-relaxed px-4">${current.d}</p>
                        </div>
                    </div>

                    <button id="showBtn" onclick="revealCard()" class="w-20 h-20 rounded-full bubei-card flex items-center justify-center border-2 border-dashed accent-border animate-pulse">
                        <span class="text-[10px] font-bold opacity-40">LOOK</span>
                    </button>

                    <div id="actionBtns" class="view-hidden w-full flex space-x-3 mt-8">
                        <button onclick="submit(true, '${current.id}', ${!!toReview[0]})" class="btn-main flex-1 py-5 font-bold">ËÆ§ËØÜ</button>
                        <button onclick="submit(false, '${current.id}', ${!!toReview[0]})" class="flex-1 py-5 bubei-card font-bold opacity-50">Ê®°Á≥ä</button>
                    </div>
                </div>`;
        }

        function revealCard() {
            document.getElementById('ansArea').classList.remove('view-hidden');
            document.getElementById('actionBtns').classList.remove('view-hidden');
            document.getElementById('showBtn').classList.add('view-hidden');
        }

        function submit(known, id, isReview) {
            if(!isReview && known) {
                state.todayNew++;
                localStorage.setItem('lexi_today_new_v8', state.todayNew);
            }
            const intervals = [0, 1, 8, 24, 72, 168];
            if(!state.mem[id]) state.mem[id] = { lvl: 1 };
            state.mem[id].lvl = known ? Math.min(state.mem[id].lvl + 1, 5) : 1;
            state.mem[id].t = Date.now() + intervals[state.mem[id].lvl] * 3600000;
            save();
            renderLearn();
        }

        function save() { localStorage.setItem('lexi_v8', JSON.stringify(state.mem)); }

        function showPage(p) {
            document.getElementById('view-search').classList.toggle('view-hidden', p !== 'search');
            document.getElementById('view-learn').classList.toggle('view-hidden', p !== 'learn');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('btn-' + p).classList.add('active');
            if(p === 'learn') renderLearn();
        }

        function updateGoal() {
            state.goal = parseInt(document.getElementById('dailyGoal').value);
            renderLearn();
        }

        function toggleDark() { document.body.classList.toggle('dark-mode'); }

        window.onload = init;
    </script>
</body>
</html>
