<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>LexiFlow MTI v13 Ultimate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700;800&family=Noto+Serif+SC:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #F1F5F9; --text: #0F172A; --card: #FFFFFF; --accent: #4F46E5; }
        .dark { --bg: #020617; --text: #F8FAFC; --card: #1E293B; --accent: #818CF8; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; transition: background 0.3s; }
        .serif { font-family: 'Noto Serif SC', serif; }
        
        /* å“åº”å¼å®¹å™¨ï¼šæ‰‹æœºå®½å…¨å±ï¼Œå¹³æ¿å®½å±…ä¸­ */
        .app-container { max-width: 100%; margin: 0 auto; }
        @media (min-width: 640px) { .app-container { max-width: 600px; } }

        /* ä¾§è¾¹æ åŠ¨ç”» */
        #settings-sidebar { transform: translateX(100%); transition: transform 0.35s cubic-bezier(0.32, 0.72, 0, 1); }
        #settings-sidebar.open { transform: translateX(0); }

        /* 3D ç¿»è½¬å¡ç‰‡ */
        .card-container { perspective: 1200px; width: 100%; height: 100%; position: relative; }
        .flip-card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1); transform-style: preserve-3d; }
        .flipped .flip-card-inner { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 2rem; display: flex; flex-direction: column; padding: 2rem; background: var(--card); box-shadow: 0 20px 40px -5px rgba(0,0,0,0.05); border: 1px solid rgba(0,0,0,0.05); }
        .card-back { transform: rotateY(180deg); border: 2px solid var(--accent); overflow-y: auto; }

        .hide { display: none !important; }
        /* å¯¼èˆªæ¿€æ´»æ€ï¼šåº•éƒ¨åŠ ç²—æ¨ªçº¿ */
        .active-tab { color: var(--accent) !important; opacity: 1 !important; font-weight: 800; position: relative; }
        .active-tab::after { content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 3px; background: var(--accent); border-radius: 2px; }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* Checkbox åŠ¨ç”» */
        .checkbox-custom input:checked + div { background-color: var(--accent); border-color: var(--accent); transform: scale(1.1); }
    </style>
</head>
<body class="select-none min-h-screen pb-28">

    <header class="app-container px-6 pt-12 pb-4 flex justify-between items-center">
        <div>
            <h1 class="text-3xl font-[900] tracking-tighter italic text-slate-800 dark:text-white">Lexi<span class="text-indigo-600">MTI</span></h1>
            <p class="text-[10px] font-black opacity-30 uppercase tracking-[0.2em] mt-1">2026 Master of Translation</p>
        </div>
        <button onclick="toggleSidebar(true)" class="w-10 h-10 bg-white dark:bg-slate-800 rounded-full shadow-sm flex items-center justify-center active:scale-90 transition-transform">
            <svg class="w-5 h-5 text-slate-600 dark:text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
        </button>
    </header>

    <main id="view-home" class="app-container px-6 space-y-6">
        <div class="grid grid-cols-2 gap-4">
            <div onclick="openStudy('new')" class="bg-white dark:bg-slate-800 p-6 rounded-[2rem] shadow-sm border-b-4 border-indigo-100 dark:border-slate-700 active:scale-95 transition-all cursor-pointer group">
                <span class="text-[10px] font-black opacity-40 uppercase group-hover:text-indigo-500 transition-colors">New Words</span>
                <p id="num-new" class="text-4xl font-black mt-2 text-indigo-600">0</p>
                <p class="text-[10px] opacity-40 mt-1">ä»Šæ—¥éœ€å­¦</p>
            </div>
            <div onclick="openStudy('review')" class="bg-white dark:bg-slate-800 p-6 rounded-[2rem] shadow-sm border-b-4 border-emerald-100 dark:border-slate-700 active:scale-95 transition-all cursor-pointer group">
                <span class="text-[10px] font-black opacity-40 uppercase group-hover:text-emerald-500 transition-colors">Review</span>
                <p id="num-review" class="text-4xl font-black mt-2 text-emerald-500">0</p>
                <p class="text-[10px] opacity-40 mt-1">å³åˆ»å¤ä¹ </p>
            </div>
        </div>

        <div onclick="switchTab('learned')" class="bg-white dark:bg-slate-800 p-5 rounded-[2rem] shadow-sm flex justify-between items-center border border-slate-50 dark:border-slate-700 active:scale-95 transition-all cursor-pointer">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 rounded-2xl bg-emerald-50 dark:bg-emerald-900/30 text-emerald-600 flex items-center justify-center text-xl">ğŸ“</div>
                <div>
                    <p class="text-sm font-bold">å·²æŒæ¡è¯æ¡åº“</p>
                    <p class="text-[10px] opacity-40 uppercase font-black">Archive Library</p>
                </div>
            </div>
            <p id="num-learned-dash" class="text-xl font-black text-slate-300 mr-2">0</p>
        </div>

        <div class="bg-gradient-to-br from-indigo-600 to-blue-700 rounded-[2.5rem] p-8 text-white shadow-xl shadow-indigo-100 dark:shadow-none relative overflow-hidden">
            <div class="absolute -top-10 -right-10 w-40 h-40 bg-white opacity-10 rounded-full blur-2xl"></div>
            <p class="text-[10px] font-bold opacity-60 uppercase mb-4 tracking-widest flex items-center gap-2">
                <span>Daily Quote</span>
                <span class="w-1 h-1 bg-white rounded-full"></span>
                <span id="quote-date">Date</span>
            </p>
            <p id="quote-en" class="text-lg font-bold font-serif leading-relaxed mb-4">Loading...</p>
            <p id="quote-zh" class="text-sm opacity-90 serif border-l-2 border-white/30 pl-4 leading-relaxed">åŠ è½½ä¸­...</p>
        </div>
    </main>

    <main id="view-explore" class="app-container px-6 hide">
        <div class="flex gap-6 mb-6 overflow-x-auto no-scrollbar pb-2 border-b border-slate-200 dark:border-slate-800">
            <button onclick="setFilter('all')" class="cat-btn text-xs font-bold pb-2 active-tab whitespace-nowrap transition-colors">å…¨éƒ¨</button>
            <button onclick="setFilter('POL')" class="cat-btn text-xs font-bold pb-2 opacity-30 whitespace-nowrap hover:opacity-100">ğŸ›ï¸ æ”¿æ²»</button>
            <button onclick="setFilter('ECO')" class="cat-btn text-xs font-bold pb-2 opacity-30 whitespace-nowrap hover:opacity-100">ğŸ’° ç»è´¸</button>
            <button onclick="setFilter('TEC')" class="cat-btn text-xs font-bold pb-2 opacity-30 whitespace-nowrap hover:opacity-100">ğŸš€ ç§‘æŠ€</button>
            <button onclick="setFilter('CUL')" class="cat-btn text-xs font-bold pb-2 opacity-30 whitespace-nowrap hover:opacity-100">ğŸ® æ–‡åŒ–</button>
            <button onclick="setFilter('CHEM')" class="cat-btn text-xs font-bold pb-2 opacity-30 whitespace-nowrap hover:opacity-100">ğŸ§ª åŒ–å­¦</button>
            <button onclick="setFilter('MED')" class="cat-btn text-xs font-bold pb-2 opacity-30 whitespace-nowrap hover:opacity-100">ğŸ’Š åŒ»å­¦</button>
            <button onclick="setFilter('GEO')" class="cat-btn text-xs font-bold pb-2 opacity-30 whitespace-nowrap hover:opacity-100">ğŸŒ åœ°ç†</button>
            <button onclick="setFilter('SPT')" class="cat-btn text-xs font-bold pb-2 opacity-30 whitespace-nowrap hover:opacity-100">ğŸ… ä½“è‚²</button>
        </div>
        <div id="explore-list" class="space-y-4 pb-32">
            </div>
    </main>

    <main id="view-learned" class="app-container px-6 hide">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-black">å½’æ¡£ç®¡ç†</h2>
            <button onclick="toggleEditMode()" id="btn-edit" class="text-xs font-bold bg-indigo-50 dark:bg-slate-800 text-indigo-600 px-5 py-2 rounded-full transition-colors">æ‰¹é‡ç®¡ç†</button>
        </div>
        <div id="learned-list" class="space-y-3 pb-32"></div>
    </main>

    <section id="study-layer" class="fixed inset-0 bg-slate-100 dark:bg-slate-950 z-[200] hide flex flex-col">
        <div class="app-container w-full px-6 pt-12 flex justify-between items-center">
            <button onclick="closeStudy()" class="w-10 h-10 rounded-full bg-white dark:bg-slate-800 flex items-center justify-center shadow-sm text-slate-400 hover:text-red-500 transition-colors">âœ•</button>
            <span id="study-progress" class="text-[10px] font-black opacity-30 tracking-widest uppercase italic">0 / 0</span>
            <button onclick="speakWord()" class="w-10 h-10 rounded-full bg-white dark:bg-slate-800 flex items-center justify-center shadow-sm text-indigo-500">ğŸ”Š</button>
        </div>
        
        <div class="flex-1 p-6 flex items-center justify-center w-full max-w-lg mx-auto">
            <div class="card-container" id="studyCard">
                <div class="flip-card-inner" onclick="flipCard()">
                    <div class="card-face card-front items-center justify-center text-center">
                        <span id="card-cat" class="text-[10px] font-black text-indigo-500 bg-indigo-50 dark:bg-indigo-900/30 px-3 py-1 rounded mb-8 tracking-widest uppercase">CAT</span>
                        <h2 id="card-en" class="text-3xl sm:text-4xl font-bold leading-tight mb-8">Word</h2>
                        <div class="absolute bottom-10 w-full text-center">
                            <p class="text-[9px] font-bold text-slate-300 animate-pulse uppercase tracking-widest">Tap to flip</p>
                        </div>
                    </div>
                    <div class="card-face card-back items-start text-left">
                        <h3 id="card-zh" class="text-2xl font-bold text-indigo-600 mb-3 serif">ä¸­æ–‡</h3>
                        <p id="card-d" class="text-sm text-slate-600 dark:text-slate-400 leading-relaxed mb-6 font-medium">Definition</p>
                        
                        <div class="w-full bg-slate-50 dark:bg-slate-800 p-4 rounded-2xl mb-4 border border-slate-100 dark:border-slate-700">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-[10px] bg-slate-200 dark:bg-slate-600 px-1.5 rounded text-slate-500 dark:text-slate-300 font-bold">ä¾‹å¥</span>
                                <span class="text-[10px] font-black opacity-30 uppercase">Context</span>
                            </div>
                            <p id="card-scene-en" class="text-xs font-bold text-slate-700 dark:text-slate-200 mb-1 leading-snug italic">Example EN</p>
                            <p id="card-scene-zh" class="text-[10px] text-slate-400 serif">ä¾‹å¥ CN</p>
                        </div>

                        <div class="w-full mt-auto pt-4 border-t border-slate-100 dark:border-slate-700" onclick="event.stopPropagation()">
                            <p class="text-[9px] font-black text-slate-400 uppercase mb-2">My Notes / ç¬”è®°</p>
                            <textarea id="card-note" oninput="saveCurrentNote(this.value)" class="w-full bg-transparent text-xs h-20 outline-none resize-none placeholder:text-slate-300" placeholder="ç‚¹å‡»æ­¤å¤„è®°å½•è€ƒç‚¹..."></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="p-8 pb-14 bg-white dark:bg-slate-900 rounded-t-[3rem] shadow-[0_-10px_40px_rgba(0,0,0,0.05)] app-container w-full">
            <div class="grid grid-cols-3 gap-4">
                <button onclick="handleLearn(1)" class="py-5 bg-slate-50 dark:bg-slate-800 rounded-2xl font-black text-[10px] text-slate-400 active:scale-95 transition-all">ğŸ¤¯ å¿˜äº†</button>
                <button onclick="handleLearn(2)" class="py-5 bg-indigo-50 dark:bg-indigo-900/20 rounded-2xl font-black text-[10px] text-indigo-500 active:scale-95 transition-all">ğŸ¤” æ¨¡ç³Š</button>
                <button onclick="handleLearn(3)" class="py-5 bg-indigo-600 rounded-2xl font-black text-[10px] text-white shadow-lg shadow-indigo-200 dark:shadow-none active:scale-95 transition-all">ğŸ˜ è®¤è¯†</button>
            </div>
        </div>
    </section>

    <div id="settings-overlay" onclick="toggleSidebar(false)" class="fixed inset-0 bg-slate-900/20 backdrop-blur-sm z-[300] hide transition-opacity"></div>
    <aside id="settings-sidebar" class="fixed top-0 right-0 h-full w-80 max-w-[90vw] bg-white dark:bg-slate-900 z-[301] shadow-2xl p-6 flex flex-col overflow-y-auto">
        <div id="user-panel" class="mb-8 p-6 bg-gradient-to-br from-slate-50 to-white dark:from-slate-800 dark:to-slate-800 rounded-[2.5rem] border border-slate-100 dark:border-slate-700 shadow-sm relative overflow-hidden">
            <div id="login-form">
                <h3 class="font-black text-sm mb-4">éªŒè¯ç ç™»å½•</h3>
                <input type="tel" id="login-phone" placeholder="æ‰‹æœºå·" class="w-full p-3 rounded-xl text-xs font-bold mb-3 border border-slate-200 dark:border-slate-600 dark:bg-slate-900 outline-none focus:border-indigo-500 transition-colors">
                <div class="flex gap-2 mb-4">
                    <input type="number" id="login-code" placeholder="éªŒè¯ç " class="w-full p-3 rounded-xl text-xs font-bold border border-slate-200 dark:border-slate-600 dark:bg-slate-900 outline-none">
                    <button id="btn-get-code" onclick="sendCode()" class="whitespace-nowrap px-3 bg-slate-100 dark:bg-slate-700 text-[10px] font-bold rounded-xl text-slate-500">è·å–éªŒè¯ç </button>
                </div>
                <button onclick="doLogin()" class="w-full bg-indigo-600 text-white p-3 rounded-xl text-xs font-bold shadow-lg shadow-indigo-200 dark:shadow-none active:scale-95 transition-transform">ç™»å½•</button>
            </div>
            
            <div id="profile-data" class="hide text-center relative z-10">
                <div class="w-16 h-16 rounded-full bg-indigo-100 dark:bg-indigo-500/20 mx-auto mb-3 flex items-center justify-center text-3xl shadow-inner border-2 border-white dark:border-slate-700">ğŸ§‘â€ğŸ“</div>
                <p id="display-phone" class="font-black text-slate-700 dark:text-slate-200 text-base tracking-tight mb-4">138****0000</p>
                
                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-white dark:bg-slate-900 p-3 rounded-2xl shadow-sm border border-slate-50 dark:border-slate-700">
                        <p class="text-[8px] opacity-40 uppercase font-black">è¯æ±‡é‡</p>
                        <p id="stat-words" class="text-sm font-black text-indigo-600">0</p>
                    </div>
                    <div class="bg-white dark:bg-slate-900 p-3 rounded-2xl shadow-sm border border-slate-50 dark:border-slate-700 relative overflow-hidden">
                        <div class="absolute -right-2 -top-2 w-8 h-8 bg-amber-100 rounded-full opacity-50"></div>
                        <p class="text-[8px] opacity-40 uppercase font-black">æˆ‘çš„ç§¯åˆ†</p>
                        <p id="stat-points" class="text-sm font-black text-amber-500">0</p>
                    </div>
                </div>
                <button onclick="doLogout()" class="mt-4 text-[10px] text-red-400 font-bold opacity-60 hover:opacity-100">é€€å‡ºè´¦å·</button>
            </div>
        </div>

        <div class="space-y-4 px-1 flex-1">
            <div class="p-4 bg-slate-50 dark:bg-slate-800 rounded-2xl flex justify-between items-center cursor-pointer active:scale-95 transition-all">
                <div class="flex items-center gap-3">
                    <span class="text-lg">ğŸ“š</span>
                    <div>
                        <p class="text-xs font-bold">æˆ‘çš„è¯ä¹¦</p>
                        <p class="text-[9px] opacity-50">å½“å‰: 2026 MTI æ ¸å¿ƒè¯æ±‡</p>
                    </div>
                </div>
                <span class="text-xs text-indigo-600 font-bold">åˆ‡æ¢</span>
            </div>

            <div class="p-4 bg-slate-50 dark:bg-slate-800 rounded-2xl">
                <div class="flex justify-between items-center text-xs font-black mb-3">
                    <span class="opacity-40 uppercase tracking-widest">Daily Goal</span>
                    <span id="goal-val" class="text-indigo-600 font-mono">10</span>
                </div>
                <input type="range" min="5" max="50" step="5" value="10" oninput="updateGoal(this.value)" class="w-full h-1.5 bg-slate-200 dark:bg-slate-700 appearance-none accent-indigo-600 rounded-full cursor-pointer">
            </div>

            <button onclick="toggleDarkMode()" class="w-full p-4 bg-slate-50 dark:bg-slate-800 rounded-2xl flex justify-between items-center font-bold text-xs active:scale-95 transition-all">
                <span>å¤œé—´æ¨¡å¼</span><span id="mode-icon">ğŸŒ™</span>
            </button>
        </div>
        
        <p class="text-[9px] text-center opacity-20 mt-6 font-mono">Build v13.0 Ultimate</p>
    </aside>

    <div id="batch-bar" class="fixed bottom-28 left-6 right-6 max-w-lg mx-auto bg-white dark:bg-slate-800 shadow-2xl rounded-[1.5rem] p-4 flex justify-between items-center border border-slate-100 dark:border-slate-700 hide z-[50] animate-[slideUp_0.3s_ease-out]">
        <span class="text-xs font-black ml-4">å·²é€‰ <span id="selected-count" class="text-indigo-600 font-mono text-base">0</span> é¡¹</span>
        <button onclick="moveToTrash()" class="bg-red-50 dark:bg-red-900/20 text-red-500 px-6 py-3 rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-red-100 transition-colors">å½’æ¡£ (ä¸å†å­¦)</button>
    </div>

    <nav class="fixed bottom-8 left-1/2 -translate-x-1/2 bg-white/90 dark:bg-slate-900/90 backdrop-blur-xl rounded-full shadow-2xl shadow-indigo-500/10 flex items-center px-10 py-3 gap-16 border border-white/20 z-[100]">
        <button onclick="switchTab('home')" id="btn-home" class="text-2xl active-tab transition-all p-1">ğŸ </button>
        <button onclick="switchTab('explore')" id="btn-explore" class="text-2xl opacity-30 transition-all p-1">ğŸ”</button>
    </nav>

    <script>
        // --- 1. æ•°æ®é…ç½® (8å¤§ç±» x 5è¯ = 40è¯) ---
        const RAW_LIB = [
            // POL - æ”¿æ²»
            { id:'p1', cat:'POL', en:'New quality productive forces', zh:'æ–°è´¨ç”Ÿäº§åŠ›', d:'ä»¥åˆ›æ–°èµ·ä¸»å¯¼ä½œç”¨ï¼Œæ‘†è„±ä¼ ç»Ÿå¢é•¿è·¯å¾„çš„å…ˆè¿›ç”Ÿäº§åŠ›ã€‚', scene: {en: "Innovation drives the development of new quality productive forces.", zh: "åˆ›æ–°é©±åŠ¨æ–°è´¨ç”Ÿäº§åŠ›çš„å‘å±•ã€‚"} },
            { id:'p2', cat:'POL', en:'Chinese path to modernization', zh:'ä¸­å›½å¼ç°ä»£åŒ–', d:'äººå£è§„æ¨¡å·¨å¤§çš„ç°ä»£åŒ–ï¼Œå…¨ä½“äººæ°‘å…±åŒå¯Œè£•çš„ç°ä»£åŒ–ã€‚', scene: {en: "Chinese path to modernization offers a new option for humanity.", zh: "ä¸­å›½å¼ç°ä»£åŒ–ä¸ºäººç±»æä¾›äº†æ–°çš„é€‰æ‹©ã€‚"} },
            { id:'p3', cat:'POL', en:'Whole-process people\'s democracy', zh:'å…¨è¿‡ç¨‹äººæ°‘æ°‘ä¸»', d:'æœ€å¹¿æ³›ã€æœ€çœŸå®ã€æœ€ç®¡ç”¨çš„æ°‘ä¸»ã€‚', scene: {en: "This system ensures whole-process people's democracy.", zh: "è¯¥åˆ¶åº¦ä¿éšœäº†å…¨è¿‡ç¨‹äººæ°‘æ°‘ä¸»ã€‚"} },
            { id:'p4', cat:'POL', en:'Community with a shared future', zh:'äººç±»å‘½è¿å…±åŒä½“', d:'æ—¨åœ¨å»ºç«‹ä¸€ä¸ªæŒä¹…å’Œå¹³ã€æ™®éå®‰å…¨çš„ä¸–ç•Œã€‚', scene: {en: "Building a community with a shared future for mankind.", zh: "æ„å»ºäººç±»å‘½è¿å…±åŒä½“ã€‚"} },
            { id:'p5', cat:'POL', en:'Targeted poverty alleviation', zh:'ç²¾å‡†æ‰¶è´«', d:'å¯¹ä¸åŒè´«å›°åŒºåŸŸç¯å¢ƒã€ä¸åŒè´«å›°å†œæˆ·çŠ¶å†µå®æ–½ç²¾ç¡®å¸®æ‰¶ã€‚', scene: {en: "Targeted poverty alleviation has lifted millions out of poverty.", zh: "ç²¾å‡†æ‰¶è´«ä½¿æ•°ç™¾ä¸‡äººè„±è´«ã€‚"} },
            
            // ECO - ç»è´¸
            { id:'e1', cat:'ECO', en:'Supply-side structural reform', zh:'ä¾›ç»™ä¾§ç»“æ„æ€§æ”¹é©', d:'ç”¨æ”¹é©çš„åŠæ³•æ¨è¿›ç»“æ„è°ƒæ•´ï¼Œæé«˜å…¨è¦ç´ ç”Ÿäº§ç‡ã€‚', scene: {en: "Deepening supply-side structural reform is crucial.", zh: "æ·±åŒ–ä¾›ç»™ä¾§ç»“æ„æ€§æ”¹é©è‡³å…³é‡è¦ã€‚"} },
            { id:'e2', cat:'ECO', en:'Dual circulation', zh:'åŒå¾ªç¯', d:'ä»¥å›½å†…å¤§å¾ªç¯ä¸ºä¸»ä½“ã€å›½å†…å›½é™…åŒå¾ªç¯ç›¸äº’ä¿ƒè¿›ã€‚', scene: {en: "The dual circulation strategy boosts economic resilience.", zh: "åŒå¾ªç¯æˆ˜ç•¥å¢å¼ºäº†ç»æµéŸ§æ€§ã€‚"} },
            { id:'e3', cat:'ECO', en:'High-standard opening up', zh:'é«˜æ°´å¹³å¯¹å¤–å¼€æ”¾', d:'ä¾æ‰˜æˆ‘å›½è¶…å¤§è§„æ¨¡å¸‚åœºä¼˜åŠ¿ï¼Œå¸å¼•å…¨çƒèµ„æºè¦ç´ ã€‚', scene: {en: "China is committed to high-standard opening up.", zh: "ä¸­å›½è‡´åŠ›äºé«˜æ°´å¹³å¯¹å¤–å¼€æ”¾ã€‚"} },
            { id:'e4', cat:'ECO', en:'Negative list', zh:'è´Ÿé¢æ¸…å•', d:'è§„å®šä¼ä¸šä¸èƒ½ä»äº‹çš„é¢†åŸŸå’Œäº§ä¸šçš„æ¸…å•ã€‚', scene: {en: "The negative list for foreign investment has been shortened.", zh: "å¤–å•†æŠ•èµ„è´Ÿé¢æ¸…å•å·²ç¼©å‡ã€‚"} },
            { id:'e5', cat:'ECO', en:'Digital economy', zh:'æ•°å­—ç»æµ', d:'ä»¥æ•°æ®èµ„æºä¸ºå…³é”®è¦ç´ ï¼Œä»¥ç°ä»£ä¿¡æ¯ç½‘ç»œä¸ºè½½ä½“ã€‚', scene: {en: "The digital economy is a new engine for growth.", zh: "æ•°å­—ç»æµæ˜¯å¢é•¿çš„æ–°å¼•æ“ã€‚"} },

            // TEC - ç§‘æŠ€
            { id:'t1', cat:'TEC', en:'Quantum Entanglement', zh:'é‡å­çº ç¼ ', d:'é‡å­åŠ›å­¦ä¸­ç²’å­ä¹‹é—´å³ä½¿ç›¸è·é¥è¿œä¹Ÿèƒ½ç¬é—´ç›¸äº’å½±å“çš„ç°è±¡ã€‚', scene: {en: "Quantum entanglement enables secure communication.", zh: "é‡å­çº ç¼ å®ç°äº†å®‰å…¨é€šä¿¡ã€‚"} },
            { id:'t2', cat:'TEC', en:'Generative AI', zh:'ç”Ÿæˆå¼äººå·¥æ™ºèƒ½', d:'èƒ½å¤Ÿé€šè¿‡å­¦ä¹ æ¨¡å¼ç”Ÿæˆæ–°å†…å®¹ï¼ˆæ–‡æœ¬ã€å›¾åƒç­‰ï¼‰çš„AIã€‚', scene: {en: "Generative AI is transforming content creation.", zh: "ç”Ÿæˆå¼AIæ­£åœ¨æ”¹å˜å†…å®¹åˆ›ä½œã€‚"} },
            { id:'t3', cat:'TEC', en:'Semiconductor wafer', zh:'åŠå¯¼ä½“æ™¶åœ†', d:'åˆ¶ä½œé›†æˆç”µè·¯çš„ç¡…åŸºåº•ææ–™ã€‚', scene: {en: "Global demand for semiconductor wafers is rising.", zh: "å…¨çƒå¯¹åŠå¯¼ä½“æ™¶åœ†çš„éœ€æ±‚æ­£åœ¨ä¸Šå‡ã€‚"} },
            { id:'t4', cat:'TEC', en:'Blockchain', zh:'åŒºå—é“¾', d:'å»ä¸­å¿ƒåŒ–çš„åˆ†å¸ƒå¼è´¦æœ¬æŠ€æœ¯ã€‚', scene: {en: "Blockchain ensures data transparency and security.", zh: "åŒºå—é“¾ç¡®ä¿äº†æ•°æ®çš„é€æ˜å’Œå®‰å…¨ã€‚"} },
            { id:'t5', cat:'TEC', en:'Cloud computing', zh:'äº‘è®¡ç®—', d:'é€šè¿‡äº’è”ç½‘æŒ‰éœ€æä¾›è®¡ç®—èµ„æºã€‚', scene: {en: "Enterprises are migrating to cloud computing.", zh: "ä¼ä¸šæ­£åœ¨å‘äº‘è®¡ç®—è¿ç§»ã€‚"} },

            // CUL - æ–‡åŒ–
            { id:'c1', cat:'CUL', en:'Intangible cultural heritage', zh:'éç‰©è´¨æ–‡åŒ–é—äº§', d:'è¢«å„ç¾¤ä½“è§†ä¸ºå…¶æ–‡åŒ–é—äº§çš„å„ç§å®è·µã€è¡¨æ¼”ã€çŸ¥è¯†ç­‰ã€‚', scene: {en: "Protecting intangible cultural heritage maintains diversity.", zh: "ä¿æŠ¤éç‰©è´¨æ–‡åŒ–é—äº§ç»´æŠ¤äº†å¤šæ ·æ€§ã€‚"} },
            { id:'c2', cat:'CUL', en:'Confucianism', zh:'å„’å®¶æ€æƒ³', d:'ä»¥å­”å­å­¦è¯´ä¸ºåŸºç¡€çš„å“²å­¦å’Œä¼¦ç†ä½“ç³»ã€‚', scene: {en: "Confucianism emphasizes benevolence and righteousness.", zh: "å„’å®¶æ€æƒ³å¼ºè°ƒä»å’Œä¹‰ã€‚"} },
            { id:'c3', cat:'CUL', en:'Cultural self-confidence', zh:'æ–‡åŒ–è‡ªä¿¡', d:'å¯¹è‡ªèº«æ–‡åŒ–ä»·å€¼çš„å……åˆ†è‚¯å®šå’Œç”Ÿå‘½åŠ›çš„åšå®šä¿¡å¿µã€‚', scene: {en: "We should strengthen cultural self-confidence.", zh: "æˆ‘ä»¬åº”è¯¥å¢å¼ºæ–‡åŒ–è‡ªä¿¡ã€‚"} },
            { id:'c4', cat:'CUL', en:'Traditional Chinese Medicine', zh:'ä¸­åŒ»è¯', d:'ä»¥æ•´ä½“è§‚å¿µå’Œè¾¨è¯è®ºæ²»ä¸ºç‰¹ç‚¹çš„ä¼ ç»ŸåŒ»å­¦ä½“ç³»ã€‚', scene: {en: "TCM plays a role in global health.", zh: "ä¸­åŒ»è¯åœ¨å…¨çƒå¥åº·ä¸­å‘æŒ¥ä½œç”¨ã€‚"} },
            { id:'c5', cat:'CUL', en:'Soft power', zh:'è½¯å®åŠ›', d:'é€šè¿‡å¸å¼•åŠ›è€Œéå¼ºè¿«æ‰‹æ®µè¾¾åˆ°ç›®çš„çš„èƒ½åŠ›ã€‚', scene: {en: "Culture is a key component of soft power.", zh: "æ–‡åŒ–æ˜¯è½¯å®åŠ›çš„å…³é”®ç»„æˆéƒ¨åˆ†ã€‚"} },

            // CHEM - åŒ–å­¦
            { id:'ch1', cat:'CHEM', en:'Catalyst', zh:'å‚¬åŒ–å‰‚', d:'èƒ½æ”¹å˜ååº”é€Ÿç‡è€Œæœ¬èº«è´¨é‡å’ŒåŒ–å­¦æ€§è´¨ä¸å˜çš„ç‰©è´¨ã€‚', scene: {en: "Enzymes act as biological catalysts.", zh: "é…¶èµ·ç€ç”Ÿç‰©å‚¬åŒ–å‰‚çš„ä½œç”¨ã€‚"} },
            { id:'ch2', cat:'CHEM', en:'Carbon Neutrality', zh:'ç¢³ä¸­å’Œ', d:'é€šè¿‡æ¤æ ‘é€ æ—ã€èŠ‚èƒ½å‡æ’ç­‰å½¢å¼ï¼ŒæŠµæ¶ˆè‡ªèº«äº§ç”Ÿçš„äºŒæ°§åŒ–ç¢³æ’æ”¾ã€‚', scene: {en: "Achieving carbon neutrality requires global effort.", zh: "å®ç°ç¢³ä¸­å’Œéœ€è¦å…¨çƒåŠªåŠ›ã€‚"} },
            { id:'ch3', cat:'CHEM', en:'Polymerization', zh:'èšåˆååº”', d:'ç”±å•ä½“åˆæˆèšåˆç‰©çš„åŒ–å­¦ååº”ã€‚', scene: {en: "Plastic is produced through polymerization.", zh: "å¡‘æ–™æ˜¯é€šè¿‡èšåˆååº”ç”Ÿäº§çš„ã€‚"} },
            { id:'ch4', cat:'CHEM', en:'Oxidation', zh:'æ°§åŒ–ååº”', d:'ç‰©è´¨å¤±å»ç”µå­çš„ååº”è¿‡ç¨‹ã€‚', scene: {en: "Rust is a result of iron oxidation.", zh: "é“é”ˆæ˜¯é“æ°§åŒ–çš„ç»“æœã€‚"} },
            { id:'ch5', cat:'CHEM', en:'Rare earth elements', zh:'ç¨€åœŸå…ƒç´ ', d:'åŒ–å­¦å‘¨æœŸè¡¨ä¸­é•§ç³»å…ƒç´ å’Œé’ªã€é’‡å…±17ç§å…ƒç´ çš„æ€»ç§°ã€‚', scene: {en: "Rare earth elements are vital for electronics.", zh: "ç¨€åœŸå…ƒç´ å¯¹ç”µå­äº§å“è‡³å…³é‡è¦ã€‚"} },

            // MED - åŒ»å­¦
            { id:'m1', cat:'MED', en:'Clinical trial', zh:'ä¸´åºŠè¯•éªŒ', d:'åœ¨äººç±»å¿—æ„¿è€…èº«ä¸Šè¿›è¡Œçš„åŒ»å­¦ç ”ç©¶ï¼Œä»¥è¯„ä¼°æ–°ç–—æ³•çš„å®‰å…¨æ€§ã€‚', scene: {en: "The vaccine is undergoing phase III clinical trials.", zh: "è¯¥ç–«è‹—æ­£åœ¨è¿›è¡Œä¸‰æœŸä¸´åºŠè¯•éªŒã€‚"} },
            { id:'m2', cat:'MED', en:'Herd immunity', zh:'ç¾¤ä½“å…ç–«', d:'äººç¾¤ä¸­å¤§éƒ¨åˆ†äººæœ‰äº†å…ç–«åŠ›ï¼Œä»è€Œä¿æŠ¤äº†ç¼ºä¹å…ç–«åŠ›çš„ä¸ªä½“ã€‚', scene: {en: "Vaccination helps achieve herd immunity.", zh: "æ¥ç§ç–«è‹—æœ‰åŠ©äºå®ç°ç¾¤ä½“å…ç–«ã€‚"} },
            { id:'m3', cat:'MED', en:'Placebo effect', zh:'å®‰æ…°å‰‚æ•ˆåº”', d:'ç—…äººè™½ç„¶è·å¾—æ— æ•ˆæ²»ç–—ï¼Œä½†å› é¢„æ–™æœ‰æ•ˆè€Œç—‡çŠ¶ç¼“è§£çš„ç°è±¡ã€‚', scene: {en: "The control group showed a strong placebo effect.", zh: "å¯¹ç…§ç»„è¡¨ç°å‡ºå¼ºçƒˆçš„å®‰æ…°å‰‚æ•ˆåº”ã€‚"} },
            { id:'m4', cat:'MED', en:'Telemedicine', zh:'è¿œç¨‹åŒ»ç–—', d:'åˆ©ç”¨é€šä¿¡æŠ€æœ¯è¿œç¨‹è¯Šæ–­å’Œæ²»ç–—æ‚£è€…ã€‚', scene: {en: "Telemedicine expands access to healthcare.", zh: "è¿œç¨‹åŒ»ç–—æ‰©å¤§äº†åŒ»ç–—æœåŠ¡çš„è¦†ç›–é¢ã€‚"} },
            { id:'m5', cat:'MED', en:'Metabolism', zh:'æ–°é™ˆä»£è°¢', d:'ç”Ÿç‰©ä½“å†…ç»´æŒç”Ÿå‘½æ‰€è¿›è¡Œçš„ä¸€ç³»åˆ—åŒ–å­¦ååº”ã€‚', scene: {en: "Exercise can boost your metabolism.", zh: "è¿åŠ¨å¯ä»¥ä¿ƒè¿›æ–°é™ˆä»£è°¢ã€‚"} },

            // GEO - åœ°ç†
            { id:'g1', cat:'GEO', en:'Silk Road Economic Belt', zh:'ä¸ç»¸ä¹‹è·¯ç»æµå¸¦', d:'ä¸­å›½ä¸è¥¿äºšå„å›½ä¹‹é—´å½¢æˆçš„ä¸€ä¸ªç»æµåˆä½œåŒºåŸŸã€‚', scene: {en: "The Silk Road Economic Belt promotes regional trade.", zh: "ä¸ç»¸ä¹‹è·¯ç»æµå¸¦ä¿ƒè¿›äº†åŒºåŸŸè´¸æ˜“ã€‚"} },
            { id:'g2', cat:'GEO', en:'Tectonic plate', zh:'æ¿å—æ„é€ ', d:'åœ°çƒå²©çŸ³åœˆè¢«åˆ†å‰²æˆçš„è‹¥å¹²å·¨å¤§æ¿å—ã€‚', scene: {en: "Earthquakes occur at tectonic plate boundaries.", zh: "åœ°éœ‡å‘ç”Ÿåœ¨æ¿å—è¾¹ç•Œå¤„ã€‚"} },
            { id:'g3', cat:'GEO', en:'Prime Meridian', zh:'æœ¬åˆå­åˆçº¿', d:'åœ°çƒä¸Šè®¡ç®—ç»åº¦çš„èµ·å§‹ç»çº¿ï¼ˆ0åº¦ç»çº¿ï¼‰ã€‚', scene: {en: "The Prime Meridian passes through Greenwich.", zh: "æœ¬åˆå­åˆçº¿ç©¿è¿‡æ ¼æ—å¨æ²»ã€‚"} },
            { id:'g4', cat:'GEO', en:'Archipelago', zh:'ç¾¤å²›', d:'å½¼æ­¤è·ç¦»å¾ˆè¿‘ï¼Œæˆç¾¤åˆ†å¸ƒçš„ä¸€ç»„å²›å±¿ã€‚', scene: {en: "Indonesia is the world's largest archipelago.", zh: "å°åº¦å°¼è¥¿äºšæ˜¯ä¸–ç•Œä¸Šæœ€å¤§çš„ç¾¤å²›ã€‚"} },
            { id:'g5', cat:'GEO', en:'Monsoon', zh:'å­£é£', d:'å¤§èŒƒå›´åœ°åŒºç››è¡Œé£å‘éšå­£èŠ‚æœ‰æ˜¾è‘—æ”¹å˜çš„é£ã€‚', scene: {en: "The monsoon season brings heavy rain.", zh: "å­£é£å­£èŠ‚å¸¦æ¥å¼ºé™é›¨ã€‚"} },

            // SPT - ä½“è‚²
            { id:'s1', cat:'SPT', en:'Winter Olympics', zh:'å†¬å¥¥ä¼š', d:'ä¸–ç•Œè§„æ¨¡æœ€å¤§çš„å†¬å­£ç»¼åˆæ€§è¿åŠ¨ä¼šã€‚', scene: {en: "Beijing hosted a successful Winter Olympics.", zh: "åŒ—äº¬ä¸¾åŠäº†ä¸€å±ŠæˆåŠŸçš„å†¬å¥¥ä¼šã€‚"} },
            { id:'s2', cat:'SPT', en:'Marathon', zh:'é©¬æ‹‰æ¾', d:'é•¿è·‘æ¯”èµ›é¡¹ç›®ï¼Œå…¨é•¿42.195å…¬é‡Œã€‚', scene: {en: "Running a marathon requires endurance.", zh: "è·‘é©¬æ‹‰æ¾éœ€è¦è€åŠ›ã€‚"} },
            { id:'s3', cat:'SPT', en:'Doping control', zh:'å…´å¥‹å‰‚æ£€æµ‹', d:'ä¸ºç»´æŠ¤ä½“è‚²å…¬å¹³ï¼Œå¯¹è¿åŠ¨å‘˜è¿›è¡Œçš„è¯ç‰©æ£€æŸ¥ã€‚', scene: {en: "Strict doping control is enforced.", zh: "å®æ–½äº†ä¸¥æ ¼çš„å…´å¥‹å‰‚æ£€æµ‹ã€‚"} },
            { id:'s4', cat:'SPT', en:'Hat trick', zh:'å¸½å­æˆæ³•', d:'åœ¨ä¸€åœºæ¯”èµ›ä¸­ä¸€åçƒå‘˜è¿å¾—ä¸‰åˆ†ï¼ˆé€šå¸¸æŒ‡è¿›ä¸‰çƒï¼‰ã€‚', scene: {en: "He scored a hat trick in the final.", zh: "ä»–åœ¨å†³èµ›ä¸­ä¸Šæ¼”äº†å¸½å­æˆæ³•ã€‚"} },
            { id:'s5', cat:'SPT', en:'Grand Slam', zh:'å¤§æ»¡è´¯', d:'ç½‘çƒç­‰è¿åŠ¨ä¸­å›Šæ‹¬æ‰€æœ‰é¡¶çº§èµ›äº‹çš„å† å†›ã€‚', scene: {en: "She aims to complete a Grand Slam this year.", zh: "å¥¹ç›®æ ‡ä»Šå¹´å®Œæˆå¤§æ»¡è´¯ã€‚"} }

        ].sort((a,b) => a.en.localeCompare(b.en));

        // --- 2. æ¯æ—¥ä¸€è¨€åº“ (é«˜è´¨é‡ç¿»è¯‘) ---
        const QUOTES = [
            { en: "Translation is not a matter of words only: it is a matter of making intelligible a whole culture.", zh: "ç¿»è¯‘ä¸åªæ˜¯æ–‡å­—çš„è½¬æ¢ï¼Œæ›´æ˜¯è®©ä¸€ç§æ–‡åŒ–è¢«å®Œå…¨ç†è§£çš„è¿‡ç¨‹ã€‚" },
            { en: "The limits of my language mean the limits of my world.", zh: "è¯­è¨€çš„è¾¹ç•Œï¼Œå³æ˜¯ä¸–ç•Œçš„è¾¹ç•Œã€‚" },
            { en: "A different language is a different vision of life.", zh: "å¦ä¸€ç§è¯­è¨€ï¼Œæ˜¯äººç”Ÿçš„å¦ä¸€ç§è§†é‡ã€‚" },
            { en: "Translators are the shadow heroes of literature.", zh: "è¯‘è€…æ˜¯æ–‡å­¦ä¸–ç•Œé‡Œçš„éšå½¢è‹±é›„ã€‚" },
            { en: "To have another language is to possess a second soul.", zh: "æŒæ¡å¦ä¸€é—¨è¯­è¨€ï¼Œé€šè¿‡æ‹¥æœ‰äº†ç¬¬äºŒä¸ªçµé­‚ã€‚" }
        ];

        let state = {
            mem: JSON.parse(localStorage.getItem('lexi_v13_mem') || '{}'),
            user: JSON.parse(localStorage.getItem('lexi_v13_user') || 'null'),
            notes: JSON.parse(localStorage.getItem('lexi_v13_notes') || '{}'),
            goal: 10, filter: 'all', queue: [], idx: 0, editMode: false, selectedItems: new Set()
        };

        function init() {
            if(localStorage.getItem('lexi_dark') === 'true') document.body.classList.add('dark');
            updateDashboard();
            updateUserUI();
            updateQuote();
        }

        // --- 3. æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ ---
        
        // æ¯æ—¥ä¸€è¨€é€»è¾‘ (0ç‚¹æ›´æ–°)
        function updateQuote() {
            const today = new Date();
            const dateStr = today.toDateString();
            document.getElementById('quote-date').innerText = today.toLocaleDateString('en-US', {month:'short', day:'numeric'});
            
            // ä½¿ç”¨æ—¥æœŸçš„å“ˆå¸Œå€¼æ¥é€‰æ‹© Quoteï¼Œä¿è¯æ¯å¤©å›ºå®š
            const hash = dateStr.split('').reduce((a,b)=>a+b.charCodeAt(0),0);
            const q = QUOTES[hash % QUOTES.length];
            
            document.getElementById('quote-en').innerText = `"${q.en}"`;
            document.getElementById('quote-zh').innerText = q.zh;
        }

        function updateDashboard() {
            const now = Date.now();
            const news = RAW_LIB.filter(i => (!state.mem[i.id] || state.mem[i.id].lv === 0)).length;
            const reviews = RAW_LIB.filter(i => state.mem[i.id]?.lv > 0 && state.mem[i.id].lv < 99 && now >= state.mem[i.id].next).length;
            const learned = RAW_LIB.filter(i => state.mem[i.id]?.lv > 0 && state.mem[i.id].lv < 99).length;
            
            document.getElementById('num-new').innerText = news;
            document.getElementById('num-review').innerText = reviews;
            document.getElementById('num-learned-dash').innerText = learned;
        }

        // --- 4. å­¦ä¹ ç³»ç»Ÿ ---
        function openStudy(mode) {
            const now = Date.now();
            if(mode === 'new') {
                state.queue = RAW_LIB.filter(i => !state.mem[i.id] || state.mem[i.id].lv === 0).slice(0, state.goal);
            } else {
                state.queue = RAW_LIB.filter(i => state.mem[i.id]?.lv > 0 && state.mem[i.id].lv < 99 && now >= state.mem[i.id].next);
            }
            if(!state.queue.length) return alert(mode==='new'?"ä»Šæ—¥æ–°è¯å·²å­¦å®Œï¼":"æš‚æ— å¤ä¹ ä»»åŠ¡ï¼Œä¼‘æ¯ä¸€ä¸‹å§ã€‚");
            state.idx = 0;
            document.getElementById('study-layer').classList.remove('hide');
            renderCard();
        }

        function renderCard() {
            const item = state.queue[state.idx];
            document.getElementById('studyCard').classList.remove('flipped');
            document.getElementById('card-cat').innerText = item.cat;
            document.getElementById('card-en').innerText = item.en;
            document.getElementById('card-zh').innerText = item.zh;
            document.getElementById('card-d').innerText = item.d;
            document.getElementById('card-scene-en').innerText = item.scene.en;
            document.getElementById('card-scene-zh').innerText = item.scene.zh;
            document.getElementById('card-note').value = state.notes[item.id] || '';
            document.getElementById('study-progress').innerText = `${state.idx + 1} / ${state.queue.length}`;
        }

        function handleLearn(score) {
            const item = state.queue[state.idx];
            if(!state.mem[item.id]) state.mem[item.id] = { lv: 0, next: 0 };
            const m = state.mem[item.id];
            
            if(score === 3) m.lv += 1;
            else if(score === 1) m.lv = 1; // å¿˜äº†é‡ç½®
            
            const intervals = [0, 1, 1440, 4320, 10080]; 
            m.next = Date.now() + (intervals[Math.min(m.lv, 4)] * 60000);
            
            // ç§¯åˆ†ç³»ç»Ÿ
            if(state.user && score > 1) state.user.points += 10;
            saveAll();
            
            state.idx++;
            if(state.idx < state.queue.length) renderCard();
            else closeStudy();
        }

        // --- 5. æ¢ç´¢ & æœç´¢ ---
        function setFilter(cat) { 
            state.filter = cat;
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active-tab'));
            event.target.classList.add('active-tab');
            renderExplore();
        }

        function renderExplore() {
            const container = document.getElementById('explore-list');
            const filtered = RAW_LIB.filter(i => state.filter === 'all' || i.cat === state.filter);
            container.innerHTML = filtered.map(i => `
                <div class="bg-white dark:bg-slate-800 rounded-[2rem] p-6 shadow-sm mb-4">
                    <div class="flex justify-between items-start cursor-pointer" onclick="toggleDetail('${i.id}')">
                        <div>
                            <span class="text-[9px] font-black text-indigo-500 bg-indigo-50 dark:bg-indigo-900/30 px-2 py-1 rounded uppercase">${i.cat}</span>
                            <h4 class="font-bold text-lg mt-2">${i.en}</h4>
                        </div>
                        <span class="text-indigo-500 text-xl font-bold">${state.mem[i.id]?.lv > 0 ? 'âœ“' : '+'}</span>
                    </div>
                    <div id="detail-${i.id}" class="hide mt-6 pt-6 border-t border-slate-50 dark:border-slate-700">
                        <p class="text-indigo-600 dark:text-indigo-400 font-bold serif mb-3 text-sm">${i.zh}</p>
                        <p class="text-xs text-slate-500 mb-6 leading-relaxed">${i.d}</p>
                        <div class="bg-slate-50 dark:bg-slate-900 p-4 rounded-2xl mb-6">
                            <p class="text-[9px] font-black opacity-30 uppercase mb-2">Context</p>
                            <p class="text-xs font-bold mb-1">${i.scene.en}</p>
                            <p class="text-[10px] text-slate-400 serif">${i.scene.zh}</p>
                        </div>
                        <textarea oninput="saveNote('${i.id}', this.value)" class="w-full bg-slate-50 dark:bg-slate-900 p-4 rounded-xl text-xs outline-none h-24 focus:ring-1 ring-indigo-500 transition-all" placeholder="ç‚¹å‡»è®°ç¬”è®°...">${state.notes[i.id] || ''}</textarea>
                    </div>
                </div>
            `).join('');
        }

        // --- 6. å½’æ¡£é€»è¾‘ ---
        function renderLearned() {
            const list = RAW_LIB.filter(i => state.mem[i.id]?.lv > 0 && state.mem[i.id].lv < 99);
            const container = document.getElementById('learned-list');
            if(!list.length) { container.innerHTML = '<div class="text-center py-20 opacity-20 font-bold">ç©ºç©ºå¦‚ä¹Ÿ</div>'; return; }
            container.innerHTML = list.map(i => `
                <div class="bg-white dark:bg-slate-800 p-5 rounded-2xl flex items-center gap-4 border border-transparent hover:border-slate-100 dark:hover:border-slate-700 transition-colors">
                    <label class="checkbox-custom ${state.editMode?'':'hide'} relative">
                        <input type="checkbox" class="hidden" onchange="toggleSelect('${i.id}')" ${state.selectedItems.has(i.id)?'checked':''}>
                        <div class="w-6 h-6 rounded-full border-2 border-slate-200 dark:border-slate-600 flex items-center justify-center transition-all duration-300">
                            <svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        </div>
                    </label>
                    <div class="truncate flex-1">
                        <p class="font-bold text-sm mb-1">${i.en}</p>
                        <p class="text-[10px] opacity-40 serif">${i.zh}</p>
                    </div>
                </div>
            `).join('');
        }

        // --- 7. ç™»å½•ä¸éªŒè¯ç é€»è¾‘ ---
        let codeTimer = null;
        function sendCode() {
            const phone = document.getElementById('login-phone').value;
            if(!/^1[3-9]\d{9}$/.test(phone)) return alert("è¯·è¾“å…¥æœ‰æ•ˆçš„æ‰‹æœºå·");
            
            const btn = document.getElementById('btn-get-code');
            btn.disabled = true;
            let sec = 60;
            btn.innerText = `${sec}s`;
            alert(`ã€LexiMTIã€‘æ‚¨çš„éªŒè¯ç æ˜¯ 1234ï¼Œè¯·åœ¨ 60 ç§’å†…è¾“å…¥ã€‚`); // æ¨¡æ‹Ÿå‘é€
            
            codeTimer = setInterval(() => {
                sec--;
                btn.innerText = `${sec}s`;
                if(sec <= 0) {
                    clearInterval(codeTimer);
                    btn.disabled = false;
                    btn.innerText = "è·å–éªŒè¯ç ";
                }
            }, 1000);
        }

        function doLogin() {
            const phone = document.getElementById('login-phone').value;
            const code = document.getElementById('login-code').value;
            
            if(!/^1[3-9]\d{9}$/.test(phone)) return alert("è¯·è¾“å…¥æœ‰æ•ˆçš„æ‰‹æœºå·");
            if(code !== "1234") return alert("éªŒè¯ç é”™è¯¯ (æµ‹è¯•ç : 1234)");
            
            state.user = { phone, points: 50 }; // ç™»å½•é€50åˆ†
            if(codeTimer) clearInterval(codeTimer);
            saveAll(); updateUserUI();
        }

        function doLogout() { 
            if(confirm("ç¡®å®šé€€å‡ºå½“å‰è´¦å·ï¼Ÿ")) { 
                state.user = null; 
                saveAll(); updateUserUI(); 
                document.getElementById('btn-get-code').innerText = "è·å–éªŒè¯ç ";
                document.getElementById('btn-get-code').disabled = false;
            } 
        }

        function updateUserUI() {
            const isL = !!state.user;
            document.getElementById('login-form').classList.toggle('hide', isL);
            document.getElementById('profile-data').classList.toggle('hide', !isL);
            if(isL) {
                document.getElementById('display-phone').innerText = state.user.phone.replace(/(\d{3})\d{4}(\d{4})/, '$1****$2');
                document.getElementById('stat-points').innerText = state.user.points;
                document.getElementById('stat-words').innerText = Object.values(state.mem).filter(x=>x.lv>0&&x.lv<99).length;
            }
        }

        // --- é€šç”¨å·¥å…· ---
        function flipCard() { document.getElementById('studyCard').classList.toggle('flipped'); }
        function switchTab(tab) {
            ['home', 'explore', 'learned'].forEach(t => document.getElementById('view-'+t)?.classList.add('hide'));
            document.getElementById('view-'+tab).classList.remove('hide');
            
            // æ›´æ–°åº•éƒ¨å¯¼èˆªå›¾æ ‡çŠ¶æ€
            document.getElementById('btn-home').className = tab==='home'?'text-2xl active-tab p-1':'text-2xl opacity-30 p-1';
            document.getElementById('btn-explore').className = tab==='explore'?'text-2xl active-tab p-1':'text-2xl opacity-30 p-1';
            
            if(tab === 'explore') renderExplore();
            if(tab === 'learned') renderLearned();
        }
        function saveNote(id, v) { state.notes[id] = v; localStorage.setItem('lexi_v13_notes', JSON.stringify(state.notes)); }
        function saveCurrentNote(v) { saveNote(state.queue[state.idx].id, v); }
        function saveAll() {
            localStorage.setItem('lexi_v13_mem', JSON.stringify(state.mem));
            localStorage.setItem('lexi_v13_user', JSON.stringify(state.user));
            updateDashboard();
            if(state.user) updateUserUI();
        }
        function toggleSidebar(s) { document.getElementById('settings-sidebar').classList.toggle('open', s); document.getElementById('settings-overlay').classList.toggle('hide', !s); }
        function toggleDarkMode() { document.body.classList.toggle('dark'); localStorage.setItem('lexi_dark', document.body.classList.contains('dark')); }
        function toggleDetail(id) { document.getElementById('detail-'+id).classList.toggle('hide'); }
        function closeStudy() { document.getElementById('study-layer').classList.add('hide'); updateDashboard(); }
        function toggleEditMode() { 
            state.editMode = !state.editMode; 
            document.getElementById('batch-bar').classList.toggle('hide', !state.editMode);
            renderLearned(); 
        }
        function toggleSelect(id) {
            state.selectedItems.has(id) ? state.selectedItems.delete(id) : state.selectedItems.add(id);
            document.getElementById('selected-count').innerText = state.selectedItems.size;
        }
        function moveToTrash() {
            if(state.selectedItems.size === 0) return;
            state.selectedItems.forEach(id => { if(state.mem[id]) state.mem[id].lv = 99; });
            saveAll(); state.selectedItems.clear(); toggleEditMode();
            alert("å·²å½’æ¡£ï¼Œè¿™äº›è¯å°†ä¸å†å‡ºç°åœ¨å¤ä¹ é˜Ÿåˆ—ä¸­ã€‚");
        }
        function speakWord() { window.speechSynthesis.speak(new SpeechSynthesisUtterance(state.queue[state.idx].en)); }
        function updateGoal(v) { state.goal = v; document.getElementById('goal-val').innerText = v; }

        init();
    </script>
</body>
</html>
