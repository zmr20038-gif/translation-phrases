<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LexiFlow MTI v10</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700;800&family=Noto+Serif+SC:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #F8FAFC; --text: #1E293B; --card: #FFFFFF; --accent: #4F46E5; }
        .dark { --bg: #0F172A; --text: #F1F5F9; --card: #1E293B; --accent: #818CF8; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; overflow-x: hidden; }
        .serif { font-family: 'Noto Serif SC', serif; }

        /* ä¾§è¾¹æ åŠ¨ç”» */
        #settings-sidebar { transform: translateX(100%); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        #settings-sidebar.open { transform: translateX(0); }

        /* å¡ç‰‡ç¿»è½¬æ•ˆæœ */
        .card-container { perspective: 1000px; width: 100%; height: 100%; position: relative; }
        .flip-card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1); transform-style: preserve-3d; }
        .flipped .flip-card-inner { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 1.5rem; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 2rem; background: var(--card); box-shadow: 0 4px 20px -5px rgba(0,0,0,0.05); border: 1px solid rgba(0,0,0,0.05); }
        .card-back { transform: rotateY(180deg); border: 2px solid var(--accent); overflow-y: auto; }

        .hide { display: none !important; }
        .active-tab { color: var(--accent); opacity: 1 !important; transform: scale(1.1); }
        
        /* ç§¯åˆ†åŠ¨ç”» */
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-20px); } }
        .point-plus { position: absolute; color: #F59E0B; font-weight: 900; animation: floatUp 1s ease-out forwards; pointer-events: none; z-index: 500; }
    </style>
</head>
<body class="pb-24 select-none"> <header class="max-w-md mx-auto px-6 pt-12 pb-4 flex justify-between items-center">
        <div>
            <h1 class="text-3xl font-[900] tracking-tighter italic text-slate-800 dark:text-white">Lexi<span class="text-indigo-600">Flow</span></h1>
            <p class="text-[10px] font-bold opacity-50 uppercase tracking-widest mt-1">MTI Pro â€¢ 2026 Edition</p>
        </div>
        <button onclick="toggleSidebar(true)" class="p-3 bg-white dark:bg-slate-800 rounded-full shadow-sm active:scale-90 transition-transform text-xl">
            âš™ï¸
        </button>
    </header>

    <main id="view-home" class="max-w-md mx-auto px-6 space-y-6">
        
        <div class="grid grid-cols-2 gap-4">
            <div onclick="openStudy('new')" class="bg-white dark:bg-slate-800 p-6 rounded-[2rem] shadow-sm active:scale-95 transition-all border-b-4 border-indigo-50 dark:border-slate-700 relative overflow-hidden group">
                <div class="absolute right-0 top-0 p-4 opacity-10 text-6xl group-hover:scale-110 transition-transform">ğŸ“–</div>
                <span class="text-[10px] font-black opacity-40 uppercase tracking-widest text-indigo-900 dark:text-indigo-200">New Words</span>
                <p id="num-new" class="text-4xl font-black mt-2 text-indigo-600">0</p>
                <p class="text-xs opacity-40 mt-1">ä»Šæ—¥éœ€å­¦</p>
            </div>
            
            <div onclick="openStudy('review')" class="bg-white dark:bg-slate-800 p-6 rounded-[2rem] shadow-sm active:scale-95 transition-all border-b-4 border-emerald-50 dark:border-slate-700 relative overflow-hidden group">
                <div class="absolute right-0 top-0 p-4 opacity-10 text-6xl group-hover:scale-110 transition-transform">â°</div>
                <span class="text-[10px] font-black opacity-40 uppercase tracking-widest text-emerald-900 dark:text-emerald-200">Review</span>
                <p id="num-review" class="text-4xl font-black mt-2 text-emerald-500">0</p>
                <p class="text-xs opacity-40 mt-1">é—å¿˜ä¸´ç•Œç‚¹</p>
            </div>
        </div>

        <div class="bg-indigo-600 rounded-[2rem] p-6 text-white shadow-lg shadow-indigo-200 dark:shadow-none relative overflow-hidden">
            <div class="absolute -right-4 -top-4 w-24 h-24 bg-white opacity-10 rounded-full blur-xl"></div>
            <p class="text-[10px] font-bold opacity-60 uppercase mb-3 tracking-widest">Daily Wisdom / æ¯æ—¥ä¸€è¨€</p>
            <p class="text-lg font-bold font-serif leading-relaxed mb-2">"Translation is not just about words, it's about making a whole culture intelligible."</p>
            <p class="text-sm opacity-80 serif">â€œç¿»è¯‘ä¸ä»…ä»…æ˜¯å…³äºæ–‡å­—ï¼Œæ›´æ˜¯å…³äºè®©æ•´ä¸ªæ–‡åŒ–å˜å¾—å¯ä»¥ç†è§£ã€‚â€</p>
            <p class="text-[10px] font-bold text-right mt-4 opacity-60">â€” Anthony Burgess</p>
        </div>

        <div class="flex justify-between items-end px-2 opacity-50">
            <div class="text-xs font-bold">Total Progress</div>
            <div class="text-[10px] font-bold uppercase tracking-widest">MTI 2025 Plan</div>
        </div>
    </main>

    <main id="view-explore" class="max-w-md mx-auto px-6 mt-6 hide">
        <h2 class="text-2xl font-black mb-6">è¯æ¡åº“æ¢ç´¢</h2>
        <div id="explore-list" class="space-y-4 pb-24">
            </div>
    </main>

    <section id="study-layer" class="fixed inset-0 bg-[#F0F4F8] dark:bg-slate-900 z-[200] hide flex flex-col">
        <div class="px-6 pt-12 pb-4 flex justify-between items-center">
            <button onclick="closeStudy()" class="w-10 h-10 rounded-full bg-white dark:bg-slate-800 flex items-center justify-center shadow-sm text-lg">âœ•</button>
            <div class="flex flex-col items-center">
                <span id="study-mode-label" class="text-[10px] font-black uppercase tracking-widest opacity-40">NEW LEARNING</span>
                <span id="study-progress" class="text-xs font-bold font-mono">1 / 10</span>
            </div>
            <button onclick="speakWord()" class="w-10 h-10 rounded-full bg-white dark:bg-slate-800 flex items-center justify-center shadow-sm text-lg">ğŸ”Š</button>
        </div>

        <div class="flex-1 px-6 py-4 flex items-center justify-center overflow-hidden">
            <div class="card-container" id="studyCard">
                <div class="flip-card-inner" onclick="flipCard()">
                    <div class="card-face card-front">
                        <span id="card-cat" class="text-[9px] font-black text-white bg-indigo-400 px-2 py-1 rounded mb-6 uppercase tracking-widest">CAT</span>
                        <h2 id="card-en" class="text-3xl font-black text-center text-slate-800 dark:text-white leading-snug">Word</h2>
                        <p class="mt-12 text-[10px] font-bold text-indigo-500 bg-indigo-50 dark:bg-indigo-900/30 px-3 py-1 rounded-full">ç‚¹å‡»ç¿»è½¬æŸ¥çœ‹</p>
                    </div>
                    <div class="card-face card-back items-start text-left">
                        <h3 id="card-zh" class="text-xl font-bold text-indigo-600 mb-3 serif">ä¸­æ–‡é‡Šä¹‰</h3>
                        <p id="card-d" class="text-xs text-slate-500 leading-relaxed mb-6 font-medium">å®šä¹‰è§£é‡Š...</p>
                        
                        <div class="w-full bg-slate-50 dark:bg-slate-800 p-3 rounded-xl border border-slate-100 dark:border-slate-700 mt-auto" onclick="event.stopPropagation()">
                            <p class="text-[9px] font-black text-slate-400 uppercase mb-1">ç¿»è¯‘ç¬”è®°</p>
                            <textarea id="card-note" oninput="saveCurrentNote(this.value)" class="w-full bg-transparent text-xs outline-none h-12 resize-none" placeholder="åœ¨æ­¤è¾“å…¥ç¬”è®°..."></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="px-6 pb-12 pt-4">
            <div class="grid grid-cols-3 gap-4 h-16">
                <button onclick="handleLearn(1)" class="rounded-2xl bg-white dark:bg-slate-800 text-slate-500 font-black text-xs shadow-sm border-b-4 border-slate-200 dark:border-slate-700 active:scale-95 active:border-b-0 transition-all">
                    ğŸ˜µ å¿˜äº†<br><span class="text-[9px] font-normal opacity-50">1åˆ†å</span>
                </button>
                <button onclick="handleLearn(2)" class="rounded-2xl bg-white dark:bg-slate-800 text-indigo-400 font-black text-xs shadow-sm border-b-4 border-indigo-100 dark:border-slate-700 active:scale-95 active:border-b-0 transition-all">
                    ğŸ¤” æ¨¡ç³Š<br><span class="text-[9px] font-normal opacity-50">10åˆ†å</span>
                </button>
                <button onclick="handleLearn(3)" class="rounded-2xl bg-indigo-600 text-white font-black text-xs shadow-lg shadow-indigo-200 dark:shadow-none border-b-4 border-indigo-800 active:scale-95 active:border-b-0 transition-all">
                    ğŸ˜ è®¤è¯†<br><span class="text-[9px] font-normal opacity-70">1å¤©å</span>
                </button>
            </div>
        </div>
    </section>

    <div id="settings-overlay" onclick="toggleSidebar(false)" class="fixed inset-0 bg-black/20 backdrop-blur-sm z-[300] hide transition-opacity"></div>
    <aside id="settings-sidebar" class="fixed top-0 right-0 h-full w-80 bg-white dark:bg-slate-900 z-[301] shadow-2xl flex flex-col overflow-y-auto">
        
        <div class="bg-slate-50 dark:bg-slate-800 p-6 pb-8 border-b border-slate-100 dark:border-slate-700">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-lg font-black">ä¸ªäººä¸­å¿ƒ</h2>
                <button onclick="toggleSidebar(false)" class="text-slate-400 text-xl">âœ•</button>
            </div>

            <div id="login-panel" class="">
                <p class="text-xs text-slate-400 mb-3">ç™»å½•åŒæ­¥å­¦ä¹ è¿›åº¦ä¸ç§¯åˆ†</p>
                <input type="tel" id="login-phone" placeholder="æ‰‹æœºå·" class="w-full bg-white dark:bg-slate-900 p-3 rounded-xl text-xs font-bold mb-2 border border-slate-200 dark:border-slate-600 outline-none focus:border-indigo-500 transition-colors">
                <div class="flex gap-2 mb-4">
                    <input type="text" placeholder="éªŒè¯ç " class="w-1/2 bg-white dark:bg-slate-900 p-3 rounded-xl text-xs font-bold border border-slate-200 dark:border-slate-600 outline-none">
                    <button class="w-1/2 bg-indigo-100 text-indigo-600 rounded-xl text-[10px] font-bold">è·å–éªŒè¯ç </button>
                </div>
                <button onclick="userLogin()" class="w-full bg-indigo-600 text-white p-3 rounded-xl text-sm font-bold shadow-md active:scale-95 transition-transform">ç«‹å³ç™»å½•</button>
            </div>

            <div id="profile-panel" class="hide">
                <div class="flex items-center gap-4 mb-6">
                    <div class="w-14 h-14 rounded-full bg-gradient-to-tr from-indigo-400 to-purple-500 p-0.5">
                        <img src="https://api.dicebear.com/7.x/notionists/svg?seed=Felix" class="w-full h-full rounded-full bg-white object-cover">
                    </div>
                    <div>
                        <p id="user-phone" class="font-bold text-lg leading-tight">138****8888</p>
                        <span class="text-[10px] bg-amber-100 text-amber-700 px-2 py-0.5 rounded-full font-bold">VIP ä¼šå‘˜</span>
                    </div>
                </div>
                
                <div class="grid grid-cols-3 gap-2 text-center">
                    <div class="bg-white dark:bg-slate-700 p-3 rounded-xl shadow-sm">
                        <p class="text-[9px] opacity-40 uppercase">ç§¯åˆ†</p>
                        <p id="stat-points" class="text-lg font-black text-amber-500">0</p>
                    </div>
                    <div class="bg-white dark:bg-slate-700 p-3 rounded-xl shadow-sm">
                        <p class="text-[9px] opacity-40 uppercase">å·²å­¦è¯</p>
                        <p id="stat-words" class="text-lg font-black text-indigo-500">0</p>
                    </div>
                    <div class="bg-white dark:bg-slate-700 p-3 rounded-xl shadow-sm">
                        <p class="text-[9px] opacity-40 uppercase">è¯ä¹¦</p>
                        <p class="text-lg font-black text-slate-500">1</p>
                    </div>
                </div>
                
                <button onclick="userLogout()" class="mt-6 w-full text-xs text-red-400 font-bold py-2 border border-red-100 rounded-lg">é€€å‡ºç™»å½•</button>
            </div>
        </div>

        <div class="p-6 space-y-6 flex-1">
            <h3 class="text-xs font-black opacity-30 uppercase tracking-widest">Preferences</h3>
            
            <div class="flex justify-between items-center">
                <span class="text-xs font-bold">æ¯æ—¥æ–°è¯é‡</span>
                <span id="goal-val" class="text-xs font-black text-indigo-500">10</span>
            </div>
            <input type="range" min="5" max="50" step="5" value="10" oninput="updateGoal(this.value)" class="w-full h-1 bg-slate-200 rounded-full appearance-none accent-indigo-600">

            <button onclick="toggleDarkMode()" class="w-full p-4 bg-slate-50 dark:bg-slate-800 rounded-xl flex justify-between font-bold text-xs">
                <span>å¤œé—´æ¨¡å¼</span><span id="mode-icon">ğŸŒ™</span>
            </button>
            
            <button onclick="resetData()" class="w-full p-4 text-red-500 bg-red-50 rounded-xl text-xs font-bold text-center mt-8">
                é‡ç½®æ‰€æœ‰æ•°æ®
            </button>
        </div>
    </aside>

    <nav class="fixed bottom-6 left-1/2 -translate-x-1/2 bg-white/90 dark:bg-slate-800/90 backdrop-blur-md rounded-full shadow-2xl flex items-center px-8 py-3 gap-10 border border-white/20 z-[100]">
        <button onclick="switchTab('home')" id="btn-home" class="text-2xl active-tab transition-all">ğŸ </button>
        <button onclick="switchTab('explore')" id="btn-explore" class="text-2xl opacity-30 transition-all">ğŸ”</button>
    </nav>

    <script>
        // MTI é«˜é¢‘çƒ­è¯åº“
        const RAW_LIB = [
            { id:'1', cat:'POL', en:'Chinese path to modernization', zh:'ä¸­å›½å¼ç°ä»£åŒ–', d:'äººå£è§„æ¨¡å·¨å¤§çš„ç°ä»£åŒ–ï¼Œå…¨ä½“äººæ°‘å…±åŒå¯Œè£•çš„ç°ä»£åŒ–ã€‚' },
            { id:'2', cat:'ECO', en:'New quality productive forces', zh:'æ–°è´¨ç”Ÿäº§åŠ›', d:'ä»¥ç§‘æŠ€åˆ›æ–°ä¸ºä¸»å¯¼ï¼Œæ‘†è„±ä¼ ç»Ÿå¢é•¿è·¯å¾„çš„å…ˆè¿›ç”Ÿäº§åŠ›ã€‚' },
            { id:'3', cat:'POL', en:'Whole-process people\'s democracy', zh:'å…¨è¿‡ç¨‹äººæ°‘æ°‘ä¸»', d:'æœ€å¹¿æ³›ã€æœ€çœŸå®ã€æœ€ç®¡ç”¨çš„ç¤¾ä¼šä¸»ä¹‰æ°‘ä¸»ã€‚' },
            { id:'4', cat:'ENV', en:'Carbon peaking and carbon neutrality', zh:'ç¢³è¾¾å³°ç¢³ä¸­å’Œ', d:'åŒç¢³ç›®æ ‡ï¼š2030å¹´å‰è¾¾å³°ï¼Œ2060å¹´å‰ä¸­å’Œã€‚' },
            { id:'5', cat:'TEC', en:'Artificial General Intelligence', zh:'é€šç”¨äººå·¥æ™ºèƒ½', d:'å…·æœ‰åƒäººç±»ä¸€æ ·æ‰§è¡Œå„ç§è®¤çŸ¥ä»»åŠ¡èƒ½åŠ›çš„AIç³»ç»Ÿã€‚' },
            { id:'6', cat:'ECO', en:'High-standard opening up', zh:'é«˜æ°´å¹³å¯¹å¤–å¼€æ”¾', d:'ä¾æ‰˜è¶…å¤§è§„æ¨¡å¸‚åœºä¼˜åŠ¿ï¼Œå¸å¼•å…¨çƒèµ„æºè¦ç´ ã€‚' },
            { id:'7', cat:'CUL', en:'Cultural confidence', zh:'æ–‡åŒ–è‡ªä¿¡', d:'ä¸€ä¸ªå›½å®¶ã€ä¸€ä¸ªæ°‘æ—ã€ä¸€ä¸ªæ”¿å…šå¯¹è‡ªèº«æ–‡åŒ–ä»·å€¼çš„å……åˆ†è‚¯å®šã€‚' },
            { id:'8', cat:'SOC', en:'Rural revitalization', zh:'ä¹¡æ‘æŒ¯å…´', d:'äº§ä¸šå…´æ—ºã€ç”Ÿæ€å®œå±…ã€ä¹¡é£æ–‡æ˜ã€æ²»ç†æœ‰æ•ˆã€ç”Ÿæ´»å¯Œè£•ã€‚' }
        ];

        // çŠ¶æ€ç®¡ç†
        let state = {
            mem: JSON.parse(localStorage.getItem('lexi_v10_mem') || '{}'), // {id: {lv:0, next:timestamp}}
            user: JSON.parse(localStorage.getItem('lexi_v10_user') || 'null'), // {phone, points, learnedCount}
            notes: JSON.parse(localStorage.getItem('lexi_v10_notes') || '{}'),
            goal: 10,
            queue: [], idx: 0, mode: 'new' // 'new' or 'review'
        };

        // --- åˆå§‹åŒ– ---
        function init() {
            if(localStorage.getItem('lexi_dark') === 'true') document.body.classList.add('dark');
            updateUserUI();
            updateDashboard();
        }

        // --- æ ¸å¿ƒç®—æ³•ï¼šè‰¾å®¾æµ©æ–¯/é—´éš”å¤ä¹  ---
        function updateDashboard() {
            const now = Date.now();
            
            // è®¡ç®—â€œå¾…å¤ä¹ â€ï¼šç­‰çº§>0 ä¸” æ—¶é—´å·²åˆ°
            const reviewCount = RAW_LIB.filter(i => {
                const m = state.mem[i.id];
                return m && m.lv > 0 && now >= m.next;
            }).length;

            // è®¡ç®—â€œéœ€å­¦ä¹ â€ï¼šæœªå¼€å§‹ æˆ– lv=0
            const newCount = RAW_LIB.filter(i => !state.mem[i.id] || state.mem[i.id].lv === 0).length;

            document.getElementById('num-new').innerText = newCount;
            document.getElementById('num-review').innerText = reviewCount;
        }

        function openStudy(mode) {
            state.mode = mode;
            const now = Date.now();
            
            if(mode === 'new') {
                state.queue = RAW_LIB.filter(i => !state.mem[i.id] || state.mem[i.id].lv === 0).slice(0, state.goal);
                document.getElementById('study-mode-label').innerText = "NEW LEARNING";
            } else {
                state.queue = RAW_LIB.filter(i => {
                    const m = state.mem[i.id];
                    return m && m.lv > 0 && now >= m.next;
                });
                document.getElementById('study-mode-label').innerText = "REVIEW MODE";
            }

            if(state.queue.length === 0) {
                alert(mode === 'new' ? "ä»Šæ—¥ä»»åŠ¡å·²å®Œæˆï¼" : "æš‚æ— å¾…å¤ä¹ è¯æ¡ï¼Œä¼‘æ¯ä¸€ä¸‹å§ã€‚");
                return;
            }

            state.idx = 0;
            document.getElementById('study-layer').classList.remove('hide');
            renderCard();
        }

        function renderCard() {
            const item = state.queue[state.idx];
            document.getElementById('studyCard').classList.remove('flipped'); // é‡ç½®ç¿»è½¬
            
            // å¡«å……å†…å®¹
            document.getElementById('card-cat').innerText = item.cat;
            document.getElementById('card-en').innerText = item.en;
            document.getElementById('card-zh').innerText = item.zh;
            document.getElementById('card-d').innerText = item.d;
            document.getElementById('card-note').value = state.notes[item.id] || '';
            
            document.getElementById('study-progress').innerText = `${state.idx + 1} / ${state.queue.length}`;
        }

        function handleLearn(score) {
            const item = state.queue[state.idx];
            if(!state.mem[item.id]) state.mem[item.id] = { lv: 0, next: 0 };
            const m = state.mem[item.id];

            // ç§¯åˆ†åé¦ˆç‰¹æ•ˆ
            if(state.user && score > 1) {
                addPoints(10);
                showFloatingPoint(10);
            }

            // --- è‰¾å®¾æµ©æ–¯æ ¸å¿ƒé€»è¾‘ (ç®€åŒ–ç‰ˆç”¨äºæ¼”ç¤º) ---
            // Lv 0: æ–°è¯
            // Lv 1: 1åˆ†é’Ÿå
            // Lv 2: 10åˆ†é’Ÿå
            // Lv 3: 1å¤©å ...
            const intervals = [0, 1, 10, 1440, 2880, 7200]; // åˆ†é’Ÿå•ä½
            
            if(score === 1) { // å¿˜äº†
                m.lv = 1; // é‡ç½®åˆ°æœ€åˆçº§
            } else if (score === 3) { // è®¤è¯†
                m.lv = Math.min(m.lv + 1, 5); // å‡çº§
            }
            // (score 2 æ¨¡ç³Šï¼šç­‰çº§ä¸å˜)

            // è®¡ç®—ä¸‹æ¬¡å¤ä¹ æ—¶é—´æˆ³
            // ä¸ºäº†æ¼”ç¤ºæ•ˆæœï¼ŒLv1è®¾ä¸º30ç§’ï¼ŒLv2è®¾ä¸º2åˆ†é’Ÿ
            // å®é™…åº”ç”¨è¯·ç”¨ intervals * 60 * 1000
            let waitTime = 0;
            if(m.lv === 1) waitTime = 30 * 1000; // 30ç§’ (æµ‹è¯•ç”¨)
            else if(m.lv === 2) waitTime = 2 * 60 * 1000; // 2åˆ†é’Ÿ
            else waitTime = intervals[m.lv] * 60 * 1000; 

            m.next = Date.now() + waitTime;
            
            // æ›´æ–°å·²å­¦è®¡æ•°
            if(state.user) {
                const learnedCount = Object.values(state.mem).filter(x => x.lv > 0).length;
                state.user.learnedCount = learnedCount;
                saveUser();
            }

            saveMem();
            nextCard();
        }

        function nextCard() {
            // æé€Ÿæ¨¡å¼åŠ¨ç”»
            const card = document.getElementById('studyCard');
            card.style.transform = 'translateX(-20px)';
            card.style.opacity = '0';
            
            setTimeout(() => {
                state.idx++;
                if(state.idx < state.queue.length) {
                    renderCard();
                    card.style.transform = 'translateX(0)';
                    card.style.opacity = '1';
                } else {
                    closeStudy();
                    card.style.transform = 'translateX(0)';
                    card.style.opacity = '1';
                }
            }, 200);
        }

        function flipCard() { document.getElementById('studyCard').classList.toggle('flipped'); }

        // --- ç”¨æˆ·ä¸ç§¯åˆ†ç³»ç»Ÿ ---
        function userLogin() {
            const phone = document.getElementById('login-phone').value;
            if(phone.length < 11) return alert("è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·");
            
            // æ¨¡æ‹Ÿç™»å½•
            state.user = { 
                phone: phone, 
                points: 0, 
                learnedCount: 0 
            };
            saveUser();
            updateUserUI();
            alert("ç™»å½•æˆåŠŸï¼");
        }

        function userLogout() {
            if(confirm("ç¡®å®šé€€å‡ºç™»å½•å—ï¼Ÿ")) {
                state.user = null;
                localStorage.removeItem('lexi_v10_user');
                updateUserUI();
            }
        }

        function updateUserUI() {
            const isLogged = !!state.user;
            document.getElementById('login-panel').classList.toggle('hide', isLogged);
            document.getElementById('profile-panel').classList.toggle('hide', !isLogged);
            
            if(isLogged) {
                document.getElementById('user-phone').innerText = state.user.phone.replace(/(\d{3})\d{4}(\d{4})/, '$1****$2');
                document.getElementById('stat-points').innerText = state.user.points;
                document.getElementById('stat-words').innerText = state.user.learnedCount;
            }
        }

        function addPoints(pts) {
            if(!state.user) return;
            state.user.points += pts;
            document.getElementById('stat-points').innerText = state.user.points;
            saveUser();
        }

        function showFloatingPoint(amount) {
            const el = document.createElement('div');
            el.className = 'point-plus';
            el.innerText = `+${amount}`;
            el.style.left = '50%'; 
            el.style.top = '40%';
            document.getElementById('study-layer').appendChild(el);
            setTimeout(() => el.remove(), 1000);
        }

        // --- è¾…åŠ©åŠŸèƒ½ ---
        function toggleSidebar(show) { 
            const sb = document.getElementById('settings-sidebar');
            const ov = document.getElementById('settings-overlay');
            if(show) { sb.classList.add('open'); ov.classList.remove('hide'); }
            else { sb.classList.remove('open'); ov.classList.add('hide'); }
        }

        function switchTab(tab) {
            document.getElementById('view-home').classList.toggle('hide', tab !== 'home');
            document.getElementById('view-explore').classList.toggle('hide', tab !== 'explore');
            document.getElementById('btn-home').className = tab === 'home' ? 'text-2xl active-tab' : 'text-2xl opacity-30';
            document.getElementById('btn-explore').className = tab === 'explore' ? 'text-2xl active-tab' : 'text-2xl opacity-30';
            if(tab === 'explore') renderExplore();
        }

        function renderExplore() {
            document.getElementById('explore-list').innerHTML = RAW_LIB.map(i => `
                <div class="bg-white dark:bg-slate-800 p-4 rounded-xl flex justify-between items-center shadow-sm">
                    <div>
                        <span class="text-[9px] font-black text-slate-400 uppercase">${i.cat}</span>
                        <h4 class="font-bold text-sm">${i.en}</h4>
                        <p class="text-xs text-slate-500 truncate max-w-[200px]">${i.zh}</p>
                    </div>
                    <span class="text-indigo-500 font-bold text-lg">${state.mem[i.id]?.lv > 0 ? 'âœ“' : '+'}</span>
                </div>
            `).join('');
        }

        function speakWord() { window.speechSynthesis.speak(new SpeechSynthesisUtterance(state.queue[state.idx].en)); }
        function saveCurrentNote(val) { state.notes[state.queue[state.idx].id] = val; localStorage.setItem('lexi_v10_notes', JSON.stringify(state.notes)); }
        function saveMem() { localStorage.setItem('lexi_v10_mem', JSON.stringify(state.mem)); updateDashboard(); }
        function saveUser() { localStorage.setItem('lexi_v10_user', JSON.stringify(state.user)); }
        function closeStudy() { document.getElementById('study-layer').classList.add('hide'); updateDashboard(); }
        function toggleDarkMode() { document.body.classList.toggle('dark'); localStorage.setItem('lexi_dark', document.body.classList.contains('dark')); }
        function resetData() { localStorage.clear(); location.reload(); }

        init();
    </script>
</body>
</html>
